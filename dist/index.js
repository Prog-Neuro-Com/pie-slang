!function(t){"use strict";function n(t){var n=Object.create(null);return t&&Object.keys(t).forEach((function(e){if("default"!==e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})}})),n.default=t,Object.freeze(n)}var e=n(t),r=function(t,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},r(t,n)};function i(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}r(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}function o(t,n,e,r){return new(e||(e=Promise))((function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))}function a(t,n){var e,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(s){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(o=0)),o;)try{if(e=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(6===u[0]&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=n.call(t,o)}catch(t){u=[6,t],r=0}finally{e=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}}function u(t,n,e){if(e||2===arguments.length)for(var r,i=0,o=n.length;i<o;i++)!r&&i in n||(r||(r=Array.prototype.slice.call(n,0,i)),r[i]=n[i]);return t.concat(r||Array.prototype.slice.call(n))}"function"==typeof SuppressedError&&SuppressedError;var s=function(t){function n(n){var e=t.call(this,n)||this;return e.name="ConductorError",e.errorType="__unknown",e}return i(n,t),n}(Error),c=function(t){function n(n){var e=t.call(this,n)||this;return e.name="ConductorInternalError",e.errorType="__internal",e}return i(n,t),n}(s);!function(t){function n(n,e,r,i,o,a){var u=t.call(this,"".concat(n," (expected ").concat(e,", got ").concat(r,")"),i,o,a)||this;return u.name="EvaluatorTypeError",u.errorType="__evaluator_type",u.rawMessage=n,u.expected=e,u.actual=r,u}i(n,t)}(function(t){function n(n,e,r,i){var o=this,a=void 0!==e?"".concat(i?i+":":"").concat(e).concat(void 0!==r?":"+r:"",": "):"";return(o=t.call(this,"".concat(a).concat(n))||this).name="EvaluatorError",o.errorType="__evaluator",o.rawMessage=n,o.line=e,o.column=r,o.fileName=i,o}return i(n,t),n}(s));var p=function(){function t(t){this.conductor=t}return t.prototype.startEvaluator=function(t){return o(this,void 0,void 0,(function(){var n,e;return a(this,(function(r){switch(r.label){case 0:return[4,this.conductor.requestFile(t)];case 1:if(!(n=r.sent()))throw new c("Cannot load entrypoint file");return[4,this.evaluateFile(t,n)];case 2:r.sent(),r.label=3;case 3:return[4,this.conductor.requestChunk()];case 4:return e=r.sent(),[4,this.evaluateChunk(e)];case 5:return r.sent(),[3,3];case 6:return[2]}}))}))},t.prototype.evaluateFile=function(t,n){return o(this,void 0,void 0,(function(){return a(this,(function(t){return[2,this.evaluateChunk(n)]}))}))},t}();function h(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return[4,import(t)];case 1:return[2,n.sent().plugin]}}))}))}function f(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return[4,h(t)];case 1:return[2,n.sent()]}}))}))}!function(t){function n(){var n=t.call(this,"Not a module")||this;return n.name="InvalidModuleError",n.errorType="__invalidmodule",n}i(n,t)}(s);var l,y=function(){function t(t,n){this.__subscribers=new Set,this.__isAlive=!0,this.__waitingMessages=[],this.name=t,this.replacePort(n)}return t.prototype.send=function(t,n){this.__verifyAlive(),this.__port.postMessage(t,null!=n?n:[])},t.prototype.subscribe=function(t){if(this.__verifyAlive(),this.__subscribers.add(t),this.__waitingMessages){for(var n=0,e=this.__waitingMessages;n<e.length;n++){t(e[n])}delete this.__waitingMessages}},t.prototype.unsubscribe=function(t){this.__verifyAlive(),this.__subscribers.delete(t)},t.prototype.close=function(){var t;this.__verifyAlive(),this.__isAlive=!1,null===(t=this.__port)||void 0===t||t.close()},t.prototype.__verifyAlive=function(){if(!this.__isAlive)throw new c("Channel ".concat(this.name," has been closed"))},t.prototype.__dispatch=function(t){if(this.__verifyAlive(),this.__waitingMessages)this.__waitingMessages.push(t);else for(var n=0,e=this.__subscribers;n<e.length;n++){(0,e[n])(t)}},t.prototype.listenToPort=function(t){var n=this;t.addEventListener("message",(function(t){return n.__dispatch(t.data)})),t.start()},t.prototype.replacePort=function(t){var n;this.__verifyAlive(),null===(n=this.__port)||void 0===n||n.close(),this.__port=t,this.listenToPort(t)},t}(),w=function(){function t(){this.__s1=[],this.__s2=[]}return t.prototype.push=function(t){this.__s2.push(t)},t.prototype.pop=function(){if(0===this.__s1.length){if(0===this.__s2.length)throw new Error("queue is empty");var t=this.__s1;this.__s1=this.__s2.reverse(),this.__s2=t}return this.__s1.pop()},Object.defineProperty(t.prototype,"length",{get:function(){return this.__s1.length+this.__s2.length},enumerable:!1,configurable:!0}),t.prototype.clone=function(){var n=new t;return n.__s1=u([],this.__s1,!0),n.__s2=u([],this.__s2,!0),n},t}(),v=function(){function t(){this.__inputQueue=new w,this.__promiseQueue=new w,this.push=this.push.bind(this)}return t.prototype.push=function(t){0!==this.__promiseQueue.length?this.__promiseQueue.pop()(t):this.__inputQueue.push(t)},t.prototype.pop=function(){return o(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return 0!==this.__inputQueue.length?[2,this.__inputQueue.pop()]:[2,new Promise((function(n,e){t.__promiseQueue.push(n)}))]}))}))},t.prototype.tryPop=function(){if(0!==this.__inputQueue.length)return this.__inputQueue.pop()},t}(),d=function(){function t(t){this.__messageQueue=new v,this.name=t.name,this.__channel=t,this.__channel.subscribe(this.__messageQueue.push)}return t.prototype.receive=function(){return o(this,void 0,void 0,(function(){return a(this,(function(t){return[2,this.__messageQueue.pop()]}))}))},t.prototype.tryReceive=function(){return this.__messageQueue.tryPop()},t.prototype.send=function(t,n){this.__channel.send(t,n)},t.prototype.close=function(){this.__channel.unsubscribe(this.__messageQueue.push)},t}(),m=function(){function t(t,n){void 0===n&&(n=!1);var e=this;this.__alive=!0,this.__channels=new Map,this.__pluginMap=new Map,this.__plugins=[],this.__link=t,t.addEventListener("message",(function(t){return e.__handlePort(t.data)})),this.__parent=n}return t.prototype.__negotiateChannel=function(t){var n=new MessageChannel,e=n.port1,r=n.port2,i=new y(t,e);this.__link.postMessage([t,r],[r]),this.__channels.set(t,i)},t.prototype.__verifyAlive=function(){if(!this.__alive)throw new c("Conduit already terminated")},t.prototype.registerPlugin=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];this.__verifyAlive();for(var r=[],i=0,o=t.channelAttach;i<o.length;i++){var a=o[i];this.__channels.has(a)||this.__negotiateChannel(a),r.push(this.__channels.get(a))}var s=new(t.bind.apply(t,u([void 0,this,r],n,!1)));if(void 0!==s.name){if(this.__pluginMap.has(s.name))throw new c("Plugin ".concat(s.name," already registered"));this.__pluginMap.set(s.name,s)}return this.__plugins.push(s),s},t.prototype.unregisterPlugin=function(t){var n;this.__verifyAlive();for(var e=0,r=0;r<this.__plugins.length;++r)this.__plugins[e]===t&&++e,this.__plugins[r]=this.__plugins[r+e];r=this.__plugins.length-1;for(var i=this.__plugins.length-e;r>=i;--r)delete this.__plugins[r];t.name&&this.__pluginMap.delete(t.name),null===(n=t.destroy)||void 0===n||n.call(t)},t.prototype.lookupPlugin=function(t){if(this.__verifyAlive(),!this.__pluginMap.has(t))throw new c("Plugin ".concat(t," not registered"));return this.__pluginMap.get(t)},t.prototype.terminate=function(){var t,n,e;this.__verifyAlive();for(var r=0,i=this.__plugins;r<i.length;r++){var o=i[r];null===(t=o.destroy)||void 0===t||t.call(o)}null===(e=(n=this.__link).terminate)||void 0===e||e.call(n),this.__alive=!1},t.prototype.__handlePort=function(t){var n=t[0],e=t[1];if(this.__channels.has(n)){var r=this.__channels.get(n);this.__parent?r.listenToPort(e):r.replacePort(e)}else{r=new y(n,e);this.__channels.set(n,r)}},t}(),g=function(t,n,e){this.type=0,this.data={fn:t,args:n,invokeId:e}},E=function(t,n){this.type=2,this.data={invokeId:t,err:n}},T=function(t,n){this.type=1,this.data={invokeId:t,res:n}};function P(t){}!function(t){t[t.VOID=0]="VOID",t[t.BOOLEAN=1]="BOOLEAN",t[t.NUMBER=2]="NUMBER",t[t.CONST_STRING=3]="CONST_STRING",t[t.EMPTY_LIST=4]="EMPTY_LIST",t[t.PAIR=5]="PAIR",t[t.ARRAY=6]="ARRAY",t[t.CLOSURE=7]="CLOSURE",t[t.OPAQUE=8]="OPAQUE",t[t.LIST=9]="LIST"}(l||(l={}));var b,N,_,k,O,S,L,A,x,I=function(t){this.type=1,this.data={minVersion:t}},B=function(){this.type=0,this.data={version:0}},C=function(t){this.type=3,this.data=t},R=(L=[P],A=[],N=function(){function t(t,n,e){var r,i=n[0],u=n[1],s=n[2],c=n[3],p=n[4],h=n[5],f=this;this.name="__runner_main",this.__serviceHandlers=new Map([[0,function(t){t.data.version<0?(this.__serviceChannel.send(new I(0)),console.error("Host's protocol version (".concat(t.data.version,") must be at least ").concat(0))):console.log("Host is using protocol version ".concat(t.data.version))}],[1,function(t){console.error("Host expects at least protocol version ".concat(t.data.minVersion,", but we are on version ").concat(0)),this.__conduit.terminate()}],[2,function(t){this.__evaluator.startEvaluator(t.data)}]]),this.__conduit=t,this.__fileRpc=function(t,n){var e=this,r=[],i=0;return t.subscribe((function(i){return o(e,void 0,void 0,(function(){var e,o,u,s,c,p,h,f,l,y,w,v,d;return a(this,(function(a){switch(a.label){case 0:switch(i.type){case 0:return[3,1];case 1:return[3,6];case 2:return[3,7]}return[3,8];case 1:e=i.data,o=e.fn,u=e.args,f=e.invokeId,a.label=2;case 2:return a.trys.push([2,4,,5]),[4,n[o].apply(n,u)];case 3:return p=a.sent(),f>0&&t.send(new T(f,p)),[3,5];case 4:return s=a.sent(),f>0&&t.send(new E(f,s)),[3,5];case 5:return[3,8];case 6:return c=i.data,f=c.invokeId,p=c.res,null===(w=null===(y=r[f])||void 0===y?void 0:y[0])||void 0===w||w.call(y,p),delete r[f],[3,8];case 7:return h=i.data,f=h.invokeId,l=h.err,null===(d=null===(v=r[f])||void 0===v?void 0:v[1])||void 0===d||d.call(v,l),delete r[f],[3,8];case 8:return[2]}}))}))})),new Proxy({},{get:function(n,e,o){var a=Reflect.get(n,e,o);if(a)return a;var u="string"==typeof e&&"$"===e.charAt(0)?function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t.send(new g(e,n,0))}:function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var a=++i;return t.send(new g(e,n,a)),new Promise((function(t,n){r[a]=[t,n]}))};return Reflect.set(n,e,u,o),u}})}(i,{}),this.__chunkQueue=new d(u),this.__serviceChannel=s,this.__ioQueue=new d(c),this.__errorChannel=p,this.__statusChannel=h,this.__serviceChannel.send(new B),this.__serviceChannel.subscribe((function(t){var n;null===(n=f.__serviceHandlers.get(t.type))||void 0===n||n.call(f,t)})),this.__evaluator=new e(this),this.__isCompatibleWithModules=null!==(r=this.__evaluator.hasDataInterface)&&void 0!==r&&r}return t.prototype.requestFile=function(t){return this.__fileRpc.requestFile(t)},t.prototype.requestChunk=function(){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.__chunkQueue.receive()];case 1:return[2,t.sent().chunk]}}))}))},t.prototype.requestInput=function(){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.__ioQueue.receive()];case 1:return[2,t.sent().message]}}))}))},t.prototype.tryRequestInput=function(){var t=this.__ioQueue.tryReceive();return null==t?void 0:t.message},t.prototype.sendOutput=function(t){this.__ioQueue.send({message:t})},t.prototype.sendError=function(t){this.__errorChannel.send({error:t})},t.prototype.updateStatus=function(t,n){this.__statusChannel.send({status:t,isActive:n})},t.prototype.hostLoadPlugin=function(t){this.__serviceChannel.send(new C(t))},t.prototype.registerPlugin=function(t){for(var n,e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return(n=this.__conduit).registerPlugin.apply(n,u([t],e,!1))},t.prototype.unregisterPlugin=function(t){this.__conduit.unregisterPlugin(t)},t.prototype.registerModule=function(t){if(!this.__isCompatibleWithModules)throw new c("Evaluator has no data interface");return this.registerPlugin(t,this.__evaluator)},t.prototype.unregisterModule=function(t){this.unregisterPlugin(t)},t.prototype.importAndRegisterExternalPlugin=function(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(e){switch(e.label){case 0:return[4,h(t)];case 1:return n=e.sent(),[2,this.registerPlugin(n)]}}))}))},t.prototype.importAndRegisterExternalModule=function(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(e){switch(e.label){case 0:return[4,f(t)];case 1:return n=e.sent(),[2,this.registerModule(n)]}}))}))},t}(),_=N,"symbol"==typeof(k="RunnerPlugin")&&(k=k.description?"[".concat(k.description,"]"):""),Object.defineProperty(_,"name",{configurable:!0,value:O?"".concat(O," ",k):k}),S="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0,function(t,n,e,r,i,o){function a(t){if(void 0!==t&&"function"!=typeof t)throw new TypeError("Function expected");return t}for(var u,s=r.kind,c="getter"===s?"get":"setter"===s?"set":"value",p=!n&&t?r.static?t:t.prototype:null,h=n||(p?Object.getOwnPropertyDescriptor(p,r.name):{}),f=!1,l=e.length-1;l>=0;l--){var y={};for(var w in r)y[w]="access"===w?{}:r[w];for(var w in r.access)y.access[w]=r.access[w];y.addInitializer=function(t){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(t||null))};var v=(0,e[l])("accessor"===s?{get:h.get,set:h.set}:h[c],y);if("accessor"===s){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw new TypeError("Object expected");(u=a(v.get))&&(h.get=u),(u=a(v.set))&&(h.set=u),(u=a(v.init))&&i.unshift(u)}else(u=a(v))&&("field"===s?i.unshift(u):h[c]=u)}p&&Object.defineProperty(p,r.name,h),f=!0}(null,b={value:N},L,{kind:"class",name:N.name,metadata:S},null,A),N=b.value,S&&Object.defineProperty(N,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:S}),N.channelAttach=["__file_rpc","__chunk","__service","__stdio","__error","__status"],function(t,n,e){for(var r=arguments.length>2,i=0;i<n.length;i++)e=r?n[i].call(t,e):n[i].call(t)}(N,A),N);!function(t){t[t.INTEGER=1]="INTEGER",t[t.RATIONAL=2]="RATIONAL",t[t.REAL=3]="REAL",t[t.COMPLEX=4]="COMPLEX"}(x||(x={}));var M=function(t){this.result=t},q=function(t){function n(n,e){var r=t.call(this,n)||this;return r.result=n,r.value=e,r}return i(n,t),n.prototype.isSigned=function(){return!!this.result&&("+"===this.value[0]||"-"===this.value[0])},n.prototype.build=function(){return F.build(this.value)},n}(M),U=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.result=n,i.numerator=e,i.denominator=r,i}return i(n,t),n.prototype.build=function(){return V.build(this.numerator,this.denominator)},n}(M),H=function(t){function n(n,e,r,i){var o=t.call(this,n)||this;return o.result=n,o.integer=e,o.decimal=r,o.exponent=i,o}return i(n,t),n.prototype.build=function(){var t,n;if(null===(t=this.integer)||void 0===t?void 0:t.includes("inf"))return this.integer.includes("-")?G.NEG_INFINITY:G.INFINITY;if(null===(n=this.integer)||void 0===n?void 0:n.includes("nan"))return G.NAN;var e=(this.exponent?this.exponent.build():G.INEXACT_ZERO).coerce(),r=Number((this.integer?this.integer:"0")+"."+(this.decimal?this.decimal:"0"));return r*=Math.pow(10,e),G.build(r)},n}(M),z=function(t){function n(n,e,r,i){var o=t.call(this,n)||this;return o.result=n,o.real=e,o.sign=r,o.imaginary=i,o}return i(n,t),n.prototype.build=function(){var t=this.real?this.real.build():F.EXACT_ZERO,n=this.imaginary.build();return this.sign&&"-"===this.sign?X.build(t,n.negate()):X.build(t,n)},n}(M);function D(t){var n=new RegExp("^([+-]?)(\\d+)$").exec(t);return n?new q(!0,n[0]):new q(!1)}function Q(t,n){var e=D(t);if(e.result&&n>=x.INTEGER)return e;var r=function(t){if(1!==(t.match(/\//g)||[]).length)return new U(!1);var n=t.split("/");if(2!==n.length)return new U(!1);var e=n[0],r=n[1],i=D(e),o=D(r);return i.result&&o.result?new U(!0,e,r):new U(!1)}(t);if(r.result&&n>=x.RATIONAL)return r;var i=function(t){function n(t){if(function(t){return"+inf.0"===t||"-inf.0"===t||"+nan.0"===t||"-nan.0"===t}(t))return new H(!0,t);var n=(t.match(/\./g)||[]).length;if(n>1)return new H(!1);if(0===n){var e=D(t);return new H(e.result,e.value)}var r=t.split("."),i=r[0],o=r[1],a=D(i),u=D(o),s=a.result||""===i,c=u.result||""===o;return"+"===i||"-"===i?""===o?new H(!1):new H(!0,"".concat(i,"0"),t):a.result&&c||s&&u.result?u.result&&u.isSigned()?new H(!1):new H(!0,a.value,u.value):new H(!1)}return 0===(t.match(/[eE]/g)||[]).length?n(t):function(t){var e=t.indexOf("e"),r=t.indexOf("E");if(-1===e&&-1===r)return new H(!1);var i=-1===e?r:e,o=t.substring(0,i),a=t.substring(i+1);if(""===o||""==a)return new H(!1);var u=n(o);if(!u.result)return new H(!1);var s=Q(a,x.REAL);return s.result?new H(!0,u.integer,u.decimal,s):new H(!1)}(t)}(t);if(i.result&&n>=x.REAL)return i;var o=function(t){if((t.match(/i/g)||[]).length<1)return new z(!1);if("i"!==t[t.length-1])return new z(!1);var n=t.search(/(?<!^)[+-]/);if(-1===n){var e=Q(t.slice(0,-1),x.REAL);return e.result?new z(!0,void 0,void 0,e):new z(!1)}var r=t.slice(0,n),i=t.slice(n+1,-1);"+"!==i[0]&&"-"!==i[0]&&(i="+"+i);var o=Q(r,x.REAL),a=Q(i,x.REAL);return o.result&&a.result?new z(!0,o,t[n],a):new z(!1)}(t);return o.result&&n>=x.COMPLEX?o:new q(!1)}var F=function(){function t(t){this.numberType=x.INTEGER,this.value=t}return t.build=function(n,e){var r=BigInt(n);return 0n===r?t.EXACT_ZERO:new t(r)},t.prototype.promote=function(n){switch(n){case x.INTEGER:return this;case x.RATIONAL:return V.build(this.value,1n,!0);case x.REAL:return G.build(this.coerce(),!0);case x.COMPLEX:return X.build(this,t.EXACT_ZERO,!0)}},t.prototype.equals=function(n){return n instanceof t&&this.value===n.value},t.prototype.greaterThan=function(t){return this.value>t.value},t.prototype.negate=function(){return this===t.EXACT_ZERO?this:t.build(-this.value)},t.prototype.multiplicativeInverse=function(){if(this===t.EXACT_ZERO)throw new Error("Division by zero");return V.build(1n,this.value,!1)},t.prototype.add=function(n){return t.build(this.value+n.value)},t.prototype.multiply=function(n){return t.build(this.value*n.value)},t.prototype.getBigInt=function(){return this.value},t.prototype.coerce=function(){return this.value>Number.MAX_SAFE_INTEGER?1/0:this.value<Number.MIN_SAFE_INTEGER?-1/0:Number(this.value)},t.prototype.toString=function(){return this.value.toString()},t.EXACT_ZERO=new t(0n),t}(),V=function(){function t(t,n){this.numberType=x.RATIONAL,this.numerator=t,this.denominator=n}return t.build=function(n,e,r){return void 0===r&&(r=!1),t.simplify(BigInt(n),BigInt(e),r)},t.simplify=function(n,e,r){void 0===r&&(r=!1);var i=function(t,n){return 0n===n?t:i(n,t.valueOf()%n.valueOf())},o=i(n,e),a=n<0n?-1n:1n,u=e<0n?-1n:1n,s=a*u;return n*=a,1n!==(e*=u)||r?new t(s*n/o,e/o):F.build(s*n)},t.prototype.getNumerator=function(){return this.numerator},t.prototype.getDenominator=function(){return this.denominator},t.prototype.promote=function(t){switch(t){case x.RATIONAL:return this;case x.REAL:return G.build(this.coerce(),!0);case x.COMPLEX:return X.build(this,F.EXACT_ZERO,!0);default:throw new Error("Unable to demote rational")}},t.prototype.equals=function(n){return n instanceof t&&this.numerator===n.numerator&&this.denominator===n.denominator},t.prototype.greaterThan=function(t){return this.numerator*t.denominator>t.numerator*this.denominator},t.prototype.negate=function(){return t.build(-this.numerator,this.denominator)},t.prototype.multiplicativeInverse=function(){if(0n===this.numerator)throw new Error("Division by zero");return t.build(this.denominator,this.numerator)},t.prototype.add=function(n){var e=this.numerator*n.denominator+n.numerator*this.denominator,r=this.denominator*n.denominator;return t.build(e,r)},t.prototype.multiply=function(n){var e=this.numerator*n.numerator,r=this.denominator*n.denominator;return t.build(e,r)},t.prototype.coerce=function(){var t=this.numerator<0n?-this.numerator:this.numerator,n=this.denominator,e=Number(t/n);if(e>Number.MAX_VALUE)return this.numerator<0n?-1/0:1/0;for(var r=t%n;r>Number.MAX_SAFE_INTEGER||n>Number.MAX_SAFE_INTEGER;)r/=2n,n/=2n;var i=Number(r)/Number(n);return this.numerator<0n?-(e+i):e+i},t.prototype.toString=function(){return"".concat(this.numerator,"/").concat(this.denominator)},t}(),G=function(){function t(t){this.numberType=x.REAL,this.value=t}return t.build=function(n,e){return n===1/0?t.INFINITY:n===-1/0?t.NEG_INFINITY:isNaN(n)?t.NAN:0===n?t.INEXACT_ZERO:-0===n?t.INEXACT_NEG_ZERO:new t(n)},t.prototype.promote=function(t){switch(t){case x.REAL:return this;case x.COMPLEX:return X.build(this,F.EXACT_ZERO,!0);default:throw new Error("Unable to demote real")}},t.prototype.equals=function(n){return n instanceof t&&this.value===n.value},t.prototype.greaterThan=function(t){return this.value>t.value},t.prototype.negate=function(){return t.build(-this.value)},t.prototype.multiplicativeInverse=function(){if(this===t.INEXACT_ZERO||this===t.INEXACT_NEG_ZERO)throw new Error("Division by zero");return t.build(1/this.value)},t.prototype.add=function(n){return t.build(this.value+n.value)},t.prototype.multiply=function(n){return t.build(this.value*n.value)},t.prototype.coerce=function(){return this.value},t.prototype.toString=function(){return this===t.INFINITY?"+inf.0":this===t.NEG_INFINITY?"-inf.0":this===t.NAN?"+nan.0":this.value.toString()},t.INEXACT_ZERO=new t(0),t.INEXACT_NEG_ZERO=new t(-0),t.INFINITY=new t(1/0),t.NEG_INFINITY=new t(-1/0),t.NAN=new t(NaN),t}(),X=function(){function t(t,n){this.numberType=x.COMPLEX,this.real=t,this.imaginary=n}return t.build=function(n,e,r){return void 0===r&&(r=!1),t.simplify(new t(n,e),r)},t.simplify=function(t,n){return!n&&Z(t.imaginary,F.EXACT_ZERO)?t.real:t},t.prototype.promote=function(t){if(t===x.COMPLEX)return this;throw new Error("Unable to demote complex")},t.prototype.negate=function(){return t.build(this.real.negate(),this.imaginary.negate())},t.prototype.equals=function(t){return Z(this.real,t.real)&&Z(this.imaginary,t.imaginary)},t.prototype.greaterThan=function(t){return W(this.real,t.real)&&W(this.imaginary,t.imaginary)},t.prototype.multiplicativeInverse=function(){var n=$(J(this.real,this.real),J(this.imaginary,this.imaginary));return t.build(J(n.multiplicativeInverse(),this.real),J(n.multiplicativeInverse(),this.imaginary.negate()))},t.prototype.add=function(n){return t.build($(this.real,n.real),$(this.imaginary,n.imaginary))},t.prototype.multiply=function(n){var e,r,i=(e=J(this.real,n.real),r=J(this.imaginary,n.imaginary),$(e,function(t){return t.negate()}(r))),o=$(J(this.real,n.imaginary),J(this.imaginary,n.real));return t.build(i,o)},t.prototype.getReal=function(){return this.real},t.prototype.getImaginary=function(){return this.imaginary},t.prototype.coerce=function(){throw new Error("Cannot coerce a complex number to a javascript number")},t.prototype.toPolar=function(){var t=this.real.promote(x.REAL),n=this.imaginary.promote(x.REAL),e=G.build(Math.sqrt(t.coerce()*t.coerce()+n.coerce()*n.coerce())),r=G.build(Math.atan2(n.coerce(),t.coerce()));return j.build(e,r)},t.prototype.toString=function(){return"".concat(this.real,"+").concat(this.imaginary,"i")},t}(),j=function(){function t(t,n){this.magnitude=t,this.angle=n}return t.build=function(n,e){return new t(n,e)},t.prototype.toCartesian=function(){var t=G.build(this.magnitude.coerce()*Math.cos(this.angle.coerce())),n=G.build(this.magnitude.coerce()*Math.sin(this.angle.coerce()));return X.build(t,n)},t}();function K(t){switch(t.numberType){case x.INTEGER:return t;case x.RATIONAL:return 1n===t.getDenominator()?F.build(t.getNumerator()):t;case x.REAL:return t;case x.COMPLEX:return X.build(K(t.getReal()),K(t.getImaginary()))}}function Y(t,n){return t.numberType>n.numberType?[t,n.promote(t.numberType)]:t.numberType<n.numberType?[t.promote(n.numberType),n]:[t,n]}function Z(t,n){var e=Y(t,n),r=e[0],i=e[1];return r.equals(i)}function W(t,n){var e=Y(t,n),r=e[0],i=e[1];return r.greaterThan(i)}function $(t,n){var e=Y(t,n),r=e[0],i=e[1];return K(r.add(i))}function J(t,n){var e=Y(t,n),r=e[0],i=e[1];return K(r.multiply(i))}G.INFINITY,G.NAN,G.build(Math.PI),G.build(Math.E),G.build(Math.SQRT2),G.build(Math.LN2),G.build(Math.LN10),G.build(Math.LOG2E),G.build(Math.LOG10E),G.build(Math.SQRT1_2);var tt,nt=function(){function t(t,n){this.start=t,this.end=n}return t.prototype.merge=function(n){return new t(this.start,n.end)},t}(),et=function(t,n){this.line=t,this.column=n};function rt(t,n){return t.split("\n")[n.line-1]}function it(t){return"^".padStart(t.column," ")}!function(t){t[t.LEFT_PAREN=0]="LEFT_PAREN",t[t.RIGHT_PAREN=1]="RIGHT_PAREN",t[t.LEFT_BRACKET=2]="LEFT_BRACKET",t[t.RIGHT_BRACKET=3]="RIGHT_BRACKET",t[t.DOT=4]="DOT",t[t.HASH_SEMICOLON=5]="HASH_SEMICOLON",t[t.IDENTIFIER=6]="IDENTIFIER",t[t.NUMBER=7]="NUMBER",t[t.BOOLEAN=8]="BOOLEAN",t[t.STRING=9]="STRING",t[t.IF=10]="IF",t[t.LET=11]="LET",t[t.COND=12]="COND",t[t.ELSE=13]="ELSE",t[t.DEFINE=14]="DEFINE",t[t.LAMBDA=15]="LAMBDA",t[t.APOSTROPHE=16]="APOSTROPHE",t[t.BACKTICK=17]="BACKTICK",t[t.COMMA=18]="COMMA",t[t.COMMA_AT=19]="COMMA_AT",t[t.QUOTE=20]="QUOTE",t[t.QUASIQUOTE=21]="QUASIQUOTE",t[t.UNQUOTE=22]="UNQUOTE",t[t.UNQUOTE_SPLICING=23]="UNQUOTE_SPLICING",t[t.SET=24]="SET",t[t.BEGIN=25]="BEGIN",t[t.DELAY=26]="DELAY",t[t.IMPORT=27]="IMPORT",t[t.EXPORT=28]="EXPORT",t[t.DEFINE_SYNTAX=29]="DEFINE_SYNTAX",t[t.SYNTAX_RULES=30]="SYNTAX_RULES",t[t.HASH_VECTOR=31]="HASH_VECTOR",t[t.VECTOR=32]="VECTOR",t[t.EOF=33]="EOF"}(tt||(tt={}));var ot=function(t){function n(n,e){var r=t.call(this,"Syntax error at (".concat(e.line,":").concat(e.column,")\n").concat(n))||this;return r.loc=e,r}return i(n,t),n.prototype.toString=function(){return this.message},n}(SyntaxError);!function(t){function n(n,e){var r=t.call(this,rt(n,e)+"\n"+it(e),e)||this;return r.name="GenericSyntaxError",r}i(n,t)}(ot),function(t){function n(n,e){var r=t.call(this,rt(n,e)+"\n"+it(e)+"\nMismatched parenthesis",e)||this;return r.name="ParenthesisMismatchError",r}i(n,t)}(ot);var at=function(t){function n(n,e){var r=t.call(this,rt(n,e)+"\nUnexpected EOF",e)||this;return r.name="UnexpectedEOFError",r}return i(n,t),n}(ot),ut=function(t){function n(n,e,r){var i=t.call(this,rt(n,e)+"\n"+it(e)+"\n"+"Unexpected '".concat(r,"'"),e)||this;return i.form=r,i.name="UnexpectedTokenError",i}return i(n,t),n}(ot),st=function(t){function n(n,e,r,i){var o=t.call(this,rt(n,e)+"\n"+it(e)+"\n"+"Expected '".concat(i,"' but got '").concat(r,"'"),e)||this;return o.form=r,o.expected=i,o.name="ExpectedTokenError",o}return i(n,t),n}(ot);!function(t){function n(n,e,r){var i=t.call(this,rt(n,e)+"\n"+it(e)+"\n"+"Expected '".concat(r,"'"),e)||this;return i.expected=r,i.name="MissingTokenError",i}i(n,t)}(ot);var ct=function(t){function n(n,e,r,i){var o=t.call(this,rt(n,e)+"\n"+it(e)+"\n"+"Syntax '".concat(r,"' not allowed at Scheme §").concat(i),e)||this;return o.token=r,o.name="DisallowedTokenError",o}return i(n,t),n}(ot),pt=function(t){function n(n,e,r){var i=t.call(this,rt(n,e)+"\n"+it(e)+"\n"+"Syntax '".concat(r,"' not supported yet"),e)||this;return i.token=r,i.name="UnsupportedTokenError",i}return i(n,t),n}(ot),ht=function(){function t(t){this.elements=t,this.location=new nt(this.firstPos(),this.lastPos())}return t.build=function(n){if(0===n.length)throw new Error("Illegal empty group. This should never happen.");if(1===n.length){var e=n[0];if(lt(e))return e;if((r=e).type!==tt.IDENTIFIER&&r.type!==tt.NUMBER&&r.type!==tt.STRING&&r.type!==tt.BOOLEAN)throw new st("",e.pos,e,"<data>");return new t(n)}var r;if(2===n.length){var i=n[0];if(ft(i)&&function(t){return t.type===tt.APOSTROPHE||t.type===tt.BACKTICK||t.type===tt.HASH_VECTOR||t.type===tt.COMMA||t.type===tt.COMMA_AT}(i))return new t(n)}var o,a,u=n[0],s=n[n.length-1];if(ft(u)&&ft(s)&&(a=s,(o=u).type===tt.LEFT_PAREN&&a.type===tt.RIGHT_PAREN||o.type===tt.LEFT_BRACKET&&a.type===tt.RIGHT_BRACKET))return new t(n);var c=new t(n);throw new st("",c.location.start,c,"matching parentheses")},t.prototype.first=function(){return this.elements[0]},t.prototype.firstToken=function(){var t=this.first();return ft(t)?t:t.firstToken()},t.prototype.firstPos=function(){return this.firstToken().pos},t.prototype.last=function(){return this.elements[this.elements.length-1]},t.prototype.lastToken=function(){var t=this.last();return ft(t)?t:t.lastToken()},t.prototype.lastPos=function(){return this.lastToken().pos},t.prototype.isParenthesized=function(){var t=this.first();return ft(t)&&(t.type===tt.LEFT_PAREN||t.type===tt.LEFT_BRACKET)},t.prototype.isSingleIdentifier=function(){return!this.isParenthesized()&&1===this.length()},t.prototype.unwrap=function(){return this.isParenthesized()?this.elements.slice(1,this.elements.length-1):this.elements},t.prototype.length=function(){return this.unwrap().length},t.prototype.toString=function(){return this.elements.map((function(t){return t.toString()})).join(" ")},t}();function ft(t){return t instanceof vt}function lt(t){return t instanceof ht}var yt,wt,vt=function(){function t(t,n,e,r,i,o,a){this.type=t,this.lexeme=n,this.literal=e,this.start=r,this.end=i,this.pos=new et(o,a),this.endPos=new et(o,a+n.length-1)}return t.prototype.convertToken=function(){switch(this.type){case tt.APOSTROPHE:return new t(tt.QUOTE,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case tt.BACKTICK:return new t(tt.QUASIQUOTE,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case tt.HASH_VECTOR:return new t(tt.VECTOR,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case tt.COMMA:return new t(tt.UNQUOTE,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case tt.COMMA_AT:return new t(tt.UNQUOTE_SPLICING,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);default:return this}},t.prototype.toString=function(){return"".concat(this.lexeme)},t}(),dt=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.loc={line:e,column:r},i}return i(n,t),n.prototype.toString=function(){return this.message},n}(SyntaxError),mt=function(t){function n(n,e,r){var i=t.call(this,"Unexpected character '".concat(r,"' (").concat(n,":").concat(e,")"),n,e)||this;return i.char=r,i.name="UnexpectedCharacterError",i}return i(n,t),n}(dt),gt=function(t){function n(n,e){var r=t.call(this,"Unexpected EOF (".concat(n,":").concat(e,")"),n,e)||this;return r.name="UnexpectedEOFError",r}return i(n,t),n}(dt),Et=new Map([[".",tt.DOT],["if",tt.IF],["let",tt.LET],["cond",tt.COND],["else",tt.ELSE],["set!",tt.SET],["begin",tt.BEGIN],["delay",tt.DELAY],["quote",tt.QUOTE],["export",tt.EXPORT],["import",tt.IMPORT],["define",tt.DEFINE],["lambda",tt.LAMBDA],["define-syntax",tt.DEFINE_SYNTAX],["syntax-rules",tt.SYNTAX_RULES]]),Tt=function(){function t(t){this.start=0,this.current=0,this.line=1,this.col=0,this.source=t,this.tokens=[]}return t.prototype.isAtEnd=function(){return this.current>=this.source.length},t.prototype.advance=function(){return this.col++,this.source.charAt(this.current++)},t.prototype.jump=function(){this.start=this.current,this.col++,this.current++},t.prototype.addToken=function(t,n){void 0===n&&(n=null);var e=this.source.substring(this.start,this.current);this.tokens.push(new vt(t,e,n,this.start,this.current,this.line,this.col))},t.prototype.scanTokens=function(){for(;!this.isAtEnd();)this.start=this.current,this.scanToken();return this.tokens.push(new vt(tt.EOF,"",null,this.start,this.current,this.line,this.col)),this.tokens},t.prototype.scanToken=function(){var t=this.advance();switch(t){case"(":this.addToken(tt.LEFT_PAREN);break;case")":this.addToken(tt.RIGHT_PAREN);break;case"[":this.addToken(tt.LEFT_BRACKET);break;case"]":this.addToken(tt.RIGHT_BRACKET);break;case"'":this.addToken(tt.APOSTROPHE);break;case"`":this.addToken(tt.BACKTICK);break;case",":if(this.match("@")){this.addToken(tt.COMMA_AT);break}this.addToken(tt.COMMA);break;case"#":if(this.match("t")||this.match("f"))this.booleanToken();else if(this.match("|"))this.comment();else if(this.match(";"))this.addToken(tt.HASH_SEMICOLON);else{if("("!==this.peek()&&"["!==this.peek())throw new mt(this.line,this.col,t);this.addToken(tt.HASH_VECTOR)}break;case";":for(;"\n"!=this.peek()&&!this.isAtEnd();)this.advance();break;case" ":case"\r":case"\t":break;case"\n":this.line++,this.col=0;break;case'"':this.stringToken();break;case"|":this.identifierTokenLoose();break;default:if(this.isDigit(t)||"-"===t||"+"===t||"."===t||"i"===t||"n"===t)this.identifierNumberToken();else{if(!this.isValidIdentifier(t))throw new mt(this.line,this.col,t);this.identifierToken()}}},t.prototype.comment=function(){for(;("|"!=this.peek()||"#"!=this.peekNext())&&!this.isAtEnd();)"\n"===this.peek()&&(this.line++,this.col=0),this.advance();if(this.isAtEnd())throw new gt(this.line,this.col);this.jump(),this.jump()},t.prototype.identifierToken=function(){for(;this.isValidIdentifier(this.peek());)this.advance();this.addToken(this.checkKeyword())},t.prototype.identifierTokenLoose=function(){for(this.advance();"|"!=this.peek()&&!this.isAtEnd();)"\n"===this.peek()&&(this.line++,this.col=0),this.advance();if(this.isAtEnd())throw new gt(this.line,this.col);this.advance(),this.addToken(this.checkKeyword())},t.prototype.identifierNumberToken=function(){for(;this.isValidIdentifier(this.peek());)this.advance();var t=this.source.substring(this.start,this.current);Q(t,x.COMPLEX).result?this.addToken(tt.NUMBER,t):this.addToken(this.checkKeyword())},t.prototype.checkKeyword=function(){var t=this.source.substring(this.start,this.current);return Et.has(t)?Et.get(t):tt.IDENTIFIER},t.prototype.stringToken=function(){for(;'"'!=this.peek()&&!this.isAtEnd();)"\n"===this.peek()&&(this.line++,this.col=0),this.advance();if(this.isAtEnd())throw new gt(this.line,this.col);this.advance();var t=this.source.substring(this.start+1,this.current-1);this.addToken(tt.STRING,t)},t.prototype.booleanToken=function(){this.addToken(tt.BOOLEAN,"t"===this.peekPrev())},t.prototype.match=function(t){return!this.isAtEnd()&&(this.source.charAt(this.current)==t&&(this.current++,!0))},t.prototype.peek=function(){return this.isAtEnd()?"\0":this.source.charAt(this.current)},t.prototype.peekNext=function(){return this.current+1>=this.source.length?"\0":this.source.charAt(this.current+1)},t.prototype.peekPrev=function(){return this.current-1<0?"\0":this.source.charAt(this.current-1)},t.prototype.isDigit=function(t){return t>="0"&&t<="9"},t.prototype.isSpecialSyntax=function(t){return"("===t||")"===t||"["===t||"]"===t||";"===t||"|"===t},t.prototype.isValidIdentifier=function(t){return!this.isWhitespace(t)&&!this.isSpecialSyntax(t)},t.prototype.isWhitespace=function(t){return" "===t||"\0"===t||"\n"===t||"\r"===t||"\t"===t},t}();!function(t){var n=function(){function t(t,n){this.location=t,this.expressions=n}return t.prototype.accept=function(t){return t.visitSequence(this)},t.prototype.equals=function(n){if(n instanceof t){if(this.expressions.length!==n.expressions.length)return!1;for(var e=0;e<this.expressions.length;e++)if(!this.expressions[e].equals(n.expressions[e]))return!1;return!0}return!1},t}();t.Sequence=n;var e=function(){function t(t,n){this.location=t,this.value=n}return t.prototype.accept=function(t){return t.visitNumericLiteral(this)},t.prototype.equals=function(n){return n instanceof t&&this.value===n.value},t}();t.NumericLiteral=e;var r=function(){function t(t,n){this.location=t,this.value=n}return t.prototype.accept=function(t){return t.visitBooleanLiteral(this)},t.prototype.equals=function(n){return n instanceof t&&this.value===n.value},t}();t.BooleanLiteral=r;var i=function(){function t(t,n){this.location=t,this.value=n}return t.prototype.accept=function(t){return t.visitStringLiteral(this)},t.prototype.equals=function(n){return n instanceof t&&this.value===n.value},t}();t.StringLiteral=i;var o=function(){function t(t,n,e,r){void 0===r&&(r=void 0),this.location=t,this.params=e,this.rest=r,this.body=n}return t.prototype.accept=function(t){return t.visitLambda(this)},t.prototype.equals=function(n){if(n instanceof t){if(this.params.length!==n.params.length)return!1;for(var e=0;e<this.params.length;e++)if(!this.params[e].equals(n.params[e]))return!1;if(this.rest&&n.rest){if(!this.rest.equals(n.rest))return!1}else if(this.rest||n.rest)return!1;return this.body.equals(n.body)}return!1},t}();t.Lambda=o;var a=function(){function t(t,n){this.location=t,this.name=n}return t.prototype.accept=function(t){return t.visitIdentifier(this)},t.prototype.equals=function(n){return n instanceof t&&this.name===n.name},t}();t.Identifier=a;var u=function(){function t(t,n,e){this.location=t,this.name=n,this.value=e}return t.prototype.accept=function(t){return t.visitDefinition(this)},t.prototype.equals=function(n){return n instanceof t&&(this.name.equals(n.name)&&this.value.equals(n.value))},t}();t.Definition=u;var s=function(){function t(t,n,e){this.location=t,this.operator=n,this.operands=e}return t.prototype.accept=function(t){return t.visitApplication(this)},t.prototype.equals=function(n){if(n instanceof t){if(!this.operator.equals(n.operator))return!1;if(this.operands.length!==n.operands.length)return!1;for(var e=0;e<this.operands.length;e++)if(!this.operands[e].equals(n.operands[e]))return!1;return!0}return!1},t}();t.Application=s;var c=function(){function t(t,n,e,r){this.location=t,this.test=n,this.consequent=e,this.alternate=r}return t.prototype.accept=function(t){return t.visitConditional(this)},t.prototype.equals=function(n){return n instanceof t&&(this.test.equals(n.test)&&this.consequent.equals(n.consequent)&&this.alternate.equals(n.alternate))},t}();t.Conditional=c;var p=function(){function t(t,n,e){this.location=t,this.car=n,this.cdr=e}return t.prototype.accept=function(t){return t.visitPair(this)},t.prototype.equals=function(n){return n instanceof t&&(this.car.equals(n.car)&&this.cdr.equals(n.cdr))},t}();t.Pair=p;var h=function(){function t(t){this.location=t}return t.prototype.accept=function(t){return t.visitNil(this)},t.prototype.equals=function(n){return n instanceof t},t}();t.Nil=h;var f=function(){function t(t,n){this.location=t,this.value=n}return t.prototype.accept=function(t){return t.visitSymbol(this)},t.prototype.equals=function(n){return n instanceof t&&this.value===n.value},t}();t.Symbol=f;var l=function(){function t(t,n){this.location=t,this.value=n}return t.prototype.accept=function(t){return t.visitSpliceMarker(this)},t.prototype.equals=function(n){return n instanceof t&&this.value.equals(n.value)},t}();t.SpliceMarker=l;var y=function(){function t(t,n,e){this.location=t,this.name=n,this.value=e}return t.prototype.accept=function(t){return t.visitReassignment(this)},t.prototype.equals=function(n){return n instanceof t&&(this.name.equals(n.name)&&this.value.equals(n.value))},t}();t.Reassignment=y;var w=function(){function t(t,n,e){this.location=t,this.source=n,this.identifiers=e}return t.prototype.accept=function(t){return t.visitImport(this)},t.prototype.equals=function(n){if(n instanceof t){if(!this.source.equals(n.source))return!1;if(this.identifiers.length!==n.identifiers.length)return!1;for(var e=0;e<this.identifiers.length;e++)if(!this.identifiers[e].equals(n.identifiers[e]))return!1;return!0}return!1},t}();t.Import=w;var v=function(){function t(t,n){this.location=t,this.definition=n}return t.prototype.accept=function(t){return t.visitExport(this)},t.prototype.equals=function(n){return n instanceof t&&this.definition.equals(n.definition)},t}();t.Export=v;var d=function(){function t(t,n){this.location=t,this.elements=n}return t.prototype.accept=function(t){return t.visitVector(this)},t.prototype.equals=function(n){if(n instanceof t){if(this.elements.length!==n.elements.length)return!1;for(var e=0;e<this.elements.length;e++)if(!this.elements[e].equals(n.elements[e]))return!1;return!0}return!1},t}();t.Vector=d;var m=function(){function t(t,n,e){this.location=t,this.name=n,this.transformer=e}return t.prototype.accept=function(t){return t.visitDefineSyntax(this)},t.prototype.equals=function(n){return n instanceof t&&(this.name.equals(n.name)&&this.transformer.equals(n.transformer))},t}();t.DefineSyntax=m;var g=function(){function t(t,n,e){this.location=t,this.literals=n,this.rules=e}return t.prototype.accept=function(t){return t.visitSyntaxRules(this)},t.prototype.equals=function(n){if(n instanceof t){if(this.literals.length!==n.literals.length)return!1;for(var e=0;e<this.literals.length;e++)if(!this.literals[e].equals(n.literals[e]))return!1;if(this.rules.length!==n.rules.length)return!1;for(e=0;e<this.rules.length;e++)if(!this.rules[e][0].equals(n.rules[e][0])||!this.rules[e][1].equals(n.rules[e][1]))return!1;return!0}return!1},t}();t.SyntaxRules=g}(yt||(yt={})),function(t){var n=function(){function t(t,n,e,r,i){void 0===i&&(i=void 0),this.location=t,this.name=n,this.body=e,this.params=r,this.rest=i}return t.prototype.accept=function(t){return t.visitFunctionDefinition(this)},t.prototype.equals=function(n){if(n instanceof t){if(this.params.length!==n.params.length)return!1;for(var e=0;e<this.params.length;e++)if(!this.params[e].equals(n.params[e]))return!1;if(this.rest&&n.rest){if(!this.rest.equals(n.rest))return!1}else if(this.rest||n.rest)return!1;return this.body.equals(n.body)}return!1},t}();t.FunctionDefinition=n;var e=function(){function t(t,n,e,r){this.location=t,this.identifiers=n,this.values=e,this.body=r}return t.prototype.accept=function(t){return t.visitLet(this)},t.prototype.equals=function(n){if(n instanceof t){if(this.identifiers.length!==n.identifiers.length)return!1;for(var e=0;e<this.identifiers.length;e++)if(!this.identifiers[e].equals(n.identifiers[e]))return!1;if(this.values.length!==n.values.length)return!1;for(e=0;e<this.values.length;e++)if(!this.values[e].equals(n.values[e]))return!1;return this.body.equals(n.body)}return!1},t}();t.Let=e;var r=function(){function t(t,n,e,r){this.location=t,this.predicates=n,this.consequents=e,this.catchall=r}return t.prototype.accept=function(t){return t.visitCond(this)},t.prototype.equals=function(n){if(n instanceof t){if(this.predicates.length!==n.predicates.length)return!1;for(var e=0;e<this.predicates.length;e++)if(!this.predicates[e].equals(n.predicates[e]))return!1;if(this.consequents.length!==n.consequents.length)return!1;for(e=0;e<this.consequents.length;e++)if(!this.consequents[e].equals(n.consequents[e]))return!1;return this.catchall&&n.catchall?this.catchall.equals(n.catchall):!this.catchall&&!n.catchall}return!1},t}();t.Cond=r;var i=function(){function t(t,n,e){void 0===e&&(e=void 0),this.location=t,this.elements=n,this.terminator=e}return t.prototype.accept=function(t){return t.visitList(this)},t.prototype.equals=function(n){if(n instanceof t){if(this.elements.length!==n.elements.length)return!1;for(var e=0;e<this.elements.length;e++)if(!this.elements[e].equals(n.elements[e]))return!1;return this.terminator&&n.terminator?this.terminator.equals(n.terminator):!this.terminator&&!n.terminator}return!1},t}();t.List=i;var o=function(){function t(t,n){this.location=t,this.expressions=n}return t.prototype.accept=function(t){return t.visitBegin(this)},t.prototype.equals=function(n){if(n instanceof t){if(this.expressions.length!==n.expressions.length)return!1;for(var e=0;e<this.expressions.length;e++)if(!this.expressions[e].equals(n.expressions[e]))return!1;return!0}return!1},t}();t.Begin=o;var a=function(){function t(t,n){this.location=t,this.expression=n}return t.prototype.accept=function(t){return t.visitDelay(this)},t.prototype.equals=function(n){return n instanceof t&&this.expression.equals(n.expression)},t}();t.Delay=a}(wt||(wt={}));var Pt;!function(t){t[t.NONE=0]="NONE",t[t.QUOTE=1]="QUOTE",t[t.QUASIQUOTE=2]="QUASIQUOTE"}(Pt||(Pt={}));var bt=function(){function t(t,n,e){void 0===e&&(e=1/0),this.current=0,this.quoteMode=Pt.NONE,this.source=t,this.tokens=n,this.chapter=e}return t.prototype.advance=function(){return this.isAtEnd()||this.current++,this.previous()},t.prototype.isAtEnd=function(){return this.current>=this.tokens.length},t.prototype.previous=function(){return this.tokens[this.current-1]},t.prototype.peek=function(){return this.tokens[this.current]},t.prototype.validateChapter=function(t,n){if(this.chapter<n)throw new ct(this.source,t.pos,t,this.chapter)},t.prototype.toLocation=function(t){return new nt(t.pos,t.endPos)},t.prototype.destructureList=function(t,n){if(void 0===n&&(n=function(t){}),0===t.length)return[[],void 0];if(1===t.length)return n(t[0]),[[this.parseExpression(t[0])],void 0];var e=t.at(-2);if(ft(e)&&e.type===tt.DOT){var r=t.at(-1),i=t.slice(0,-2);return n(r),i.forEach(n),[i.map(this.parseExpression.bind(this)),this.parseExpression(r)]}var o=t;return o.forEach(n),[o.map(this.parseExpression.bind(this)),void 0]},t.prototype.grouping=function(t){var n=[],e=!1;t&&(e=!0,n.push(t));do{var r=this.advance();switch(r.type){case tt.LEFT_PAREN:case tt.LEFT_BRACKET:var i=this.grouping(r);n.push(i);break;case tt.RIGHT_PAREN:case tt.RIGHT_BRACKET:if(!e)throw new ut(this.source,r.pos,r);n.push(r),e=!1;break;case tt.APOSTROPHE:case tt.BACKTICK:case tt.COMMA:case tt.COMMA_AT:case tt.HASH_VECTOR:var o=void 0;do{o=this.grouping()}while(!o);n.push(this.affect(r,o));break;case tt.QUOTE:case tt.QUASIQUOTE:case tt.UNQUOTE:case tt.UNQUOTE_SPLICING:case tt.IDENTIFIER:case tt.NUMBER:case tt.BOOLEAN:case tt.STRING:case tt.DOT:case tt.DEFINE:case tt.IF:case tt.ELSE:case tt.COND:case tt.LAMBDA:case tt.LET:case tt.SET:case tt.BEGIN:case tt.DELAY:case tt.IMPORT:case tt.EXPORT:case tt.DEFINE_SYNTAX:case tt.SYNTAX_RULES:n.push(r);break;case tt.HASH_SEMICOLON:for(;!this.grouping(););break;case tt.EOF:throw new at(this.source,r.pos);default:throw new ut(this.source,r.pos,r)}}while(e);if(0!==n.length)try{return ht.build(n)}catch(t){if(t instanceof st)throw new st(this.source,t.loc,t.form,t.expected);throw t}},t.prototype.affect=function(t,n){return ht.build([t,n])},t.prototype.parseExpression=function(t){return ft(t)?this.parseToken(t):t.isSingleIdentifier()?this.parseToken(t.unwrap()[0]):this.parseGroup(t)},t.prototype.parseToken=function(t){switch(t.type){case tt.IDENTIFIER:return this.quoteMode===Pt.NONE?new yt.Identifier(this.toLocation(t),t.lexeme):new yt.Symbol(this.toLocation(t),t.lexeme);case tt.NUMBER:return new yt.NumericLiteral(this.toLocation(t),t.literal);case tt.BOOLEAN:return new yt.BooleanLiteral(this.toLocation(t),t.literal);case tt.STRING:return new yt.StringLiteral(this.toLocation(t),t.literal);default:if(this.quoteMode!==Pt.NONE||this.chapter>=5)return new yt.Symbol(this.toLocation(t),t.lexeme);throw new ut(this.source,t.pos,t)}},t.prototype.parseGroup=function(t){if(!t.isParenthesized())return this.parseAffectorGroup(t);switch(this.quoteMode){case Pt.NONE:return this.parseNormalGroup(t);case Pt.QUOTE:case Pt.QUASIQUOTE:return this.parseQuotedGroup(t)}},t.prototype.parseAffectorGroup=function(t){var n=t.unwrap(),e=n[0],r=n[1];switch(e.type){case tt.APOSTROPHE:case tt.QUOTE:if(this.validateChapter(e,2),this.quoteMode!==Pt.NONE){var i=this.parseExpression(r),o=(l=new yt.Symbol(this.toLocation(e),"quote")).location.merge(i.location);return new wt.List(o,[l,i])}this.quoteMode=Pt.QUOTE;var a=this.parseExpression(r);return this.quoteMode=Pt.NONE,a;case tt.BACKTICK:case tt.QUASIQUOTE:if(this.validateChapter(e,2),this.quoteMode!==Pt.NONE){i=this.parseExpression(r);var u=(l=new yt.Symbol(this.toLocation(e),"quasiquote")).location.merge(i.location);return new wt.List(u,[l,i])}this.quoteMode=Pt.QUASIQUOTE;var s=this.parseExpression(r);return this.quoteMode=Pt.NONE,s;case tt.COMMA:case tt.UNQUOTE:this.validateChapter(e,2);var c=this.quoteMode;if(c===Pt.NONE)throw new pt(this.source,e.pos,e);if(c===Pt.QUOTE){i=this.parseExpression(r);var p=(l=new yt.Symbol(this.toLocation(e),"unquote")).location.merge(i.location);return new wt.List(p,[l,i])}this.quoteMode=Pt.NONE;var h=this.parseExpression(r);return this.quoteMode=c,h;case tt.COMMA_AT:case tt.UNQUOTE_SPLICING:this.validateChapter(e,2);var f=this.quoteMode;if(f===Pt.NONE)throw new ut(this.source,e.pos,e);if(f===Pt.QUOTE){i=this.parseExpression(r);var l,y=(l=new yt.Symbol(this.toLocation(e),"unquote-splicing")).location.merge(i.location);return new wt.List(y,[l,i])}this.quoteMode=Pt.NONE;var w=this.parseExpression(r);this.quoteMode=f;var v=this.toLocation(e).merge(w.location);return new yt.SpliceMarker(v,w);case tt.HASH_VECTOR:this.validateChapter(e,3);var d=this.quoteMode;this.quoteMode=Pt.QUOTE;var m=this.parseVector(t);return this.quoteMode=d,m;default:throw new ut(this.source,e.pos,e)}},t.prototype.parseNormalGroup=function(t){if(0===t.length()){if(this.chapter>=5)return new yt.Nil(t.location);throw new st(this.source,t.location.start,t,"non-empty group")}var n=t.unwrap()[0];if(ft(n))switch(n.type){case tt.LAMBDA:return this.validateChapter(n,1),this.parseLambda(t);case tt.DEFINE:return this.validateChapter(n,1),this.parseDefinition(t);case tt.IF:return this.validateChapter(n,1),this.parseConditional(t);case tt.LET:return this.validateChapter(n,1),this.parseLet(t);case tt.COND:return this.validateChapter(n,1),this.parseExtendedCond(t);case tt.QUOTE:case tt.APOSTROPHE:case tt.QUASIQUOTE:case tt.BACKTICK:case tt.UNQUOTE:case tt.COMMA:case tt.UNQUOTE_SPLICING:case tt.COMMA_AT:return this.validateChapter(n,2),this.parseAffectorGroup(t);case tt.BEGIN:return this.validateChapter(n,3),this.parseBegin(t);case tt.DELAY:return this.validateChapter(n,3),this.parseDelay(t);case tt.SET:return this.validateChapter(n,3),this.parseSet(t);case tt.DEFINE_SYNTAX:return this.validateChapter(n,5),this.parseDefineSyntax(t);case tt.SYNTAX_RULES:throw new ut(this.source,n.pos,n);case tt.IMPORT:return this.validateChapter(n,1),this.parseImport(t);case tt.EXPORT:return this.validateChapter(n,1),this.parseExport(t);case tt.VECTOR:return this.validateChapter(n,3),this.parseAffectorGroup(t);default:return this.parseApplication(t)}return this.parseApplication(t)},t.prototype.parseQuotedGroup=function(t){if(0===t.length())return new yt.Nil(t.location);if(1===t.length()){var n=[this.parseExpression(t.unwrap()[0])];return new wt.List(t.location,n)}var e=t.unwrap(),r=this.destructureList(e),i=r[0],o=r[1];return new wt.List(t.location,i,o)},t.prototype.parseLambda=function(t){var n,e=this;if(t.length()<3)throw new st(this.source,t.location.start,t,"(lambda (<identifier>* . <rest-identifier>?) <body>+) | (lambda <rest-identifer> <body>+)");var r=t.unwrap(),i=r[1],o=r.slice(2),a=[],u=void 0;if(ft(i)){if(i.type!==tt.IDENTIFIER)throw new st(this.source,i.pos,i,"<rest-identifier>");u=new yt.Identifier(this.toLocation(i),i.lexeme)}else{var s=i.unwrap();a=(n=this.destructureList(s,(function(t){if(!ft(t))throw new st(e.source,t.pos,t,"<identifier>");if(t.type!==tt.IDENTIFIER)throw new st(e.source,t.pos,t,"<identifier>")})))[0],u=n[1]}var c=o.map(this.parseExpression.bind(this));if(c.length<1)throw new st(this.source,t.location.start,t,"(lambda ... <body>+)");if(1===c.length)return new yt.Lambda(t.location,c[0],a,u);var p=c.at(0).location.merge(c.at(-1).location),h=new yt.Sequence(p,c);return new yt.Lambda(t.location,h,a,u)},t.prototype.parseDefinition=function(t){var n,e=this;if(t.length()<3)throw new st(this.source,t.location.start,t,"(define <identifier> <expr>) | (define (<identifier> <formals>) <body>+)");var r,i=t.unwrap(),o=i[1],a=i.slice(2),u=[],s=void 0,c=!1;if(lt(o)){c=!0;var p=o.unwrap(),h=p[0],f=p.splice(1);if(!ft(h))throw new st(this.source,h.location.start,h,"<identifier>");if(h.type!==tt.IDENTIFIER)throw new st(this.source,h.pos,h,"<identifier>");r=new yt.Identifier(this.toLocation(h),h.lexeme),u=(n=this.destructureList(f,(function(t){if(!ft(t))throw new st(e.source,t.pos,t,"<identifier>");if(t.type!==tt.IDENTIFIER)throw new st(e.source,t.pos,t,"<identifier>")})))[0],s=n[1]}else{if(o.type!==tt.IDENTIFIER)throw new st(this.source,o.pos,o,"<identifier>");r=new yt.Identifier(this.toLocation(o),o.lexeme),c=!1}if(a.length<1)throw new st(this.source,t.location.start,t,"(define ... <body>+)");if(c){var l=a.map(this.parseExpression.bind(this));if(1===l.length)return new wt.FunctionDefinition(t.location,r,l[0],u,s);var y=l.at(0).location.merge(l.at(-1).location),w=new yt.Sequence(y,l);return new wt.FunctionDefinition(t.location,r,w,u,s)}if(a.length>1)throw new st(this.source,t.location.start,t,"(define <identifier> <expr>)");var v=this.parseExpression(a[0]);return new yt.Definition(t.location,r,v)},t.prototype.parseConditional=function(t){if(t.length()<3||t.length()>4)throw new st(this.source,t.location.start,t,"(if <pred> <cons> <alt>?)");var n=t.unwrap(),e=n[1],r=n[2],i=t.length()>3?n[3]:void 0,o=this.parseExpression(e),a=this.parseExpression(r),u=i?this.parseExpression(i):new yt.Identifier(t.location,"undefined");return new yt.Conditional(t.location,o,a,u)},t.prototype.parseApplication=function(t){if(t.length()<1)throw new st(this.source,t.location.start,t,"(<func> <args>*)");for(var n=t.unwrap(),e=n[0],r=n.splice(1),i=this.parseExpression(e),o=[],a=0,u=r;a<u.length;a++){var s=u[a];o.push(this.parseExpression(s))}return new yt.Application(t.location,i,o)},t.prototype.parseLet=function(t){var n=this;if(this.chapter>=5)return t.unwrap().slice(1).forEach((function(t){n.parseExpression(t)})),new wt.Let(t.location,[],[],new yt.Identifier(t.location,"undefined"));if(t.length()<3)throw new st(this.source,t.location.start,t,"(let ((<identifier> <value>)*) <body>+)");var e=t.unwrap(),r=e[1],i=e.slice(2);if(!lt(r))throw new st(this.source,r.pos,r,"((<identifier> <value>)*)");for(var o=[],a=[],u=0,s=r.unwrap();u<s.length;u++){var c=s[u];if(!lt(c))throw new st(this.source,c.pos,c,"(<identifier> <value>)");if(2!==c.length())throw new st(this.source,c.location.start,c,"(<identifier> <value>)");var p=c.unwrap(),h=p[0],f=p[1];if(!ft(h))throw new st(this.source,h.location.start,h,"<identifier>");if(h.type!==tt.IDENTIFIER)throw new st(this.source,h.pos,h,"<identifier>");o.push(new yt.Identifier(this.toLocation(h),h.lexeme)),a.push(this.parseExpression(f))}var l=i.map(this.parseExpression.bind(this));if(l.length<1)throw new st(this.source,t.location.start,t,"(let ... <body>+)");if(1===l.length)return new wt.Let(t.location,o,a,l[0]);var y=l.at(0).location.merge(l.at(-1).location),w=new yt.Sequence(y,l);return new wt.Let(t.location,o,a,w)},t.prototype.parseExtendedCond=function(t){var n=this;if(this.chapter>=5)return t.unwrap().slice(1).forEach((function(t){n.parseExpression(t)})),new wt.Cond(t.location,[],[],new yt.Identifier(t.location,"undefined"));if(t.length()<2)throw new st(this.source,t.location.start,t,"(cond (<pred> <body>*)* (else <val>)?)");for(var e=t.unwrap().splice(1),r=e.pop(),i=[],o=[],a=0,u=e;a<u.length;a++){var s=u[a];if(!lt(s))throw new st(this.source,s.pos,s,"(<pred> <body>*)");if(s.length()<1)throw new st(this.source,s.firstToken().pos,s.firstToken(),"(<pred> <body>*)");var c=s.unwrap(),p=c[0],h=c.slice(1);if(ft(p)&&p.type===tt.ELSE)throw new st(this.source,p.pos,p,"<predicate>");var f=this.parseExpression(p),l=h.map(this.parseExpression.bind(this)),y=h.length<1?f.location:l.at(0).location.merge(l.at(-1).location),w=h.length<1?f:h.length<2?l[0]:new yt.Sequence(y,l);i.push(f),o.push(w)}if(!lt(r))throw new st(this.source,r.pos,r,"(<pred> <body>+) | (else <val>)");if(r.length()<2)throw new st(this.source,r.firstToken().pos,r.firstToken(),"(<pred> <body>+) | (else <val>)");var v=r.unwrap(),d=v[0],m=v.slice(1),g=!1;if(ft(d)&&d.type===tt.ELSE&&(g=!0,1!==m.length))throw new st(this.source,r.location.start,r,"(else <val>)");if(m.length<1)throw new st(this.source,r.location.start,r,"(<pred> <body>+)");var E=m.map(this.parseExpression.bind(this)),T=E.at(0).location.merge(E.at(-1).location),P=1===m.length?E[0]:new yt.Sequence(T,E);if(g)return new wt.Cond(t.location,i,o,P);var b=this.parseExpression(d);return i.push(b),o.push(P),new wt.Cond(t.location,i,o)},t.prototype.parseSet=function(t){if(3!==t.length())throw new st(this.source,t.location.start,t,"(set! <identifier> <expr>)");var n=t.unwrap(),e=n[1],r=n[2];if(lt(e))throw new st(this.source,e.location.start,e,"<identifier>");if(e.type!==tt.IDENTIFIER)throw new st(this.source,e.pos,e,"<identifier>");var i=new yt.Identifier(this.toLocation(e),e.lexeme),o=this.parseExpression(r);return new yt.Reassignment(t.location,i,o)},t.prototype.parseBegin=function(t){if(t.length()<2)throw new st(this.source,t.location.start,t,"(begin <body>+)");for(var n=[],e=0,r=t.unwrap().slice(1);e<r.length;e++){var i=r[e];n.push(this.parseExpression(i))}return new wt.Begin(t.location,n)},t.prototype.parseDelay=function(t){var n=this;if(this.chapter>=5)return t.unwrap().slice(1).forEach((function(t){n.parseExpression(t)})),new wt.Delay(t.location,new yt.Identifier(t.location,"undefined"));if(2!==t.length())throw new st(this.source,t.location.start,t,"(delay <expr>)");var e=t.unwrap()[1],r=this.parseExpression(e);return new wt.Delay(t.location,r)},t.prototype.parseDefineSyntax=function(t){if(3!==t.length())throw new st(this.source,t.location.start,t,"(define-syntax <identifier> <transformer>)");var n=t.unwrap(),e=n[1],r=n[2];this.quoteMode=Pt.QUOTE;var i=this.parseExpression(e);if(this.quoteMode=Pt.NONE,!(i instanceof yt.Symbol))throw new st(this.source,i.location.start,e,"<identifier>");if(!lt(r))throw new st(this.source,r.pos,r,"<transformer>");if(r.length()<2)throw new st(this.source,r.firstToken().pos,r,"(syntax-rules ...)");var o=r.unwrap()[0];if(!ft(r.unwrap()[0]))throw new st(this.source,r.firstToken().pos,o,"syntax-rules");if(o.type!==tt.SYNTAX_RULES)throw new st(this.source,o.pos,o,"syntax-rules");var a=this.parseSyntaxRules(r);return new yt.DefineSyntax(t.location,i,a)},t.prototype.isValidPattern=function(t){if(t instanceof wt.List){if(void 0===t.terminator){var n;if(t.elements.filter((function(t){return t instanceof yt.Symbol&&"..."===t.value})).length>1)return!1;if(-1!=(n=t.elements.findIndex((function(t){return t instanceof yt.Symbol&&"..."===t.value})))&&0===n)return!1;for(var e=0,r=t.elements;e<r.length;e++){var i=r[e];if(!this.isValidPattern(i))return!1}return!0}if(t.elements.filter((function(t){return t instanceof yt.Symbol&&"..."===t.value})).length>1)return!1;if(-1!=(n=t.elements.findIndex((function(t){return t instanceof yt.Symbol&&"..."===t.value})))){if(0===n)return!1;if(n===t.elements.length-1)return!1}for(var o=0,a=t.elements;o<a.length;o++){i=a[o];if(!this.isValidPattern(i))return!1}return this.isValidPattern(t.terminator)}return t instanceof yt.Symbol||t instanceof yt.BooleanLiteral||t instanceof yt.NumericLiteral||t instanceof yt.StringLiteral||t instanceof yt.Nil},t.prototype.isValidTemplate=function(t){if(t instanceof wt.List){if(void 0===t.terminator){if(0===t.elements.length)return!1;if(2===t.elements.length&&t.elements[0]instanceof yt.Symbol&&"..."===t.elements[0].value)return this.isValidTemplate(t.elements[1]);for(var n=!1,e=0;e<t.elements.length;e++){if((r=t.elements[e])instanceof yt.Symbol&&"..."===r.value){if(n){n=!1;continue}return!1}if(!this.isValidTemplate(r))return!1;n=!0}return!0}if(0===t.elements.length)return!1;for(n=!1,e=0;e<t.elements.length;e++){var r;if((r=t.elements[e])instanceof yt.Symbol&&"..."===r.value){if(n){n=!1;continue}return!1}if(!this.isValidTemplate(r))return!1;n=!0}return this.isValidTemplate(t.terminator)}return t instanceof yt.Symbol||t instanceof yt.BooleanLiteral||t instanceof yt.NumericLiteral||t instanceof yt.StringLiteral||t instanceof yt.Nil},t.prototype.parseSyntaxRules=function(t){if(t.length()<3)throw new st(this.source,t.location.start,t,"(syntax-rules (<literal>*) <syntax-rule>+)");var n=t.unwrap(),e=n[1],r=n.slice(2),i=[];if(!lt(e))throw new st(this.source,e.pos,e,"(<literal>*)");this.quoteMode=Pt.QUOTE;for(var o=0,a=e.unwrap();o<a.length;o++){var u=a[o];if(!ft(u))throw new st(this.source,u.location.start,u,"<literal>");var s=this.parseExpression(u);if(!(s instanceof yt.Symbol))throw new st(this.source,u.pos,u,"<literal>");i.push(s)}for(var c=[],p=0,h=r;p<h.length;p++){var f=h[p];if(!lt(f))throw new st(this.source,f.pos,f,"(<pattern> <template>)");if(2!==f.length())throw new st(this.source,f.location.start,f,"(<pattern> <template>)");var l=f.unwrap(),y=l[0],w=l[1],v=this.parseExpression(y),d=this.parseExpression(w);if(!this.isValidPattern(v))throw new st(this.source,v.location.start,y,"<symbol> | <literal> | (<pattern>+) | (<pattern>+ ... <pattern>*) | (<pattern>+ ... <pattern>+ . <pattern>)");if(!this.isValidTemplate(d))throw new st(this.source,d.location.start,w,"<symbol> | <literal> | (<element>+) | (<element>+ . <template>) | (... <template>)");c.push([v,d])}return this.quoteMode=Pt.NONE,new yt.SyntaxRules(t.location,i,c)},t.prototype.parseImport=function(t){if(3!==t.length())throw new st(this.source,t.firstToken().pos,t.firstToken(),'(import "<source>" (<identifier>*))');var n=t.unwrap(),e=n[1],r=n[2];if(!ft(e))throw new st(this.source,e.location.start,e,'"<source>"');if(e.type!==tt.STRING)throw new st(this.source,e.pos,e,'"<source>"');if(!lt(r))throw new st(this.source,r.pos,r,"(<identifier>*)");for(var i=[],o=0,a=r.unwrap();o<a.length;o++){var u=a[o];if(!ft(u))throw new st(this.source,u.location.start,u,"<identifier>");if(u.type!==tt.IDENTIFIER)throw new st(this.source,u.pos,u,"<identifier>");i.push(new yt.Identifier(this.toLocation(u),u.lexeme))}var s=new yt.StringLiteral(this.toLocation(e),e.literal);return new yt.Import(t.location,s,i)},t.prototype.parseExport=function(t){if(2!==t.length())throw new st(this.source,t.firstToken().pos,t.firstToken(),"(export (<definition>))");var n=t.unwrap()[1];if(!lt(n))throw new st(this.source,n.pos,n,"(<definition>)");var e=this.parseExpression(n);if(!(e instanceof yt.Definition||e instanceof wt.FunctionDefinition))throw new st(this.source,n.location.start,n,"(<definition>)");return new yt.Export(t.location,e)},t.prototype.parseVector=function(t){var n=t.unwrap()[1].unwrap().map(this.parseExpression.bind(this));return new yt.Vector(t.location,n)},t.prototype.parse=function(t){void 0===t&&(t=!1),t&&(this.quoteMode=Pt.QUOTE,this.current=0);for(var n=[];!this.isAtEnd()&&this.peek().type!==tt.EOF;){var e=this.grouping();if(e){var r=this.parseExpression(e);n.push(r)}}if(this.chapter>=5&&!t){var i=n.filter((function(t){return t instanceof yt.Import})),o=this.parse(!0).filter((function(t){return!(t instanceof wt.List&&t.elements&&t.elements[0]instanceof yt.Symbol&&"import"===t.elements[0].value)}));return u(u([],i,!0),o,!0)}return n},t}(),Nt=function(t,n,e,r,i){this.source=t,this.startLine=n,this.startColumn=e,this.endLine=r,this.endColumn=i},_t=function(t,n,e){this.start=t,this.end=n,this.source=e},kt=function(){function t(t,n){this.syntax=t,this.forInfo=n}return t.prototype.locationToSrcLoc=function(){return new Nt(this.syntax.source,this.syntax.start.line,this.syntax.start.column,this.syntax.end.line,this.syntax.end.column)},t.prototype.toString=function(){return"".concat(this.syntax.source,":").concat(this.syntax.start.line,":").concat(this.syntax.start.column)},t}();function Ot(t){return new kt(t.syntax,!1)}var St={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉"},Lt={"₀":"0","₁":"1","₂":"2","₃":"3","₄":"4","₅":"5","₆":"6","₇":"7","₈":"8","₉":"9"};function At(t,n){if(t.some((function(t){return t===n}))){var e=function(t){var n=Bt(t,t.length-1),e=n[0],r=n[1];return[e,r]}(n);return xt(t,e)}return n}function xt(t,n){var e,r,i,o=(r=(e=n)[0],i=function(t){var n=t.toString().split("").map((function(t){return St[t]||t})).join("");return n}(e[1]),r+i);return t.map((function(t){return t.toString()})).includes(o.toString())?xt(t,function(t){return[t[0],t[1]+1]}(n)):o}function It(t){var n=t.split("").map((function(t){return Lt[t]||t})).join("");return parseInt(n,10)||1}function Bt(t,n){return n<0?[t,0]:(e=t[n],Object.keys(Lt).includes(e)?Bt(t,n-1):[t.substring(0,n+1),It(t.substring(n+1))]);var e}var Ct=function(t,n){this.location=t,this.varName=n},Rt=function(t,n){this.binder=t,this.type=n};var Mt=function(t){this.message=t},qt=function(){},Ut=function(t){function n(n){var e=t.call(this)||this;return e.result=n,e}return i(n,t),n}(qt),Ht=function(t){function n(n,e){var r=t.call(this)||this;return r.where=n,r.message=e,r}return i(n,t),n}(qt),zt=function(t,n){void 0===n&&(n=null),this.name=t,this.value=n};function Dt(t,n){for(var e=0,r=t;e<r.length;e++){var i=r[e],o=i[0],a=(0,i[1])();if(!(a instanceof Ut))throw new Error("Encountered stop when evaluating the sequence ".concat(t,". Error message: ").concat(a.message.message," at ").concat(a.where));o.value=a.result}return n()}var Qt=function(){},Ft=function(t){function n(n,e,r){var i=t.call(this)||this;return i.env=n,i.varName=e,i.expr=r,i}return i(n,t),n.prototype.valOfClosure=function(t){return this.expr.valOf(function(t,n,e){return new Map(u(u([],t,!0),[[n,e]],!1))}(this.env,this.varName,t))},n.prototype.prettyPrint=function(){return"(CLOS ".concat(this.varName," ").concat(this.expr.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Qt),Vt=function(t){function n(n){var e=t.call(this)||this;return e.proc=n,e}return i(n,t),n.prototype.valOfClosure=function(t){return this.proc(t)},n.prototype.prettyPrint=function(){return"(HOCLOS)"},n.prototype.toString=function(){return this.prettyPrint()},n}(Qt);function Gt(t){return!("U"===(n=t)||"Nat"===n||"zero"===n||"add1"===n||"which-Nat"===n||"iter-Nat"===n||"rec-Nat"===n||"ind-Nat"===n||"->"===n||"→"===n||"Π"===n||"λ"===n||"Pi"===n||"∏"===n||"lambda"===n||"quote"===n||"Atom"===n||"car"===n||"cdr"===n||"cons"===n||"Σ"===n||"Sigma"===n||"Pair"===n||"Trivial"===n||"sole"===n||"List"===n||"::"===n||"nil"===n||"rec-List"===n||"ind-List"===n||"Absurd"===n||"ind-Absurd"===n||"="===n||"same"===n||"replace"===n||"trans"===n||"cong"===n||"symm"===n||"ind-="===n||"Vec"===n||"vecnil"===n||"vec::"===n||"head"===n||"tail"===n||"ind-Vec"===n||"Either"===n||"left"===n||"right"===n||"ind-Either"===n||"TODO"===n||"the"===n)&&isNaN(Number(t));var n}function Xt(t){return Array.from(t.keys())}function jt(t,n){return At(Xt(t),n)}function Kt(t,n,e){return At(Xt(t).concat(n.findNames()),e)}function Yt(t){return[t.binder.varName].concat(t.type.findNames())}var Zt=function(t,n){this.type=t,this.value=n},Wt=function(){function t(){}return t.prototype.toString=function(){return"Neutral"},t.prototype.prettyPrint=function(){return"Neutral"},t}(),$t=function(t){function n(n){var e=t.call(this)||this;return e.name=n,e}return i(n,t),n.prototype.readBackNeutral=function(t){return new Le(this.name)},n}(Wt),Jt=function(t){function n(n,e){var r=t.call(this)||this;return r.where=n,r.type=e,r}return i(n,t),n.prototype.readBackNeutral=function(t){return new wr(this.where,this.type.readBackType(t))},n}(Wt),tn=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.base=e,i.step=r,i}return i(n,t),n.prototype.readBackNeutral=function(t){return new xe(this.target.readBackNeutral(t),new _e(this.base.type.readBackType(t),Rn(t,this.base.type,this.base.value)),Rn(t,this.step.type,this.step.value))},n}(Wt),nn=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.base=e,i.step=r,i}return i(n,t),n.prototype.readBackNeutral=function(t){return new Ie(this.target.readBackNeutral(t),new _e(this.base.type.readBackType(t),Rn(t,this.base.type,this.base.value)),Rn(t,this.step.type,this.step.value))},n}(Wt),en=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.base=e,i.step=r,i}return i(n,t),n.prototype.readBackNeutral=function(t){return new Be(this.target.readBackNeutral(t),new _e(this.base.type.readBackType(t),Rn(t,this.base.type,this.base.value)),Rn(t,this.step.type,this.step.value))},n}(Wt),rn=function(t){function n(n,e,r,i){var o=t.call(this)||this;return o.target=n,o.motive=e,o.base=r,o.step=i,o}return i(n,t),n.prototype.readBackNeutral=function(t){return new Ce(this.target.readBackNeutral(t),Rn(t,this.motive.type,this.motive.value),Rn(t,this.base.type,this.base.value),Rn(t,this.step.type,this.step.value))},n}(Wt),on=function(t){function n(n){var e=t.call(this)||this;return e.target=n,e}return i(n,t),n.prototype.readBackNeutral=function(t){return new De(this.target.readBackNeutral(t))},n}(Wt),an=function(t){function n(n){var e=t.call(this)||this;return e.target=n,e}return i(n,t),n.prototype.readBackNeutral=function(t){return new Qe(this.target.readBackNeutral(t))},n}(Wt),un=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.base=e,i.step=r,i}return i(n,t),n.prototype.readBackNeutral=function(t){return new Xe(this.target.readBackNeutral(t),new _e(this.base.type.readBackType(t),Rn(t,this.base.type,this.base.value)),Rn(t,this.step.type,this.step.value))},n}(Wt),sn=function(t){function n(n,e,r,i){var o=t.call(this)||this;return o.target=n,o.motive=e,o.base=r,o.step=i,o}return i(n,t),n.prototype.readBackNeutral=function(t){return new je(this.target.readBackNeutral(t),Rn(t,this.motive.type,this.motive.value),Rn(t,this.base.type,this.base.value),Rn(t,this.step.type,this.step.value))},n}(Wt),cn=function(t){function n(n,e){var r=t.call(this)||this;return r.target=n,r.motive=e,r}return i(n,t),n.prototype.readBackNeutral=function(t){return new We(new _e(new Ze,this.target.readBackNeutral(t)),Rn(t,this.motive.type,this.motive.value))},n}(Wt),pn=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.motive=e,i.base=r,i}return i(n,t),n.prototype.readBackNeutral=function(t){return new tr(this.target.readBackNeutral(t),Rn(t,this.motive.type,this.motive.value),Rn(t,this.base.type,this.base.value))},n}(Wt),hn=function(t){function n(n,e){var r=t.call(this)||this;return r.target1=n,r.target2=e,r}return i(n,t),n.prototype.readBackNeutral=function(t){return new nr(this.target1.readBackNeutral(t),Rn(t,this.target2.type,this.target2.value))},n}(Wt),fn=function(t){function n(n,e){var r=t.call(this)||this;return r.target1=n,r.target2=e,r}return i(n,t),n.prototype.readBackNeutral=function(t){return new nr(Rn(t,this.target1.type,this.target1.value),this.target2.readBackNeutral(t))},n}(Wt),ln=function(t){function n(n,e){var r=t.call(this)||this;return r.target1=n,r.target2=e,r}return i(n,t),n.prototype.readBackNeutral=function(t){return new nr(this.target1.readBackNeutral(t),this.target2.readBackNeutral(t))},n}(Wt),yn=function(t){function n(n,e){var r=t.call(this)||this;return r.target=n,r.func=e,r}return i(n,t),n.prototype.readBackNeutral=function(t){var n=this.func.type;if(n instanceof re){var e=n.resultType;return new er(this.target.readBackNeutral(t),e.valOfClosure(new be).readBackType(t),Rn(t,this.func.type,this.func.value))}throw new Error("Cong applied to non-Pi type.")},n}(Wt),wn=function(t){function n(n){var e=t.call(this)||this;return e.target=n,e}return i(n,t),n.prototype.readBackNeutral=function(t){return new rr(this.target.readBackNeutral(t))},n}(Wt),vn=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.motive=e,i.base=r,i}return i(n,t),n.prototype.readBackNeutral=function(t){return new ir(this.target.readBackNeutral(t),Rn(t,this.motive.type,this.motive.value),Rn(t,this.base.type,this.base.value))},n}(Wt),dn=function(t){function n(n){var e=t.call(this)||this;return e.target=n,e}return i(n,t),n.prototype.readBackNeutral=function(t){return new sr(this.target.readBackNeutral(t))},n}(Wt),mn=function(t){function n(n){var e=t.call(this)||this;return e.target=n,e}return i(n,t),n.prototype.readBackNeutral=function(t){return new cr(this.target.readBackNeutral(t))},n}(Wt);!function(t){function n(n,e,r,i,o){var a=t.call(this)||this;return a.length=n,a.target=e,a.motive=r,a.base=i,a.step=o,a}i(n,t),n.prototype.readBackNeutral=function(t){return new pr(this.length.readBackNeutral(t),Rn(t,this.target.type,this.target.value),Rn(t,this.motive.type,this.motive.value),Rn(t,this.base.type,this.base.value),Rn(t,this.step.type,this.step.value))}}(Wt);var gn=function(t){function n(n,e,r,i,o){var a=t.call(this)||this;return a.length=n,a.target=e,a.motive=r,a.base=i,a.step=o,a}return i(n,t),n.prototype.readBackNeutral=function(t){return new pr(Rn(t,this.length.type,this.length.value),this.target.readBackNeutral(t),Rn(t,this.motive.type,this.motive.value),Rn(t,this.base.type,this.base.value),Rn(t,this.step.type,this.step.value))},n}(Wt),En=function(t){function n(n,e,r,i,o){var a=t.call(this)||this;return a.length=n,a.target=e,a.motive=r,a.base=i,a.step=o,a}return i(n,t),n.prototype.readBackNeutral=function(t){return new pr(this.length.readBackNeutral(t),this.target.readBackNeutral(t),Rn(t,this.motive.type,this.motive.value),Rn(t,this.base.type,this.base.value),Rn(t,this.step.type,this.step.value))},n}(Wt),Tn=function(t){function n(n,e,r,i){var o=t.call(this)||this;return o.target=n,o.motive=e,o.baseLeft=r,o.baseRight=i,o}return i(n,t),n.prototype.readBackNeutral=function(t){return new yr(this.target.readBackNeutral(t),Rn(t,this.motive.type,this.motive.value),Rn(t,this.baseLeft.type,this.baseLeft.value),Rn(t,this.baseRight.type,this.baseRight.value))},n}(Wt),Pn=function(t){function n(n,e){var r=t.call(this)||this;return r.operator=n,r.operand=e,r}return i(n,t),n.prototype.readBackNeutral=function(t){return new vr(this.operator.readBackNeutral(t),Rn(t,this.operand.type,this.operand.value))},n}(Wt);function bn(t,n){var r=t.now();if(r instanceof ie)return r.body.valOfClosure(n);if(r instanceof me){var i=r.type.now();if(i instanceof re)return new me(i.resultType.valOfClosure(n),new Pn(r.neutral,new Zt(i.argType,n)))}throw new Error("doApp: invalid input ".concat(e.inspect([r,n])))}function Nn(t,n,r,i){var o=t.now();if(o instanceof ne)return r;if(o instanceof ee)return bn(i,Nn(o.smaller,n,r,i));if(o instanceof me&&o.type.now()instanceof te)return new me(n,new nn(o.neutral,new Zt(n,r),new Zt(new re("n",new te,new Vt((function(t){return n}))),i)));throw new Error("invalid input for iterNat ".concat(e.inspect([t,n,r,i])))}function _n(t,n,r,i){var o=t.now();if(o instanceof ne)return r;if(o instanceof ee)return bn(i,_n(o.smaller,n,r,i));if(o instanceof me&&o.type.now()instanceof te)return new me(n,new en(o.neutral,new Zt(n,r),new Zt(new re("n-1",new te,new Vt((function(t){return new re("ih",n,new Vt((function(t){return n})))}))),i)));throw new Error("invalid input for recNat ".concat(e.inspect([t,n,r,i])))}function kn(t,n,r,i){var o=t.now();if(o instanceof ne)return r;if(o instanceof ee)return bn(bn(i,o.smaller),kn(o.smaller,n,r,i));if(o instanceof me&&o.type.now()instanceof te)return new me(bn(n,t),new rn(o.neutral,new Zt(new re("x",new te,new Vt((function(t){return new ge}))),n),new Zt(bn(n,new ne),r),new Zt(new re("n-1",new te,new Vt((function(t){return new re("ih",bn(n,t),new Vt((function(e){return bn(n,new ee(t))})))}))),i)));throw new Error("invalid input for indNat ".concat(e.inspect([t,n,r,i])))}function On(t){var n=t.now();if(n instanceof ae)return n.car;if(n instanceof me){var r=n.type.now();if(r instanceof oe){var i=r,o=n.neutral;return new me(i.carType,new on(o))}}throw new Error("invalid input for car ".concat(e.inspect(t)))}function Sn(t){var n=t.now();if(n instanceof ae)return n.cdr;if(n instanceof me){var r=n.type.now();if(r instanceof oe){var i=r,o=n.neutral;return new me(i.cdrType.valOfClosure(On(t)),new an(o))}}throw new Error("invalid input for cdr ".concat(e.inspect(t)))}function Ln(t,n,r,i){var o=t.now();if(o instanceof se)return r;if(o instanceof ce)return bn(bn(bn(i,o.head),o.tail),Ln(o.tail,n,r,i));if(o instanceof me){var a=o.type.now();if(a instanceof ue){var u=a.entryType,s=o.neutral,c=new re("xs",new ue(u),new Vt((function(t){return new ge})));return new me(bn(n,t),new sn(s,new Zt(c,n),new Zt(bn(n,new se),r),new Zt(new re("h",u,new Vt((function(t){return new re("t",new ue(u),new Vt((function(e){return new re("ih",bn(n,e),new Vt((function(r){return bn(n,new ce(t,e))})))})))}))),i)))}}throw new Error("invalid input for indList ".concat(e.inspect([o,n,r,i])))}function An(t,n,r,i){var o=t.now();if(o instanceof se)return r;if(o instanceof ce){var a=o.head,u=o.tail;return bn(bn(bn(i,a),u),An(u,n,r,i))}if(o instanceof me){var s=o.type.now();if(s instanceof ue){var c=s.entryType,p=o.neutral;return new me(n,new un(p,new Zt(n,r),new Zt(new re("h",c,new Vt((function(t){return new re("t",new ue(c),new Vt((function(t){return new re("ih",n,new Vt((function(t){return n})))})))}))),i)))}}throw new Error("invalid input for recList ".concat(e.inspect([o,n,r,i])))}function xn(t){var n=t.now();if(n instanceof ye)return n.tail;if(n instanceof me&&n.type instanceof fe&&n.type.length instanceof ee){var r=n.type.now();if(r instanceof fe)if(r.length.now()instanceof ee)return new me(new fe(n.type.entryType,n.type.length.smaller),new mn(n.neutral))}throw new Error("invalid input for tail ".concat(e.inspect(t)))}function In(t,n){return new re("k",new te,new Vt((function(e){return new re("e",new fe(t,e),new Vt((function(r){return new re("es",new fe(t,e),new Vt((function(t){return new re("ih",bn(bn(n,e),t),new Vt((function(i){return bn(bn(n,new ee(e)),new ye(r,t))})))})))})))})))}function Bn(t,n,r,i,o){var a=t.now(),u=n.now();if(a instanceof ne&&u instanceof le)return i;if(a instanceof ee&&u instanceof ye)return bn(bn(bn(bn(o,a.smaller),u.head),xn(n)),Bn(a.smaller,u.tail,r,i,o));if(a instanceof me&&u instanceof me&&a.type instanceof te&&u.type instanceof fe){var s=u.type.entryType;return new me(bn(bn(r,t),n),new En(a.neutral,u.neutral,new Zt(new re("k",new te,new Vt((function(t){return new re("es",new fe(s,t),new Vt((function(t){return new ge})))}))),r),new Zt(bn(bn(r,new ne),new le),i),new Zt(In(u.type.entryType,r),o)))}if(Cn(a,t)&&u instanceof me&&u.type instanceof fe){var c=u.type.entryType;return new me(bn(bn(r,t),n),new gn(new Zt(new te,t),u.neutral,new Zt(new re("k",new te,new Vt((function(t){return new re("es",new fe(c,t),new Vt((function(t){return new ge})))}))),r),new Zt(bn(bn(r,new te),new le),i),new Zt(In(c,r),o)))}throw new Error("invalid input for indVec ".concat(e.inspect([t,n,r,i,o])))}function Cn(t,n){var e=t.now(),r=n.now();return e instanceof ne&&r instanceof ne||e instanceof ee&&r instanceof ee&&Cn(e.smaller,r.smaller)}function Rn(t,n,e){var r=n.now(),i=e.now();if(r instanceof ge)return e.readBackType(t);if(r instanceof te&&i instanceof ne)return new Se;if(r instanceof te&&i instanceof ee)return new Ae(Rn(t,new te,i.smaller));if(r instanceof re){var o=jt(t,i instanceof ie?i.argName:r.argName);return new Me(o,Rn(Kn(t,o,r.argType),r.resultType.valOfClosure(new me(r.argType,new $t(o))),bn(i,new me(r.argType,new $t(o)))))}if(r instanceof oe){var a=On(e),u=Sn(e);return new ze(Rn(t,r.carType,a),Rn(t,r.cdrType.valOfClosure(a),u))}if(r instanceof Ee&&i instanceof Jn)return new Ue(i.name);if(r instanceof Te)return new Ye;if(r instanceof ue&&i instanceof se)return new Ve;if(r instanceof ue&&i instanceof ce)return new ze(Rn(t,r.entryType,i.head),Rn(t,new ue(r.entryType),i.tail));if(r instanceof be&&i instanceof me)return new _e(new Ze,i.neutral.readBackNeutral(t));if(r instanceof pe&&i instanceof he)return new Je(Rn(t,r.type,i.value));if(r instanceof fe&&r.length instanceof ne&&i instanceof le)return new ur;if(r instanceof fe&&r.length instanceof ee&&i instanceof ye)return new ar(Rn(t,r.entryType,i.head),Rn(t,new fe(r.entryType,r.length.smaller),i.tail));if(r instanceof we&&i instanceof ve)return new fr(Rn(t,r.leftType,i.value));if(r instanceof we&&i instanceof de)return new lr(Rn(t,r.rightType,i.value));if(i instanceof me)return i.neutral.readBackNeutral(t);throw new Error("Cannot read back ".concat(i," : ").concat(r))}function Mn(t,n,e){return new Map(u(u([],t,!0),[[n,e]],!1))}function qn(t,n){return n.valOf(Dn(t))}function Un(t){for(var n=new Map,e=0,r=t;e<r.length;e++){var i=r[e],o=i[0],a=i[1];a instanceof Xn?n.set(o,["free",a.type.readBackType(t)]):a instanceof Gn?n.set(o,["def",a.type.readBackType(t),Rn(t,a.type,a.value)]):a instanceof Vn&&n.set(o,["claim",a.type.readBackType(t)])}return n}function Hn(t,n,e,r){var i=new zt("typeOut");return Dt([[new zt("_"),function(){return function(t,n,e){return t.has(e)?new Ht(n,new Mt(['The name "'.concat(e,'" is already in use in the context.')])):new Ut(!0)}(t,e,n)}],[i,function(){return r.isType(t,new Map)}]],(function(){return new Ut(Mn(t,n,new Vn(qn(t,i.value))))}))}function zn(t,n,e,r){var i=new zt("typeOut"),o=new zt("exprOut");return Dt([[i,function(){return function(t,n,e){for(var r=0,i=t;r<i.length;r++){var o=i[r],a=o[0],u=o[1];if(a===e){if(u instanceof Gn)return new Ht(n,new Mt(['The name "'.concat(e,'" is already defined.')]));if(u instanceof Vn)return new Ut(u.type)}}return new Ht(n,new Mt(["No claim: ".concat(e)]))}(t,e,n)}],[o,function(){return r.check(t,new Map,i.value)}]],(function(){return new Ut(function(t,n,e,r){return Mn(t,n,new Gn(e,r))}(function(t,n){return t.delete(n),t}(t,n),n,i.value,qn(t,o.value)))}))}function Dn(t){if(0===t.size)return new Map;for(var n=t.entries(),e=new Map,r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],u=o[1];u instanceof Gn?e.set(a,u.value):u instanceof Xn&&e.set(a,new me(u.type,new $t(a)))}return e}var Qn=new Map,Fn=function(){},Vn=function(t){function n(n){var e=t.call(this)||this;return e.type=n,e}return i(n,t),n}(Fn),Gn=function(t){function n(n,e){var r=t.call(this)||this;return r.type=n,r.value=e,r}return i(n,t),n}(Fn),Xn=function(t){function n(n){var e=t.call(this)||this;return e.type=n,e}return i(n,t),n}(Fn);function jn(t,n,e){if(0===t.size)throw new Error("Unknown variable ".concat(e));for(var r=0,i=t.entries();r<i.length;r++){var o=i[r],a=o[0],u=o[1];if(!(u instanceof Vn)&&e===a)return new Ut(u.type)}throw new Error("Unknown variable ".concat(e))}function Kn(t,n,e){if(t.has(n)){for(var r=0,i=t;r<i.length;r++){var o=i[r],a=o[0];if(o[1],a===n)return Mn(t,n,new Xn(e))}throw new Error("\n      ".concat(n," is already bound in ").concat(JSON.stringify(t),"\n    "))}return Mn(t,n,new Xn(e))}var Yn=function(){function t(){}return t.prototype.now=function(){return this},t}(),Zn=function(){function t(t,n){this.env=t,this.expr=n}return t.prototype.undelay=function(){return this.expr.valOf(this.env).now()},t.prototype.toString=function(){return"DelayClosure(".concat(this.env,", ").concat(this.expr,")")},t}(),Wn=function(){function t(t){this.content=t}return t.prototype.get=function(){return this.content},t.prototype.set=function(t){this.content=t},t}(),$n=function(t){function n(n){var e=t.call(this)||this;return e.val=n,e}return i(n,t),n.prototype.now=function(){var t=this.val.get();if(t instanceof Zn){var n=t.undelay();return this.val.set(n),n}return t},n.prototype.readBackType=function(t){return this.now().readBackType(t)},n.prototype.prettyPrint=function(){return this.now().prettyPrint()},n.prototype.toString=function(){return"Delay(".concat(this.val,")")},n}(Yn),Jn=function(t){function n(n){var e=t.call(this)||this;return e.name=n,e}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for Quote.")},n.prototype.prettyPrint=function(){return"'".concat(this.name)},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),te=function(t){function n(){return t.call(this)||this}return i(n,t),n.prototype.readBackType=function(t){return new Oe},n.prototype.prettyPrint=function(){return"Nat"},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),ne=function(t){function n(){return t.call(this)||this}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for Zero.")},n.prototype.prettyPrint=function(){return"zero"},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),ee=function(t){function n(n){var e=t.call(this)||this;return e.smaller=n,e}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for Add1.")},n.prototype.prettyPrint=function(){return"(add1 ".concat(this.smaller.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),re=function(t){function n(n,e,r){var i=t.call(this)||this;return i.argName=n,i.argType=e,i.resultType=r,i}return i(n,t),n.prototype.readBackType=function(t){var n=this.argType.readBackType(t),e=jt(t,this.argName),r=Kn(t,e,this.argType);return new Re(e,n,this.resultType.valOfClosure(new me(this.argType,new $t(e))).readBackType(r))},n.prototype.prettyPrint=function(){return"(Π ".concat(this.argName," ").concat(this.argType.prettyPrint()," ").concat(this.resultType.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),ie=function(t){function n(n,e){var r=t.call(this)||this;return r.argName=n,r.body=e,r}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for Lambda.")},n.prototype.prettyPrint=function(){return"(lambda ".concat(this.argName," ").concat(this.body.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),oe=function(t){function n(n,e,r){var i=t.call(this)||this;return i.carName=n,i.carType=e,i.cdrType=r,i}return i(n,t),n.prototype.readBackType=function(t){var n=this.carType.readBackType(t),e=jt(t,this.carName),r=Kn(t,e,this.carType);return new He(e,n,this.cdrType.valOfClosure(new me(this.carType,new $t(e))).readBackType(r))},n.prototype.prettyPrint=function(){return"(Σ ".concat(this.carName," ").concat(this.carType.prettyPrint()," ").concat(this.cdrType.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),ae=function(t){function n(n,e){var r=t.call(this)||this;return r.car=n,r.cdr=e,r}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for Cons.")},n.prototype.prettyPrint=function(){return"(cons ".concat(this.car.prettyPrint()," ").concat(this.cdr.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),ue=function(t){function n(n){var e=t.call(this)||this;return e.entryType=n,e}return i(n,t),n.prototype.readBackType=function(t){return new Ge(this.entryType.readBackType(t))},n.prototype.prettyPrint=function(){return"(List ".concat(this.entryType.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),se=function(t){function n(){return t.call(this)||this}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for Nil.")},n.prototype.prettyPrint=function(){return"nil"},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),ce=function(t){function n(n,e){var r=t.call(this)||this;return r.head=n,r.tail=e,r}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for ListCons.")},n.prototype.prettyPrint=function(){return"(:: ".concat(this.head.prettyPrint()," ").concat(this.tail.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),pe=function(t){function n(n,e,r){var i=t.call(this)||this;return i.type=n,i.from=e,i.to=r,i}return i(n,t),n.prototype.readBackType=function(t){return new $e(this.type.readBackType(t),Rn(t,this.type,this.from),Rn(t,this.type,this.to))},n.prototype.prettyPrint=function(){return"(= ".concat(this.type.prettyPrint()," ").concat(this.from.prettyPrint()," ").concat(this.to.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),he=function(t){function n(n){var e=t.call(this)||this;return e.value=n,e}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for Same.")},n.prototype.prettyPrint=function(){return"(same ".concat(this.value.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),fe=function(t){function n(n,e){var r=t.call(this)||this;return r.entryType=n,r.length=e,r}return i(n,t),n.prototype.readBackType=function(t){return new or(this.entryType.readBackType(t),Rn(t,new te,this.length))},n.prototype.prettyPrint=function(){return"(Vec ".concat(this.entryType.prettyPrint()," ").concat(this.length.prettyPrint(),")")},n}(Yn),le=function(t){function n(){return t.call(this)||this}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for VecNil.")},n.prototype.prettyPrint=function(){return"vecnil"},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),ye=function(t){function n(n,e){var r=t.call(this)||this;return r.head=n,r.tail=e,r}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for VecCons.")},n.prototype.prettyPrint=function(){return"(vec:: ".concat(this.head.prettyPrint()," ").concat(this.tail.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),we=function(t){function n(n,e){var r=t.call(this)||this;return r.leftType=n,r.rightType=e,r}return i(n,t),n.prototype.readBackType=function(t){return new hr(this.leftType.readBackType(t),this.rightType.readBackType(t))},n.prototype.prettyPrint=function(){return"(Either ".concat(this.leftType.prettyPrint()," ").concat(this.rightType.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),ve=function(t){function n(n){var e=t.call(this)||this;return e.value=n,e}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for Left.")},n.prototype.prettyPrint=function(){return"(left ".concat(this.value.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),de=function(t){function n(n){var e=t.call(this)||this;return e.value=n,e}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for Right.")},n.prototype.prettyPrint=function(){return"(right ".concat(this.value.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),me=function(t){function n(n,e){var r=t.call(this)||this;return r.type=n,r.neutral=e,r}return i(n,t),n.prototype.readBackType=function(t){return this.neutral.readBackNeutral(t)},n.prototype.prettyPrint=function(){return"(neutral ".concat(this.type.prettyPrint()," ").concat(this.neutral.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),ge=function(t){function n(){return t.call(this)||this}return i(n,t),n.prototype.readBackType=function(t){return new ke},n.prototype.prettyPrint=function(){return"U"},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),Ee=function(t){function n(){return t.call(this)||this}return i(n,t),n.prototype.readBackType=function(t){return new qe},n.prototype.prettyPrint=function(){return"Atom"},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),Te=function(t){function n(){return t.call(this)||this}return i(n,t),n.prototype.readBackType=function(t){return new Ke},n.prototype.prettyPrint=function(){return"Trivial"},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),Pe=function(t){function n(){return t.call(this)||this}return i(n,t),n.prototype.readBackType=function(t){throw new Error("No readBackType for Sole.")},n.prototype.prettyPrint=function(){return"sole"},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),be=function(t){function n(){return t.call(this)||this}return i(n,t),n.prototype.readBackType=function(t){return new Ze},n.prototype.prettyPrint=function(){return"Absurd"},n.prototype.toString=function(){return this.prettyPrint()},n}(Yn),Ne=function(){function t(){}return t.prototype.toLazy=function(t){return new $n(new Wn(new Zn(t,this)))},t}(),_e=function(t){function n(n,e){var r=t.call(this)||this;return r.type=n,r.expr=e,r}return i(n,t),n.prototype.valOf=function(t){return this.expr.valOf(t)},n.prototype.prettyPrint=function(){return"(the ".concat(this.type.prettyPrint()," ").concat(this.expr.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),ke=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return i(n,t),n.prototype.valOf=function(t){return new ge},n.prototype.prettyPrint=function(){return"U"},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Oe=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return i(n,t),n.prototype.valOf=function(t){return new te},n.prototype.prettyPrint=function(){return"Nat"},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Se=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return i(n,t),n.prototype.valOf=function(t){return new ne},n.prototype.prettyPrint=function(){return"zero"},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Le=function(t){function n(n){var e=t.call(this)||this;return e.name=n,e}return i(n,t),n.prototype.valOf=function(t){if(Gt(this.name))return function(t,n){if(t.has(n))return t.get(n);throw new Error("Variable ".concat(n," not found in environment"))}(t,this.name);throw new Error("{this.name} is not a valid variable name")},n.prototype.prettyPrint=function(){return this.name},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Ae=function(t){function n(n){var e=t.call(this)||this;return e.n=n,e}return i(n,t),n.prototype.valOf=function(t){return new ee(this.n.toLazy(t))},n.prototype.prettyPrint=function(){return"(add1 ".concat(this.n.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),xe=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.base=e,i.step=r,i}return i(n,t),n.prototype.valOf=function(t){return function(t,n,r,i){var o=t.now();if(o instanceof ne)return r;if(o instanceof ee)return bn(i,o.smaller);if(o instanceof me&&o.type.now()instanceof te)return new me(n,new tn(o.neutral,new Zt(n,r),new Zt(new re("n",new te,new Vt((function(t){return n}))),i)));throw new Error("invalid input for whichNat ".concat(e.inspect([t,n,r,i])))}(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))},n.prototype.prettyPrint=function(){return"(which-Nat ".concat(this.target.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Ie=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.base=e,i.step=r,i}return i(n,t),n.prototype.valOf=function(t){return Nn(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))},n.prototype.prettyPrint=function(){return"(iter-Nat ".concat(this.target.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Be=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.base=e,i.step=r,i}return i(n,t),n.prototype.valOf=function(t){return _n(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))},n.prototype.prettyPrint=function(){return"(rec-Nat ".concat(this.target.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Ce=function(t){function n(n,e,r,i){var o=t.call(this)||this;return o.target=n,o.motive=e,o.base=r,o.step=i,o}return i(n,t),n.prototype.valOf=function(t){return kn(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t),this.step.toLazy(t))},n.prototype.prettyPrint=function(){return"(ind-Nat ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Re=function(t){function n(n,e,r){var i=t.call(this)||this;return i.name=n,i.type=e,i.body=r,i}return i(n,t),n.prototype.valOf=function(t){var n=this.type.toLazy(t);return new re(this.name,n,new Ft(t,this.name,this.body))},n.prototype.prettyPrint=function(){return"(Π (".concat(this.name," ").concat(this.type.prettyPrint(),") \n          ").concat(this.body.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Me=function(t){function n(n,e){var r=t.call(this)||this;return r.param=n,r.body=e,r}return i(n,t),n.prototype.valOf=function(t){return new ie(this.param,new Ft(t,this.param,this.body))},n.prototype.prettyPrint=function(){return"(λ (".concat(this.param,") ").concat(this.body.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),qe=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return i(n,t),n.prototype.valOf=function(t){return new Ee},n.prototype.prettyPrint=function(){return"Atom"},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Ue=function(t){function n(n){var e=t.call(this)||this;return e.sym=n,e}return i(n,t),n.prototype.valOf=function(t){return new Jn(this.sym)},n.prototype.prettyPrint=function(){return"'".concat(this.sym)},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),He=function(t){function n(n,e,r){var i=t.call(this)||this;return i.name=n,i.type=e,i.body=r,i}return i(n,t),n.prototype.valOf=function(t){var n=this.type.toLazy(t);return new oe(this.name,n,new Ft(t,this.name,this.body))},n.prototype.prettyPrint=function(){return"(Σ (".concat(this.name," ").concat(this.type.prettyPrint(),") \n              ").concat(this.body.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),ze=function(t){function n(n,e){var r=t.call(this)||this;return r.first=n,r.second=e,r}return i(n,t),n.prototype.valOf=function(t){var n=this.first.toLazy(t),e=this.second.toLazy(t);return new ae(n,e)},n.prototype.prettyPrint=function(){return"(cons ".concat(this.first.prettyPrint()," ").concat(this.second.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),De=function(t){function n(n){var e=t.call(this)||this;return e.pair=n,e}return i(n,t),n.prototype.valOf=function(t){return On(this.pair.toLazy(t))},n.prototype.prettyPrint=function(){return"(car ".concat(this.pair.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Qe=function(t){function n(n){var e=t.call(this)||this;return e.pair=n,e}return i(n,t),n.prototype.valOf=function(t){return Sn(this.pair.toLazy(t))},n.prototype.prettyPrint=function(){return"(cdr ".concat(this.pair.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Fe=function(t){function n(n,e){var r=t.call(this)||this;return r.head=n,r.tail=e,r}return i(n,t),n.prototype.valOf=function(t){var n=this.head.toLazy(t),e=this.tail.toLazy(t);return new ce(n,e)},n.prototype.prettyPrint=function(){return"(:: ".concat(this.head.prettyPrint()," ").concat(this.tail.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Ve=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return i(n,t),n.prototype.valOf=function(t){return new se},n.prototype.prettyPrint=function(){return"nil"},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Ge=function(t){function n(n){var e=t.call(this)||this;return e.elemType=n,e}return i(n,t),n.prototype.valOf=function(t){return new ue(this.elemType.toLazy(t))},n.prototype.prettyPrint=function(){return"(List ".concat(this.elemType.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Xe=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.base=e,i.step=r,i}return i(n,t),n.prototype.valOf=function(t){return An(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))},n.prototype.prettyPrint=function(){return"(rec-List ".concat(this.target.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),je=function(t){function n(n,e,r,i){var o=t.call(this)||this;return o.target=n,o.motive=e,o.base=r,o.step=i,o}return i(n,t),n.prototype.valOf=function(t){return Ln(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t),this.step.toLazy(t))},n.prototype.prettyPrint=function(){return"(ind-List ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Ke=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return i(n,t),n.prototype.valOf=function(t){return new Te},n.prototype.prettyPrint=function(){return"Trivial"},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Ye=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return i(n,t),n.prototype.valOf=function(t){return new Pe},n.prototype.prettyPrint=function(){return"sole"},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Ze=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return i(n,t),n.prototype.valOf=function(t){return new be},n.prototype.prettyPrint=function(){return"Absurd"},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),We=function(t){function n(n,e){var r=t.call(this)||this;return r.target=n,r.motive=e,r}return i(n,t),n.prototype.valOf=function(t){return function(t,n){var r=t.now();if(r instanceof me&&r.type.now()instanceof be)return new me(n,new cn(r.neutral,new Zt(new ge,n)));throw new Error("invalid input for indAbsurd ".concat(e.inspect([t,n])))}(this.target.toLazy(t),this.motive.toLazy(t))},n.prototype.prettyPrint=function(){return"(ind-Absurd \n              ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),$e=function(t){function n(n,e,r){var i=t.call(this)||this;return i.type=n,i.left=e,i.right=r,i}return i(n,t),n.prototype.valOf=function(t){return new pe(this.type.toLazy(t),this.left.toLazy(t),this.right.toLazy(t))},n.prototype.prettyPrint=function(){return"(= ".concat(this.type.prettyPrint()," \n              ").concat(this.left.prettyPrint()," \n              ").concat(this.right.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),Je=function(t){function n(n){var e=t.call(this)||this;return e.type=n,e}return i(n,t),n.prototype.valOf=function(t){return new he(this.type.toLazy(t))},n.prototype.prettyPrint=function(){return"(same ".concat(this.type.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),tr=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.motive=e,i.base=r,i}return i(n,t),n.prototype.valOf=function(t){return function(t,n,r){var i=t.now();if(i instanceof he)return r;if(i instanceof me){var o=i.type.now();if(o instanceof pe){var a=i.neutral,u=o.type,s=o.from,c=o.to;return new me(bn(n,c),new pn(a,new Zt(new re("x",u,new Vt((function(t){return new ge}))),n),new Zt(bn(n,s),r)))}}throw new Error("invalid input for replace ".concat(e.inspect([t,n,r])))}(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t))},n.prototype.prettyPrint=function(){return"(replace ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint()," \n              ").concat(this.base.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),nr=function(t){function n(n,e){var r=t.call(this)||this;return r.left=n,r.right=e,r}return i(n,t),n.prototype.valOf=function(t){return function(t,n){var r=t.now(),i=n.now();if(r instanceof he&&i instanceof he)return new he(r.value);if(r instanceof he&&i instanceof me){if((h=i.type.now())instanceof pe){var o=r.value,a=h.to,u=h.type,s=i.neutral;return new me(new pe(u,o,a),new fn(new Zt(new pe(u,o,o),new he(o)),s))}}else if(r instanceof me&&i instanceof he){if((p=r.type.now())instanceof pe){o=p.from,a=i.value,u=p.type;var c=r.neutral;return new me(new pe(u,o,a),new hn(c,new Zt(new pe(u,a,a),new he(a))))}}else if(r instanceof me&&i instanceof me){var p=r.type.now(),h=i.type.now();if(p instanceof pe&&h instanceof pe)return o=p.from,a=h.to,u=p.type,c=r.neutral,s=i.neutral,new me(new pe(u,o,a),new ln(c,s))}throw new Error("invalid input for do-trans: ".concat(e.inspect([t,n])))}(this.left.toLazy(t),this.right.toLazy(t))},n.prototype.prettyPrint=function(){return"(trans ".concat(this.left.prettyPrint()," ").concat(this.right.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),er=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.base=e,i.fun=r,i}return i(n,t),n.prototype.valOf=function(t){return function(t,n,r){var i=t.now();if(i instanceof he)return new he(bn(r,i.value));if(i instanceof me){var o=i.type.now();if(o instanceof pe){var a=o.type,u=o.from,s=o.to,c=i.neutral;return new me(new pe(n,bn(r,u),bn(r,s)),new yn(c,new Zt(new re("x",a,new Vt((function(t){return n}))),r)))}}throw new Error("invalid input for cong ".concat(e.inspect([t,n,r])))}(this.target.toLazy(t),this.base.toLazy(t),this.fun.toLazy(t))},n.prototype.prettyPrint=function(){return"(cong ".concat(this.target.prettyPrint()," ").concat(this.fun.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),rr=function(t){function n(n){var e=t.call(this)||this;return e.equality=n,e}return i(n,t),n.prototype.valOf=function(t){return function(t){var n=t.now();if(n instanceof he)return new he(n.value);if(n instanceof me){var r=n.type.now();if(r instanceof pe)return new me(new pe(r.type,r.to,r.from),new wn(n.neutral))}throw new Error("invalid input for symm ".concat(e.inspect(t)))}(this.equality.toLazy(t))},n.prototype.prettyPrint=function(){return"(symm ".concat(this.equality.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),ir=function(t){function n(n,e,r){var i=t.call(this)||this;return i.target=n,i.motive=e,i.base=r,i}return i(n,t),n.prototype.valOf=function(t){return function(t,n,r){var i=t.now();if(i instanceof he)return r;if(i instanceof me){var o=i.type.now();if(o instanceof pe){var a=o.type,u=o.from,s=o.to,c=i.neutral;return new me(bn(bn(n,s),t),new vn(c,new Zt(new re("to",a,new Vt((function(t){return new re("p",new pe(a,u,t),new Vt((function(t){return new ge})))}))),n),new Zt(bn(bn(n,u),new he(u)),r)))}}throw new Error("invalid input for indEqual ".concat(e.inspect([t,n,r])))}(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t))},n.prototype.prettyPrint=function(){return"(ind-= ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint()," \n              ").concat(this.base.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),or=function(t){function n(n,e){var r=t.call(this)||this;return r.type=n,r.length=e,r}return i(n,t),n.prototype.valOf=function(t){return new fe(this.type.toLazy(t),this.length.toLazy(t))},n.prototype.prettyPrint=function(){return"(Vec ".concat(this.type.prettyPrint()," ").concat(this.length.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),ar=function(t){function n(n,e){var r=t.call(this)||this;return r.head=n,r.tail=e,r}return i(n,t),n.prototype.valOf=function(t){return new ye(this.head.toLazy(t),this.tail.toLazy(t))},n.prototype.prettyPrint=function(){return"(vec:: ".concat(this.head.prettyPrint()," ").concat(this.tail.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),ur=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return i(n,t),n.prototype.valOf=function(t){return new le},n.prototype.prettyPrint=function(){return"vecnil"},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),sr=function(t){function n(n){var e=t.call(this)||this;return e.vec=n,e}return i(n,t),n.prototype.valOf=function(t){return function(t){var n=t.now();if(n instanceof ye)return n.head;if(n instanceof me){var r=n.type.now();if(r instanceof fe&&r.length.now()instanceof ee)return new me(r.entryType,new dn(n.neutral))}throw new Error("invalid input for head ".concat(e.inspect(t)))}(this.vec.toLazy(t))},n.prototype.prettyPrint=function(){return"(head ".concat(this.vec.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),cr=function(t){function n(n){var e=t.call(this)||this;return e.vec=n,e}return i(n,t),n.prototype.valOf=function(t){return xn(this.vec.toLazy(t))},n.prototype.prettyPrint=function(){return"(tail ".concat(this.vec.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),pr=function(t){function n(n,e,r,i,o){var a=t.call(this)||this;return a.length=n,a.target=e,a.motive=r,a.base=i,a.step=o,a}return i(n,t),n.prototype.valOf=function(t){return Bn(this.length.toLazy(t),this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t),this.step.toLazy(t))},n.prototype.prettyPrint=function(){return"ind-Vec ".concat(this.length.prettyPrint(),"\n              ").concat(this.target.prettyPrint(),"\n              ").concat(this.motive.prettyPrint(),"\n              ").concat(this.base.prettyPrint(),"\n              ").concat(this.step.prettyPrint())},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),hr=function(t){function n(n,e){var r=t.call(this)||this;return r.left=n,r.right=e,r}return i(n,t),n.prototype.valOf=function(t){return new we(this.left.toLazy(t),this.right.toLazy(t))},n.prototype.prettyPrint=function(){return"(Either ".concat(this.left.prettyPrint()," ").concat(this.right.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),fr=function(t){function n(n){var e=t.call(this)||this;return e.value=n,e}return i(n,t),n.prototype.valOf=function(t){return new ve(this.value.toLazy(t))},n.prototype.prettyPrint=function(){return"(left ".concat(this.value.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),lr=function(t){function n(n){var e=t.call(this)||this;return e.value=n,e}return i(n,t),n.prototype.valOf=function(t){return new de(this.value.toLazy(t))},n.prototype.prettyPrint=function(){return"(right ".concat(this.value.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),yr=function(t){function n(n,e,r,i){var o=t.call(this)||this;return o.target=n,o.motive=e,o.baseLeft=r,o.baseRight=i,o}return i(n,t),n.prototype.valOf=function(t){return function(t,n,r,i){var o=t.now();if(o instanceof ve)return bn(r,o.value);if(o instanceof de)return bn(i,o.value);if(o instanceof me){var a=o.type.now();if(a instanceof we){var u=a.leftType,s=a.rightType,c=new re("x",new we(u,s),new Vt((function(t){return new ge})));return new me(bn(n,t),new Tn(o.neutral,new Zt(c,n),new Zt(new re("x",u,new Vt((function(t){return bn(n,new ve(t))}))),r),new Zt(new re("x",s,new Vt((function(t){return bn(n,new de(t))}))),i)))}}throw new Error("invalid input for indEither: ".concat(e.inspect([t,n,r,i])))}(this.target.toLazy(t),this.motive.toLazy(t),this.baseLeft.toLazy(t),this.baseRight.toLazy(t))},n.prototype.prettyPrint=function(){return"(ind-Either ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint()," \n              ").concat(this.baseLeft.prettyPrint()," \n              ").concat(this.baseRight.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),wr=function(t){function n(n,e){var r=t.call(this)||this;return r.loc=n,r.type=e,r}return i(n,t),n.prototype.valOf=function(t){return new me(this.type.toLazy(t),new Jt(this.loc,this.type.toLazy(t)))},n.prototype.prettyPrint=function(){return"TODO ".concat(this.type.prettyPrint())},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne),vr=function(t){function n(n,e){var r=t.call(this)||this;return r.fun=n,r.arg=e,r}return i(n,t),n.prototype.valOf=function(t){return bn(this.fun.toLazy(t),this.arg.toLazy(t))},n.prototype.prettyPrint=function(){return"(".concat(this.fun.prettyPrint()," ").concat(this.arg.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(Ne);function dr(t,n){return Tr(0,new Map,new Map,t,n)}var mr=-1;function gr(t,n,e){return new Map(u([[n,e]],t,!0))}function Er(t,n){return n.has(t)&&n.get(t),mr}function Tr(t,n,e,r,i){if(r instanceof Le&&i instanceof Le){var o=r.name,a=i.name;if(Gt(o)&&Gt(a)){var u=Er(o,n),s=Er(a,e);return u!==mr&&s!==mr?u===s:u===mr&&s===mr&&o===a}return!1}return r instanceof Ue&&i instanceof Ue?r.sym===i.sym:r instanceof Re&&i instanceof Re||r instanceof He&&i instanceof He?Tr(t,n,e,r.type,i.type)&&Tr(t+1,gr(n,r.name,t),gr(e,i.name,t),r.body,i.body):r instanceof Me&&i instanceof Me?Tr(t+1,gr(n,r.param,t),gr(e,i.param,t),r.body,i.body):r instanceof _e&&i instanceof _e&&r.type instanceof Ze&&i.type instanceof Ze||(r instanceof vr&&i instanceof vr?Tr(t,n,e,r.fun,i.fun)&&Tr(t,n,e,r.arg,i.arg):r instanceof ke&&i instanceof ke||r instanceof Oe&&i instanceof Oe||r instanceof Se&&i instanceof Se||r instanceof qe&&i instanceof qe||r instanceof Ze&&i instanceof Ze||r instanceof Ye&&i instanceof Ye||r instanceof Ve&&i instanceof Ve||r instanceof ur&&i instanceof ur||r instanceof Ke&&i instanceof Ke||(r instanceof _e&&i instanceof _e?Tr(t,n,e,r.type,i.type)&&Tr(t,n,e,r.expr,i.expr):r instanceof Ge&&i instanceof Ge?Tr(t,n,e,r.elemType,i.elemType):r instanceof Ae&&i instanceof Ae?Tr(t,n,e,r.n,i.n):r instanceof xe&&i instanceof xe||r instanceof Ie&&i instanceof Ie||r instanceof Be&&i instanceof Be?Tr(t,n,e,r.target,i.target)&&Tr(t,n,e,r.base,i.base)&&Tr(t,n,e,r.step,i.step):r instanceof Ce&&i instanceof Ce?Tr(t,n,e,r.target,i.target)&&Tr(t,n,e,r.motive,i.motive)&&Tr(t,n,e,r.base,i.base)&&Tr(t,n,e,r.step,i.step):r instanceof ze&&i instanceof ze?Tr(t,n,e,r.first,i.first)&&Tr(t,n,e,r.second,i.second):r instanceof De&&i instanceof De||r instanceof Qe&&i instanceof Qe?Tr(t,n,e,r.pair,i.pair):r instanceof Fe&&i instanceof Fe?Tr(t,n,e,r.head,i.head)&&Tr(t,n,e,r.tail,i.tail):r instanceof Xe&&i instanceof Xe?Tr(t,n,e,r.target,i.target)&&Tr(t,n,e,r.base,i.base)&&Tr(t,n,e,r.step,i.step):r instanceof je&&i instanceof je?Tr(t,n,e,r.target,i.target)&&Tr(t,n,e,r.motive,i.motive)&&Tr(t,n,e,r.base,i.base)&&Tr(t,n,e,r.step,i.step):r instanceof We&&i instanceof We?Tr(t,n,e,r.target,i.target)&&Tr(t,n,e,r.motive,i.motive):r instanceof $e&&i instanceof $e?Tr(t,n,e,r.type,i.type)&&Tr(t,n,e,r.left,i.left)&&Tr(t,n,e,r.right,i.right):r instanceof Je&&i instanceof Je?Tr(t,n,e,r.type,i.type):r instanceof tr&&i instanceof tr?Tr(t,n,e,r.target,i.target)&&Tr(t,n,e,r.motive,i.motive)&&Tr(t,n,e,r.base,i.base):r instanceof nr&&i instanceof nr?Tr(t,n,e,r.left,i.left)&&Tr(t,n,e,r.right,i.right):r instanceof er&&i instanceof er?Tr(t,n,e,r.target,i.target)&&Tr(t,n,e,r.base,i.base)&&Tr(t,n,e,r.fun,i.fun):r instanceof rr&&i instanceof rr?Tr(t,n,e,r.equality,i.equality):r instanceof ir&&i instanceof ir?Tr(t,n,e,r.target,i.target)&&Tr(t,n,e,r.motive,i.motive)&&Tr(t,n,e,r.base,i.base):r instanceof or&&i instanceof or?Tr(t,n,e,r.type,i.type)&&Tr(t,n,e,r.length,i.length):r instanceof ar&&i instanceof ar?Tr(t,n,e,r.head,i.head)&&Tr(t,n,e,r.tail,i.tail):r instanceof sr&&i instanceof sr||r instanceof cr&&i instanceof cr?Tr(t,n,e,r.vec,i.vec):r instanceof pr&&i instanceof pr?Tr(t,n,e,r.length,i.length)&&Tr(t,n,e,r.target,i.target)&&Tr(t,n,e,r.motive,i.motive)&&Tr(t,n,e,r.base,i.base)&&Tr(t,n,e,r.step,i.step):r instanceof hr&&i instanceof hr?Tr(t,n,e,r.left,i.left)&&Tr(t,n,e,r.right,i.right):r instanceof fr&&i instanceof fr||r instanceof lr&&i instanceof lr?Tr(t,n,e,r.value,i.value):r instanceof yr&&i instanceof yr?Tr(t,n,e,r.target,i.target)&&Tr(t,n,e,r.motive,i.motive)&&Tr(t,n,e,r.baseLeft,i.baseLeft)&&Tr(t,n,e,r.baseRight,i.baseRight):r instanceof wr&&i instanceof wr&&(function(t,n){return t.startLine===n.startLine&&t.startColumn===n.startColumn&&t.endLine===n.endLine&&t.endColumn===n.endColumn}(r.loc,i.loc)&&Tr(t,n,e,r.type,i.type))))}function Pr(t,n){t.forInfo}function br(t,n){var e=t.get(n);return e||n}function Nr(t,n,e){return new Map(u([[n,e]],t,!0))}function _r(t,n,e,r){var i=e.readBackType(t),o=r.readBackType(t);return dr(i,o)?new Ut(void 0):new Ht(n,new Mt(["Expected ".concat(o," but got ").concat(i)]))}function kr(t,n,e,r,i){return dr(Rn(t,e,r),Rn(t,e,i))?new Ut(void 0):new Ht(n,new Mt(["The terms ".concat(r," and ").concat(i," are not the same ").concat(e,".")]))}function Or(t){return Sr(t.split(""))}function Sr(t){return 0===t.length||(n=t[0],!(!/^[a-zA-Z]$/.test(n)&&"-"!==t[0])&&Sr(t.slice(1)));var n}function Lr(t,n,e){return new ki(t.location,t,n,e)}var Ar=function(){function t(){}return t.synthNat=function(t,n){return new Ut(new _e(new ke,new Oe))},t.synthUniverse=function(t,n,e){return new Ht(e,new Mt(["U is a type, but it does not have a type."]))},t.synthArrow=function(t,n,e,r,i,o){if(0===o.length){var a=Kt(t,i,"x"),u=new zt("Aout"),s=new zt("Bout");return Dt([[u,function(){return r.check(t,n,new ge)}],[s,function(){return i.check(Kn(t,a,qn(t,u.value)),n,new ge)}]],(function(){return new Ut(new _e(new ke,new Re(a,u.value,s.value)))}))}var c=o[0],p=o.slice(1),h=Kt(t,Lr(i,c,p),"x"),f=new zt("Aout"),l=new zt("tout");return Dt([[f,function(){return r.check(t,n,new ge)}],[l,function(){return new Dr(Ot(e),i,c,p).check(Kn(t,h,qn(t,f.value)),n,new ge)}]],(function(){return new Ut(new _e(new ke,new Re(h,f.value,l.value)))}))},t.synthPi=function(t,n,e,r,i){if(1===r.length){var o=[r[0].binder,r[0].type],a=o[0],u=o[1],s=jt(t,a.varName),c=(a.location,new zt("Aout")),p=new zt("Bout");return Dt([[c,function(){return u.check(t,n,new ge)}],[p,function(){return i.check(Kn(t,s,qn(t,c.value)),Nr(n,a.varName,s),new ge)}]],(function(){return c.value,new Ut(new _e(new ke,new Re(s,c.value,p.value)))}))}if(r.length>1){var h=r[0],f=r.slice(1),l=[h.binder,h.type],y=l[0],w=l[1],v=(y.location,y.varName),d=jt(t,v),m=new zt("Aout"),g=new zt("Bout");return Dt([[m,function(){return w.check(t,n,new ge)}],[g,function(){return new Qr(Ot(e),f,i).check(Kn(t,d,qn(t,m.value)),Nr(n,v,d),new ge)}]],(function(){return m.value,new Ut(new _e(new ke,new Re(d,m.value,g.value)))}))}throw new Error("Invalid number of binders in Pi type")},t.synthZero=function(t,n){return new Ut(new _e(new Oe,new Se))},t.synthAdd1=function(t,n,e){var r=new zt("nout");return Dt([[r,function(){return e.check(t,n,new te)}]],(function(){return new Ut(new _e(new Oe,new Ae(r.value)))}))},t.synthWhichNat=function(t,n,e,r,i){var o=new zt("tgtout"),a=new zt("bout"),u=new zt("sout"),s=jt(t,"n_minus_1");return Dt([[o,function(){return e.check(t,n,new te)}],[a,function(){return r.synth(t,n)}],[u,function(){return i.check(t,n,new re(s,new te,new Ft(Dn(t),s,a.value.type)))}]],(function(){return new Ut(new _e(a.value.type,new xe(o.value,new _e(a.value.type,a.value.expr),u.value)))}))},t.synthIterNat=function(t,n,e,r,i){var o=new zt("tgtout"),a=new zt("bout"),u=new zt("sout");return Dt([[o,function(){return e.check(t,n,new te)}],[a,function(){return r.synth(t,n)}],[u,function(){return i.check(t,n,(e=jt(t,"old"),qn(t,new Re(e,a.value.type,a.value.type))));var e}]],(function(){return new Ut(new _e(a.value.type,new Ie(o.value,new _e(a.value.type,a.value.expr),u.value)))}))},t.synthRecNat=function(t,n,e,r,i){var o=new zt("tgtout"),a=new zt("bout"),u=new zt("sout");return Dt([[o,function(){return e.check(t,n,new te)}],[a,function(){return r.synth(t,n)}],[u,function(){return i.check(t,n,(e=jt(t,"n_minus_1"),r=jt(t,"old"),qn(t,new Re(e,new Oe,new Re(r,a.value.type,a.value.type)))));var e,r}]],(function(){return new Ut(new _e(a.value.type,new Be(o.value,new _e(a.value.type,a.value.expr),u.value)))}))},t.synthIndNat=function(t,n,e,r,i,o){var a=new zt("tgtout"),u=new zt("motout"),s=new zt("motval"),c=new zt("bout"),p=new zt("sout");return Dt([[a,function(){return e.check(t,n,new te)}],[u,function(){return r.check(t,n,new re("n",new te,new Vt((function(t){return new ge}))))}],[s,function(){return new Ut(qn(t,u.value))}],[c,function(){return i.check(t,n,bn(s.value,new ne))}],[p,function(){return o.check(t,n,new re("n_minus_1",new te,new Vt((function(t){return new re("ih",bn(s.value,t),new Vt((function(n){return bn(s.value,new ee(t))})))}))))}]],(function(){return new Ut(new _e(new vr(u.value,a.value),new Ce(a.value,u.value,c.value,p.value)))}))},t.synthAtom=function(t,n){return new Ut(new _e(new ke,new qe))},t.synthPair=function(t,n,e,r){var i=jt(t,"a"),o=new zt("Aout"),a=new zt("Dout");return Dt([[o,function(){return e.check(t,n,new ge)}],[a,function(){return r.check(Kn(t,i,qn(t,o.value)),n,new ge)}]],(function(){return new Ut(new _e(new ke,new He(i,o.value,a.value)))}))},t.synthSigma=function(t,n,e,r,i){if(1===r.length){var o=[r[0].binder,r[0].type],a=o[0],u=o[1],s=jt(t,a.varName),c=(a.location,new zt("Aout")),p=new zt("Dout");return Dt([[c,function(){return u.check(t,n,new ge)}],[p,function(){return i.check(Kn(t,s,qn(t,c.value)),Nr(n,a.varName,s),new ge)}]],(function(){return c.value,new Ut(new _e(new ke,new He(s,c.value,p.value)))}))}if(r.length>1){var h=r[0],f=r.slice(1),l=[h.binder,h.type],y=l[0],w=l[1],v=(y.location,y.varName),d=jt(t,v),m=new zt("Aout"),g=new zt("Dout");return Dt([[m,function(){return w.check(t,n,new ge)}],[g,function(){return new Vr(Ot(e),f,i).check(Kn(t,d,qn(t,m.value)),Nr(n,v,d),new ge)}]],(function(){return m.value,new Ut(new _e(new ke,new He(d,m.value,g.value)))}))}throw new Error("Invalid number of binders in Sigma type")},t.synthCar=function(t,n,e,r){var i=new zt("p_rst");return Dt([[i,function(){return r.synth(t,n)}]],(function(){var n=qn(t,i.value.type);return n instanceof oe?new Ut(new _e(n.carType.readBackType(t),new De(i.value.expr))):new Ht(e,new Mt(["car requires a Pair type, but was used as a: ".concat(n,".")]))}))},t.synthCdr=function(t,n,e,r){var i=new zt("pout");return Dt([[i,function(){return r.synth(t,n)}]],(function(){var n=qn(t,i.value.type);if(n instanceof oe){var r=[n.carName,n.carType,n.cdrType];return new Ut(new _e(r[2].valOfClosure(On(qn(t,i.value.expr))).readBackType(t),new Qe(i.value.expr)))}return new Ht(e,new Mt(["cdr requires a Pair type, but was used as a: ".concat(n,".")]))}))},t.synthQuote=function(t,n,e,r){return Or(r)?new Ut(new _e(new qe,new Ue(r))):new Ht(e,new Mt(["Invalid atom: ".concat(r,". Atoms consist of letters and hyphens.")]))},t.synthTrivial=function(t,n){return new Ut(new _e(new ke,new Ke))},t.synthSole=function(t,n){return new Ut(new _e(new Ke,new Ye))},t.synthIndList=function(t,n,e,r,i,o,a){var u=new zt("tgtout"),s=new zt("motout"),c=new zt("motval"),p=new zt("bout"),h=new zt("sout");return Dt([[u,function(){return r.synth(t,n)}]],(function(){var r=[u.value.type,u.value.expr],f=r[1],l=qn(t,r[0]);if(l instanceof ue){var y=l.entryType;return Dt([[s,function(){return i.check(t,n,new re("xs",new ue(y),new Ft(Dn(t),"xs",new ke)))}],[c,function(){return new Ut(qn(t,s.value))}],[p,function(){return o.check(t,n,bn(c.value,new se))}],[h,function(){return a.check(t,n,new re("e",y,new Vt((function(t){return new re("es",new ue(y),new Vt((function(n){return new re("ih",bn(c.value,n),new Vt((function(e){return bn(c.value,new ce(t,n))})))})))}))))}]],(function(){return new Ut(new _e(new vr(s.value,f),new je(f,s.value,p.value,h.value)))}))}return new Ht(e,new Mt(["Not a List: ".concat(l.readBackType(t),".")]))}))},t.synthRecList=function(t,n,e,r,i,o){var a=new zt("tgtout");return Dt([[a,function(){return r.synth(t,n)}]],(function(){var r=[a.value.type,a.value.expr],u=r[1],s=qn(t,r[0]);if(s instanceof ue){var c=s.entryType,p=new zt("bout"),h=new zt("btval"),f=new zt("sout");return Dt([[p,function(){return i.synth(t,n)}],[h,function(){return new Ut(qn(t,p.value.type))}],[f,function(){return o.check(t,n,new re("e",c,new Vt((function(t){return new re("es",new ue(c),new Vt((function(t){return new re("ih",h.value,new Vt((function(t){return h.value})))})))}))))}]],(function(){return new Ut(new _e(p.value.type,new Xe(u,new _e(p.value.type,p.value.expr),f.value)))}))}return new Ht(e,new Mt(["Not a List: ".concat(s.readBackType(t),".")]))}))},t.synthList=function(t,n,e){var r=new zt("Eout");return Dt([[r,function(){return e.entryType.check(t,n,new ge)}]],(function(){return new Ut(new _e(new ke,new Ge(r.value)))}))},t.synthListCons=function(t,n,e,r){var i=new zt("eout"),o=new zt("esout");return Dt([[i,function(){return e.synth(t,n)}],[o,function(){return r.check(t,n,qn(t,new Ge(i.value.type)))}]],(function(){return new Ut(new _e(new Ge(i.value.type),new Fe(i.value.expr,o.value)))}))},t.synthAbsurd=function(t,n,e){return new Ut(new _e(new ke,new Ze))},t.synthIndAbsurd=function(t,n,e){var r=new zt("tgtout"),i=new zt("motout");return Dt([[r,function(){return e.target.check(t,n,new be)}],[i,function(){return e.motive.check(t,n,new ge)}]],(function(){return new Ut(new _e(i.value,new We(r.value,i.value)))}))},t.synthEqual=function(t,n,e,r,i){var o=new zt("Aout"),a=new zt("Av"),u=new zt("from_out"),s=new zt("to_out");return Dt([[o,function(){return e.check(t,n,new ge)}],[a,function(){return new Ut(qn(t,o.value))}],[u,function(){return r.check(t,n,a.value)}],[s,function(){return i.check(t,n,a.value)}]],(function(){return new Ut(new _e(new ke,new $e(o.value,u.value,s.value)))}))},t.synthReplace=function(t,n,e,r,i,o){var a=new zt("tgt_rst"),u=new zt("motout"),s=new zt("bout");return Dt([[a,function(){return r.synth(t,n)}]],(function(){var r=qn(t,a.value.type);if(r instanceof pe){var c=[r.type,r.from,r.to],p=c[0],h=c[1],f=c[2];return Dt([[u,function(){return i.check(t,n,new re("x",p,new Vt((function(t){return new ge}))))}],[s,function(){return o.check(t,n,bn(qn(t,u.value),h))}]],(function(){return new Ut(new _e(bn(qn(t,u.value),f).readBackType(t),new tr(a.value.expr,u.value,s.value)))}))}return new Ht(e,new Mt(["Expected an expression with = type, but the type was: ".concat(a.value.type,".")]))}))},t.synthTrans=function(t,n,e,r,i){var o=new zt("p1_rst"),a=new zt("p2_rst");return Dt([[o,function(){return r.synth(t,n)}],[a,function(){return i.synth(t,n)}]],(function(){var n=qn(t,o.value.type),r=qn(t,a.value.type);if(n instanceof pe&&r instanceof pe){var i=[n.type,n.from,n.to],u=i[0],s=i[1],c=i[2],p=[r.type,r.from,r.to],h=p[0],f=p[1],l=p[2];return Dt([[new zt("_"),function(){return _r(t,e,u,h)}],[new zt("_"),function(){return kr(t,e,u,c,f)}]],(function(){return new Ut(new _e(new pe(u,s,l).readBackType(t),new nr(o.value.expr,a.value.expr)))}))}return new Ht(e,new Mt(["Expected =, got ".concat(n," and ").concat(r,".")]))}))},t.synthCong=function(t,n,e,r,i){var o=new zt("bout"),a=new zt("f_rst");return Dt([[o,function(){return r.synth(t,n)}],[a,function(){return i.synth(t,n)}]],(function(){var n=qn(t,o.value.type),r=qn(t,a.value.type);if(n instanceof pe){var i=[n.type,n.from,n.to],u=i[0],s=i[1],c=i[2];if(r instanceof re){var p=[r.argName,r.argType,r.resultType],h=p[1],f=p[2],l=new zt("ph"),y=new zt("Cv"),w=new zt("fv");return Dt([[l,function(){return _r(t,e,u,h)}],[y,function(){return new Ut(f.valOfClosure(s))}],[w,function(){return new Ut(qn(t,a.value.expr))}]],(function(){return new Ut(new _e(new $e(y.value.readBackType(t),Rn(t,y.value,bn(w.value,s)),Rn(t,y.value,bn(w.value,c))),new er(o.value.expr,y.value.readBackType(t),a.value.expr)))}))}return new Ht(e,new Mt(["Expected a function type, got ".concat(r.readBackType(t),".")]))}return new Ht(e,new Mt(["Expected an = type, got ".concat(n.readBackType(t),".")]))}))},t.synthSymm=function(t,n,e,r){var i=new zt("eout");return Dt([[i,function(){return r.synth(t,n)}]],(function(){var n=qn(t,i.value.type);if(n instanceof pe){var r=[n.type,n.from,n.to];return new Ut(new _e(new pe(r[0],r[2],r[1]).readBackType(t),new rr(i.value.expr)))}return new Ht(e,new Mt(["Expected an = type, got ".concat(n.readBackType(t),".")]))}))},t.synthIndEqual=function(t,n,e,r,i,o){var a=new zt("tgtout"),u=new zt("motout"),s=new zt("motv"),c=new zt("baseout");return Dt([[a,function(){return r.synth(t,n)}]],(function(){var r=qn(t,a.value.type);if(r instanceof pe){var p=[r.type,r.from,r.to],h=p[0],f=p[1],l=p[2];return Dt([[u,function(){return i.check(t,n,new re("to",h,new Vt((function(t){return new re("p",new pe(h,f,t),new Vt((function(t){return new ge})))}))))}],[s,function(){return new Ut(qn(t,u.value))}],[c,function(){return o.check(t,n,bn(bn(s.value,f),new he(f)))}]],(function(){return new Ut(new _e(bn(bn(s.value,l),qn(t,a.value.expr)).readBackType(t),new ir(a.value.expr,u.value,c.value)))}))}return new Ht(e,new Mt(["Expected evidence of equality, got ".concat(r.readBackType(t),".")]))}))},t.synthVec=function(t,n,e,r){var i=new zt("tout"),o=new zt("lenout");return Dt([[i,function(){return e.check(t,n,new ge)}],[o,function(){return r.check(t,n,new te)}]],(function(){return new Ut(new _e(new ke,new or(i.value,o.value)))}))},t.synthHead=function(t,n,e,r){var i=new zt("vout");return Dt([[i,function(){return r.synth(t,n)}]],(function(){var n=qn(t,i.value.type).now();if(n instanceof fe){var r=[n.entryType,n.length],o=r[1];return o instanceof ee?new Ut(new _e(r[0].readBackType(t),new sr(i.value.expr))):new Ht(e,new Mt(["Expected a Vec with add1 at the top of the length, got ".concat(Rn(t,new te,o),".")]))}return new Ht(e,new Mt(["Expected a Vec, got ".concat(n.readBackType(t),".")]))}))},t.synthTail=function(t,n,e,r){var i=new zt("vout");return Dt([[i,function(){return r.synth(t,n)}]],(function(){var n=qn(t,i.value.type).now();if(n instanceof fe){var r=[n.entryType,n.length],o=r[0],a=r[1];if(a instanceof ee){var u=a.smaller;return new Ut(new _e(new or(o.readBackType(t),Rn(t,new te,u)),new cr(i.value.expr)))}return new Ht(e,new Mt(["Expected a Vec with add1 at the top of the length, got ".concat(Rn(t,new te,a),".")]))}return new Ht(e,new Mt(["Expected a Vec, got ".concat(n.readBackType(t),".")]))}))},t.synthIndVec=function(t,n,e,r,i,o,a,u){var s=new zt("lenout"),c=new zt("lenv"),p=new zt("vecout"),h=new zt("motout"),f=new zt("motval"),l=new zt("bout"),y=new zt("sout");return Dt([[s,function(){return r.check(t,n,new te)}],[c,function(){return new Ut(qn(t,s.value))}],[p,function(){return i.synth(t,n)}]],(function(){var r=qn(t,p.value.type);if(r instanceof fe){var i=[r.entryType,r.length],w=i[0],v=i[1];return Dt([[new zt("_"),function(){return kr(t,e,new te,c.value,v)}],[h,function(){return o.check(t,n,new re("k",new te,new Vt((function(t){return new re("es",new fe(w,t),new Vt((function(t){return new ge})))}))))}],[f,function(){return new Ut(qn(t,h.value))}],[l,function(){return a.check(t,n,bn(bn(f.value,new ne),new le))}],[y,function(){return u.check(t,n,In(w,f.value))}]],(function(){return new Ut(new _e(new vr(new vr(h.value,s.value),p.value.expr),new pr(s.value,p.value.expr,h.value,l.value,y.value)))}))}return new Ht(e,new Mt(["Expected a Vec, got ".concat(r.readBackType(t),".")]))}))},t.synthEither=function(t,n,e,r){var i=new zt("Lout"),o=new zt("Rout");return Dt([[i,function(){return e.check(t,n,new ge)}],[o,function(){return r.check(t,n,new ge)}]],(function(){return new Ut(new _e(new ke,new hr(i.value,o.value)))}))},t.synthIndEither=function(t,n,e,r,i,o,a){var u=new zt("tgtout"),s=new zt("motout"),c=new zt("motval"),p=new zt("lout"),h=new zt("rout");return Dt([[u,function(){return r.synth(t,n)}]],(function(){var r=qn(t,u.value.type);if(r instanceof we){var f=[r.leftType,r.rightType],l=f[0],y=f[1];return Dt([[s,function(){return i.check(t,n,new re("x",new we(l,y),new Vt((function(t){return new ge}))))}],[c,function(){return new Ut(qn(t,s.value))}],[p,function(){return o.check(t,n,new re("x",l,new Vt((function(t){return bn(c.value,new ve(t))}))))}],[h,function(){return a.check(t,n,new re("x",y,new Vt((function(t){return bn(c.value,new de(t))}))))}]],(function(){return new Ut(new _e(new vr(s.value,u.value.expr),new yr(u.value.expr,s.value,p.value,h.value)))}))}return new Ht(e,new Mt(["Expected an Either, but got a ".concat(r.readBackType(t),".")]))}))},t.synthThe=function(t,n,e,r){var i=new zt("t_out"),o=new zt("e_out");return Dt([[i,function(){return e.isType(t,n)}],[o,function(){return r.check(t,n,qn(t,i.value))}]],(function(){return new Ut(new _e(i.value,o.value))}))},t.synthApplication=function(t,n,e,r,i,o){if(0===o.length){var a=new zt("fout");return Dt([[a,function(){return r.synth(t,n)}]],(function(){var r=qn(t,a.value.type);if(r instanceof re){var o=[r.argName,r.argType,r.resultType],u=o[1],s=o[2],c=new zt("argout");return Dt([[c,function(){return i.check(t,n,u)}]],(function(){return new Ut(new _e(s.valOfClosure(qn(t,c.value)).readBackType(t),new vr(a.value.expr,c.value)))}))}return new Ht(e,new Mt(["Not a function type: ".concat(r.readBackType(t),".")]))}))}var u=new zt("appout");return Dt([[u,function(){return new ki(Ot(e),r,i,o.slice(0,o.length-1)).synth(t,n)}]],(function(){var r=qn(t,u.value.type);if(r instanceof re){var i=[r.argName,r.argType,r.resultType],a=i[1],s=i[2],c=new zt("fout");return Dt([[c,function(){return o[o.length-1].check(t,n,a)}]],(function(){return new Ut(new _e(s.valOfClosure(qn(t,c.value)).readBackType(t),new vr(u.value.expr,c.value)))}))}return new Ht(e,new Mt(["Not a function type: ".concat(r.readBackType(t),".")]))}))},t.synthName=function(t,n,e,r){var i=br(n,r),o=new zt("x_tv");return Dt([[o,function(){return jn(t,0,i)}]],(function(){return t.get(i),new Ut(new _e(o.value.readBackType(t),new Le(i)))}))},t.synthNumber=function(t,n,e,r){if(0===r)return new Ut(new _e(new Oe,new Se));if(r>0){var i=new zt("n_1_out");return Dt([[i,function(){return new ni(e,r-1).check(t,n,new te)}]],(function(){return new Ut(new _e(new Oe,new Ae(i.value)))}))}return new Ht(e,new Mt(["Expected a positive number, got ".concat(r,".")]))},t}(),xr=function(){function t(t){this.location=t}return t.prototype.isType=function(t,n){var e=this,r=new zt("ok"),i=this.getType(t,n);return Dt([[r,function(){return i}]],(function(){return Pr(e.location,r.value),new Ut(r.value)}))},t.prototype.getType=function(t,n){var e=this,r=this.check(t,n,new ge);if(r instanceof Ut)return r;if(r instanceof Ht){if(this instanceof Gr&&Gt(this.name)){var i=new zt("other-tv");return new Dt([[i,function(){return jn(t,e.location,e.name)}]],(function(){new Ht(e.location,new Mt(["Expected , but given ".concat(i.value.readBackType(t))]))}))}return new Ht(this.location,new Mt(["not a type"]))}throw new Error("Invalid checkType")},t.prototype.check=function(t,n,e){var r=new zt("ok"),i=this.checkOut(t,n,e);return Dt([[r,function(){return i}]],(function(){return new Ut(r.value)}))},t.prototype.synth=function(t,n){var e=this,r=new zt("ok");return Dt([[r,function(){return e.synthHelper(t,n)}]],(function(){return Pr(e.location,r.value.type),new Ut(r.value)}))},t.prototype.checkOut=function(t,n,e){var r=this,i=new zt("theT");return Dt([[i,function(){return r.synth(t,n)}],[new zt("_"),function(){return _r(t,r.location,qn(t,i.value.type),e)}]],(function(){return new Ut(i.value.expr)}))},t}(),Ir=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.type=e,i.value=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthThe(t,n,this.type,this.value)},n.prototype.findNames=function(){return this.type.findNames().concat(this.value.findNames())},n.prototype.prettyPrint=function(){return"(the ".concat(this.type.prettyPrint()," ").concat(this.value.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Br=function(t){function n(n){var e=t.call(this,n)||this;return e.location=n,e}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthUniverse(t,n,this.location)},n.prototype.findNames=function(){return[]},n.prototype.getType=function(t,n){return new Ut(new ke)},n.prototype.prettyPrint=function(){return"U"},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Cr=function(t){function n(n){var e=t.call(this,n)||this;return e.location=n,e}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthNat(t,n)},n.prototype.findNames=function(){return[]},n.prototype.getType=function(t,n){return new Ut(new Oe)},n.prototype.prettyPrint=function(){return"Nat"},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Rr=function(t){function n(n){var e=t.call(this,n)||this;return e.location=n,e}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthZero(t,n)},n.prototype.findNames=function(){return[]},n.prototype.prettyPrint=function(){return"zero"},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Mr=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.base=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthAdd1(t,n,this.base)},n.prototype.findNames=function(){return this.base.findNames()},n.prototype.prettyPrint=function(){return"(add1 ".concat(this.base.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),qr=function(t){function n(n,e,r,i){var o=t.call(this,n)||this;return o.location=n,o.target=e,o.base=r,o.step=i,o}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthWhichNat(t,n,this.target,this.base,this.step)},n.prototype.findNames=function(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())},n.prototype.prettyPrint=function(){return"(which-nat ".concat(this.target.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Ur=function(t){function n(n,e,r,i){var o=t.call(this,n)||this;return o.location=n,o.target=e,o.base=r,o.step=i,o}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthIterNat(t,n,this.target,this.base,this.step)},n.prototype.findNames=function(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())},n.prototype.prettyPrint=function(){return"(iter-nat ".concat(this.target.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Hr=function(t){function n(n,e,r,i){var o=t.call(this,n)||this;return o.location=n,o.target=e,o.base=r,o.step=i,o}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthRecNat(t,n,this.target,this.base,this.step)},n.prototype.findNames=function(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())},n.prototype.prettyPrint=function(){return"(rec-nat ".concat(this.target.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),zr=function(t){function n(n,e,r,i,o){var a=t.call(this,n)||this;return a.location=n,a.target=e,a.motive=r,a.base=i,a.step=o,a}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthIndNat(t,n,this.target,this.motive,this.base,this.step)},n.prototype.findNames=function(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames()).concat(this.step.findNames())},n.prototype.prettyPrint=function(){return"(ind-nat ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Dr=function(t){function n(n,e,r,i){var o=t.call(this,n)||this;return o.location=n,o.arg1=e,o.arg2=r,o.args=i,o}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthArrow(t,n,this.location,this.arg1,this.arg2,this.args)},n.prototype.findNames=function(){return this.arg1.findNames().concat(this.arg2.findNames()).concat(this.args.flatMap((function(t){return t.findNames()})))},n.prototype.getType=function(t,e){var r=this,i=[this.arg1,this.arg2,this.args],o=i[0],a=i[1],u=i[2];if(0===u.length){var s=Kt(t,a,"x"),c=new zt("Aout"),p=new zt("Bout");return Dt([[c,function(){return o.isType(t,e)}],[p,function(){return a.isType(Kn(t,s,qn(t,c.value)),e)}]],(function(){return new Ut(new Re(s,c.value,p.value))}))}var h=u[0],f=u.slice(1),l=Kt(t,Lr(a,h,f),"x"),y=new zt("Aout"),w=new zt("tout");return Dt([[y,function(){return o.isType(t,e)}],[w,function(){return new n(Ot(r.location),a,h,f).isType(Kn(t,l,qn(t,y.value)),e)}]],(function(){return new Ut(new Re(l,y.value,w.value))}))},n.prototype.prettyPrint=function(){return"(-> ".concat(this.arg1.prettyPrint()," ").concat(this.arg2.prettyPrint()," ").concat(this.args.map((function(t){return t.prettyPrint()})).join(" "),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Qr=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.binders=e,i.body=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthPi(t,n,this.location,this.binders,this.body)},n.prototype.findNames=function(){return this.binders.flatMap((function(t){return Yt(t)})).concat(this.body.findNames())},n.prototype.getType=function(t,e){var r=this,i=[this.binders,this.body],o=i[0],a=i[1];if(1===o.length){var u=[o[0].binder,o[0].type],s=u[0],c=u[1],p=jt(t,s.varName),h=(s.location,new zt("Aout")),f=new zt("Aoutv"),l=new zt("Bout");return Dt([[h,function(){return c.isType(t,e)}],[f,function(){return new Ut(qn(t,h.value))}],[l,function(){return a.isType(Kn(t,p,f.value),Nr(e,s.varName,p))}]],(function(){return h.value,new Ut(new Re(p,h.value,l.value))}))}if(o.length>1){var y=o[0],w=o.slice(1),v=[y.binder.varName,y.type],d=v[1],m=jt(t,v[0]),g=(y.binder.location,new zt("Aout")),E=new zt("Aoutv"),T=new zt("Bout");return Dt([[g,function(){return d.isType(t,e)}],[E,function(){return new Ut(qn(t,g.value))}],[T,function(){return new n(Ot(r.location),w,a).isType(Kn(t,m,E.value),Nr(e,y.binder.varName,m))}]],(function(){return g.value,new Ut(new Re(m,g.value,T.value))}))}throw new Error("Invalid number of binders in Pi type")},n.prototype.prettyPrint=function(){return"(Π ".concat(this.binders.map((function(t){return"(".concat(t.binder.varName," ").concat(t.type.prettyPrint(),")")})).join(" ")," \n            ").concat(this.body.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Fr=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.binders=e,i.body=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){throw new Error("Method not implemented.")},n.prototype.findNames=function(){return this.binders.map((function(t){return t.varName})).concat(this.body.findNames())},n.prototype.checkOut=function(t,n,e){if(1===this.binders.length){var r=this.body,i=this.binders[0],o=i.varName,a=i.location,u=e.now();if(u instanceof re){var s=u.argType,c=u.resultType,p=br(n,o),h=new zt("bout");return Dt([[h,function(){return r.check(Kn(t,p,s),Nr(n,o,p),c.valOfClosure(new me(s,new $t(p))))}]],(function(){return s.readBackType(t),new Ut(new Me(p,h.value))}))}return new Ht(a,new Mt(["Not a function type: ".concat(u.readBackType(t),".")]))}return new Fr(this.location,[this.binders[0]],new Fr(Ot(this.location),this.binders.slice(1),this.body)).check(t,n,e)},n.prototype.prettyPrint=function(){return"(lambda ".concat(this.binders.map((function(t){return t.varName})).join(" ")," ").concat(this.body.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Vr=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.binders=e,i.body=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthSigma(t,n,this.location,this.binders,this.body)},n.prototype.findNames=function(){return this.binders.flatMap((function(t){return Yt(t)})).concat(this.body.findNames())},n.prototype.getType=function(t,e){var r=this,i=[this.binders,this.body],o=i[0],a=i[1];if(1===o.length){var s=[o[0].binder,o[0].type],c=s[1],p=(d=s[0]).varName,h=jt(t,p),f=(d.location,new zt("Aout")),l=new zt("Aoutv"),y=new zt("Dout");return Dt([[f,function(){return c.isType(t,e)}],[l,function(){return new Ut(qn(t,f.value))}],[y,function(){return a.isType(Kn(t,h,l.value),Nr(e,p,h))}]],(function(){return f.value,new Ut(new He(h,f.value,y.value))}))}if(o.length>1){var w=u([[o[0].binder,o[0].type],o[1]],o.slice(2),!0),v=w[0],d=v[0],m=v[1],g=w.slice(1),E=d.varName,T=jt(t,E),P=(d.location,new zt("Aout")),b=new zt("Aoutv"),N=new zt("Dout");return Dt([[P,function(){return m.isType(t,e)}],[b,function(){return new Ut(qn(t,P.value))}],[N,function(){return new n(r.location,g,a).isType(Kn(t,E,b.value),Nr(e,E,T))}]],(function(){return P.value,new Ut(new He(T,P.value,N.value))}))}throw new Error("Invalid number of binders in Sigma type")},n.prototype.prettyPrint=function(){return"(Σ ".concat(this.binders.map((function(t){return"(".concat(t.binder.varName," ").concat(t.type.prettyPrint(),")")})).join(" ")," \n            ").concat(this.body.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Gr=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.name=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthName(t,n,this.location,this.name)},n.prototype.findNames=function(){return[this.name]},n.prototype.prettyPrint=function(){return this.name},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Xr=function(t){function n(n){var e=t.call(this,n)||this;return e.location=n,e}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthAtom(t,n)},n.prototype.findNames=function(){return[]},n.prototype.getType=function(t,n){return new Ut(new qe)},n.prototype.prettyPrint=function(){return"Atom"},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),jr=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.name=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthQuote(t,n,this.location,this.name)},n.prototype.findNames=function(){return[]},n.prototype.prettyPrint=function(){return"'".concat(this.name)},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Kr=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.first=e,i.second=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthPair(t,n,this.first,this.second)},n.prototype.findNames=function(){return this.first.findNames().concat(this.second.findNames())},n.prototype.getType=function(t,n){var e=this,r=new zt("Aout"),i=new zt("Dout"),o=Kt(t,this.second,"x");return Dt([[r,function(){return e.first.isType(t,n)}],[i,function(){return e.second.isType(Kn(t,o,qn(t,r.value)),n)}]],(function(){return new Ut(new He(o,r.value,i.value))}))},n.prototype.prettyPrint=function(){return"(Pair ".concat(this.first.prettyPrint()," ").concat(this.second.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Yr=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.first=e,i.second=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){throw new Error("Method not implemented.")},n.prototype.findNames=function(){return this.first.findNames().concat(this.second.findNames())},n.prototype.checkOut=function(t,n,e){var r=this,i=e.now();if(i instanceof oe){var o=i.carType,a=i.cdrType,u=new zt("aout"),s=new zt("dout");return Dt([[u,function(){return r.first.check(t,n,o)}],[s,function(){return r.second.check(t,n,a.valOfClosure(qn(t,u.value)))}]],(function(){return new Ut(new ze(u.value,s.value))}))}return new Ht(this.location,new Mt(["cons requires a Pair or Σ type, but was used as a: ".concat(i.readBackType(t),".")]))},n.prototype.prettyPrint=function(){return"(cons ".concat(this.first.prettyPrint()," ").concat(this.second.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Zr=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.pair=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthCar(t,n,this.location,this.pair)},n.prototype.findNames=function(){return this.pair.findNames()},n.prototype.prettyPrint=function(){return"(car ".concat(this.pair.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Wr=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.pair=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthCdr(t,n,this.location,this.pair)},n.prototype.findNames=function(){return this.pair.findNames()},n.prototype.prettyPrint=function(){return"(cdr ".concat(this.pair.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),$r=function(t){function n(n){var e=t.call(this,n)||this;return e.location=n,e}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthTrivial(t,n)},n.prototype.findNames=function(){return[]},n.prototype.getType=function(t,n){return new Ut(new Ke)},n.prototype.prettyPrint=function(){return"Trivial"},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Jr=function(t){function n(n){var e=t.call(this,n)||this;return e.location=n,e}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthSole(t,n)},n.prototype.findNames=function(){return[]},n.prototype.prettyPrint=function(){return"Sole"},n}(xr),ti=function(t){function n(n){var e=t.call(this,n)||this;return e.location=n,e}return i(n,t),n.prototype.synthHelper=function(t,n){throw new Error("Method not implemented.")},n.prototype.findNames=function(){return[]},n.prototype.checkOut=function(t,n,e){var r=e.now();return r instanceof ue?new Ut(new Ve):new Ht(this.location,new Mt(["nil requires a List type, but was used as a: ".concat(r.readBackType(t),".")]))},n.prototype.prettyPrint=function(){return"nil"},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),ni=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.value=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthNumber(t,n,this.location,this.value)},n.prototype.findNames=function(){return[]},n.prototype.prettyPrint=function(){return"".concat(this.value)},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),ei=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.entryType=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthList(t,n,this)},n.prototype.findNames=function(){return this.entryType.findNames()},n.prototype.getType=function(t,n){var e=this,r=new zt("Eout");return Dt([[r,function(){return e.entryType.isType(t,n)}]],(function(){return new Ut(new Ge(r.value))}))},n.prototype.prettyPrint=function(){return"(List ".concat(this.entryType.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),ri=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.x=e,i.xs=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthListCons(t,n,this.x,this.xs)},n.prototype.findNames=function(){return this.x.findNames().concat(this.xs.findNames())},n.prototype.prettyPrint=function(){return"(:: ".concat(this.x.prettyPrint()," ").concat(this.xs.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),ii=function(t){function n(n,e,r,i){var o=t.call(this,n)||this;return o.location=n,o.target=e,o.base=r,o.step=i,o}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthRecList(t,n,this.location,this.target,this.base,this.step)},n.prototype.findNames=function(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())},n.prototype.prettyPrint=function(){return"(rec-list ".concat(this.target.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),oi=function(t){function n(n,e,r,i,o){var a=t.call(this,n)||this;return a.location=n,a.target=e,a.motive=r,a.base=i,a.step=o,a}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthIndList(t,n,this.location,this.target,this.motive,this.base,this.step)},n.prototype.findNames=function(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames()).concat(this.step.findNames())},n.prototype.prettyPrint=function(){return"(ind-list ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint()," \n              ").concat(this.base.prettyPrint()," \n              ").concat(this.step.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),ai=function(t){function n(n){var e=t.call(this,n)||this;return e.location=n,e}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthAbsurd(t,n,this)},n.prototype.findNames=function(){return[]},n.prototype.getType=function(t,n){return new Ut(new Ze)},n.prototype.prettyPrint=function(){return"Absurd"},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),ui=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.target=e,i.motive=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthIndAbsurd(t,n,this)},n.prototype.findNames=function(){return this.target.findNames().concat(this.motive.findNames())},n.prototype.prettyPrint=function(){return"(ind-Absurd \n              ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),si=function(t){function n(n,e,r,i){var o=t.call(this,n)||this;return o.location=n,o.type=e,o.left=r,o.right=i,o}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthEqual(t,n,this.type,this.left,this.right)},n.prototype.findNames=function(){return this.type.findNames().concat(this.left.findNames()).concat(this.right.findNames())},n.prototype.getType=function(t,n){var e=[this.type,this.left,this.right],r=e[0],i=e[1],o=e[2],a=new zt("Aout"),u=new zt("Av"),s=new zt("from_out"),c=new zt("to_out");return Dt([[a,function(){return r.isType(t,n)}],[u,function(){return new Ut(qn(t,a.value))}],[s,function(){return i.check(t,n,u.value)}],[c,function(){return o.check(t,n,u.value)}]],(function(){return new Ut(new $e(a.value,s.value,c.value))}))},n.prototype.prettyPrint=function(){return"(= ".concat(this.type.prettyPrint()," \n              ").concat(this.left.prettyPrint()," \n              ").concat(this.right.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),ci=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.type=e,r}return i(n,t),n.prototype.findNames=function(){return this.type.findNames()},n.prototype.synthHelper=function(t,n){throw new Error("Method not implemented.")},n.prototype.checkOut=function(t,n,e){var r=this,i=e.now();if(i instanceof pe){var o=i.type,a=i.from,u=i.to,s=new zt("cout"),c=new zt("val");return Dt([[s,function(){return r.type.check(t,n,o)}],[c,function(){return new Ut(qn(t,s.value))}],[new zt("_"),function(){return kr(t,r.type.location,o,a,c.value)}],[new zt("_"),function(){return kr(t,r.type.location,o,u,c.value)}]],(function(){return new Ut(new Je(s.value))}))}return new Ht(this.location,new Mt(["same requires an Equal type, but was used as a: ".concat(i.readBackType(t),".")]))},n.prototype.prettyPrint=function(){return"(same ".concat(this.type.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),pi=function(t){function n(n,e,r,i){var o=t.call(this,n)||this;return o.location=n,o.target=e,o.motive=r,o.base=i,o}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthReplace(t,n,this.location,this.target,this.motive,this.base)},n.prototype.findNames=function(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames())},n.prototype.prettyPrint=function(){return"(replace ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint()," \n              ").concat(this.base.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),hi=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.left=e,i.right=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthTrans(t,n,this.location,this.left,this.right)},n.prototype.findNames=function(){return this.left.findNames().concat(this.right.findNames())},n.prototype.prettyPrint=function(){return"(trans ".concat(this.left.prettyPrint()," ").concat(this.right.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),fi=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.target=e,i.fun=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthCong(t,n,this.location,this.target,this.fun)},n.prototype.findNames=function(){return this.target.findNames().concat(this.fun.findNames())},n.prototype.prettyPrint=function(){return"(cong ".concat(this.target.prettyPrint()," ").concat(this.fun.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),li=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.equality=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthSymm(t,n,this.location,this.equality)},n.prototype.findNames=function(){return this.equality.findNames()},n.prototype.prettyPrint=function(){return"(symm ".concat(this.equality.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),yi=function(t){function n(n,e,r,i){var o=t.call(this,n)||this;return o.location=n,o.target=e,o.motive=r,o.base=i,o}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthIndEqual(t,n,this.location,this.target,this.motive,this.base)},n.prototype.findNames=function(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames())},n.prototype.prettyPrint=function(){return"(ind-= ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint()," \n              ").concat(this.base.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),wi=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.type=e,i.length=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthVec(t,n,this.type,this.length)},n.prototype.findNames=function(){return this.type.findNames().concat(this.length.findNames())},n.prototype.getType=function(t,n){var e=this,r=new zt("Eout"),i=new zt("lenout");return Dt([[r,function(){return e.isType(t,n)}],[i,function(){return e.length.check(t,n,new te)}]],(function(){return new Ut(new or(r.value,i.value))}))},n.prototype.prettyPrint=function(){return"(Vec ".concat(this.type.prettyPrint()," ").concat(this.length.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),vi=function(t){function n(n){var e=t.call(this,n)||this;return e.location=n,e}return i(n,t),n.prototype.synthHelper=function(t,n){throw new Error("Method not implemented.")},n.prototype.findNames=function(){return[]},n.prototype.checkOut=function(t,n,e){var r=e.now();return r instanceof fe?r.length instanceof ne?new Ut("vecnil"):new Ht(this.location,new Mt(["vecnil requires a Vec type with length ZERO, but was used as a: \n          ".concat(Rn(t,new te,r.length),".")])):new Ht(this.location,new Mt(["vecnil requires a Vec type, but was used as a: ".concat(r.readBackType(t),".")]))},n.prototype.prettyPrint=function(){return"vecnil"},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),di=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.x=e,i.xs=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){throw new Error("Method not implemented.")},n.prototype.findNames=function(){return this.x.findNames().concat(this.xs.findNames())},n.prototype.checkOut=function(t,n,e){var r=this,i=e.now();if(i instanceof fe){if(i.length instanceof ee){var o=new zt("hout"),a=new zt("tout"),u=i.length.smaller;return Dt([[o,function(){return r.x.check(t,n,i.entryType)}],[a,function(){return r.xs.check(t,n,new fe(i.entryType,u))}]],(function(){return new Ut(new ar(o.value,a.value))}))}return new Ht(this.location,new Mt(["vec:: requires a Vec type with length Add1, but was used with a: \n          ".concat(Rn(t,new te,i.length),".")]))}return new Ht(this.location,new Mt(["vec:: requires a Vec type, but was used as a: ".concat(i.readBackType(t),".")]))},n.prototype.prettyPrint=function(){return"(vec:: ".concat(this.x.prettyPrint()," ").concat(this.xs.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),mi=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.vec=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthHead(t,n,this.location,this.vec)},n.prototype.findNames=function(){return this.vec.findNames()},n.prototype.prettyPrint=function(){return"(head ".concat(this.vec.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),gi=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.vec=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthTail(t,n,this.location,this.vec)},n.prototype.findNames=function(){return this.vec.findNames()},n.prototype.prettyPrint=function(){return"(tail ".concat(this.vec.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Ei=function(t){function n(n,e,r,i,o,a){var u=t.call(this,n)||this;return u.location=n,u.length=e,u.target=r,u.motive=i,u.base=o,u.step=a,u}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthIndVec(t,n,this.location,this.length,this.target,this.motive,this.base,this.step)},n.prototype.findNames=function(){return this.length.findNames().concat(this.target.findNames()).concat(this.motive.findNames()).concat(this.base.findNames()).concat(this.step.findNames())},n.prototype.prettyPrint=function(){return"ind-Vec ".concat(this.length.prettyPrint(),"\n              ").concat(this.target.prettyPrint(),"\n              ").concat(this.motive.prettyPrint(),"\n              ").concat(this.base.prettyPrint(),"\n              ").concat(this.step.prettyPrint())},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Ti=function(t){function n(n,e,r){var i=t.call(this,n)||this;return i.location=n,i.left=e,i.right=r,i}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthEither(t,n,this.left,this.right)},n.prototype.findNames=function(){return this.left.findNames().concat(this.right.findNames())},n.prototype.getType=function(t,n){var e=this,r=new zt("Lout"),i=new zt("Rout");return Dt([[r,function(){return e.left.isType(t,n)}],[i,function(){return e.right.isType(t,n)}]],(function(){return new Ut(new hr(r.value,i.value))}))},n.prototype.prettyPrint=function(){return"(Either ".concat(this.left.prettyPrint()," ").concat(this.right.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Pi=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.value=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){throw new Error("Method not implemented.")},n.prototype.findNames=function(){return this.value.findNames()},n.prototype.checkOut=function(t,n,e){var r=this,i=e.now();if(i instanceof we){var o=new zt("lout");return Dt([[o,function(){return r.value.check(t,n,i.leftType)}]],(function(){return new Ut(new fr(o.value))}))}return new Ht(this.location,new Mt(["left requires an Either type, but was used as a: ".concat(i.readBackType(t),".")]))},n.prototype.prettyPrint=function(){return"(left ".concat(this.value.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),bi=function(t){function n(n,e){var r=t.call(this,n)||this;return r.location=n,r.value=e,r}return i(n,t),n.prototype.synthHelper=function(t,n){throw new Error("Method not implemented.")},n.prototype.findNames=function(){return this.value.findNames()},n.prototype.checkOut=function(t,n,e){var r=this,i=e.now();if(i instanceof we){var o=new zt("rout");return Dt([[o,function(){return r.value.check(t,n,i.rightType)}]],(function(){return new Ut(new lr(o.value))}))}return new Ht(this.location,new Mt(["right requires an Either type, but was used as a: ".concat(i.readBackType(t),".")]))},n.prototype.prettyPrint=function(){return"(right ".concat(this.value.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),Ni=function(t){function n(n,e,r,i,o){var a=t.call(this,n)||this;return a.location=n,a.target=e,a.motive=r,a.baseLeft=i,a.baseRight=o,a}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthIndEither(t,n,this.location,this.target,this.motive,this.baseLeft,this.baseRight)},n.prototype.findNames=function(){return this.target.findNames().concat(this.motive.findNames()).concat(this.baseLeft.findNames()).concat(this.baseRight.findNames())},n.prototype.prettyPrint=function(){return"(ind-Either ".concat(this.target.prettyPrint()," \n              ").concat(this.motive.prettyPrint()," \n              ").concat(this.baseLeft.prettyPrint()," \n              ").concat(this.baseRight.prettyPrint(),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),_i=function(t){function n(n){var e=t.call(this,n)||this;return e.location=n,e}return i(n,t),n.prototype.synthHelper=function(t,n){throw new Error("Method not implemented.")},n.prototype.findNames=function(){return[]},n.prototype.checkOut=function(t,n,e){var r=e.readBackType(t);return Pr(this.location,Un(t)),new Ut(new wr(this.location.locationToSrcLoc(),r))},n.prototype.prettyPrint=function(){return"TODO"},n.prototype.toString=function(){return this.prettyPrint()},n}(xr),ki=function(t){function n(n,e,r,i){var o=t.call(this,n)||this;return o.location=n,o.func=e,o.arg=r,o.args=i,o}return i(n,t),n.prototype.synthHelper=function(t,n){return Ar.synthApplication(t,n,this.location,this.func,this.arg,this.args)},n.prototype.findNames=function(){return this.func.findNames().concat(this.arg.findNames()).concat(this.args.flatMap((function(t){return t.findNames()})))},n.prototype.prettyPrint=function(){return"(".concat(this.func.prettyPrint()," ").concat(this.arg.prettyPrint()," ").concat(this.args.map((function(t){return t.prettyPrint()})).join(" "),")")},n.prototype.toString=function(){return this.prettyPrint()},n}(xr);function Oi(t){return new kt(t,!0)}function Si(t){return new Ct(Oi(t),t.source)}function Li(t){if(t instanceof yt.Symbol)return t.value;if(t instanceof yt.NumericLiteral)return t.value;if(t instanceof wt.List)return Li(t.elements[0]);throw new Error("Expected a Element, but got: "+t)}function Ai(t,n){return new _t(n.start,n.end,t)}function xi(t,n){return Ai(Li(t),n)}function Ii(t){var n=new Tt(t);return new bt("",n.scanTokens()).parse()}var Bi=function(){function t(){}return t.parsePie=function(t){return this.parseElements(Ii(t)[0])},t.parseElements=function(t){var n,e=this,r=Li(t);if("U"===r)return n=Ai("U",t.location),new Br(Oi(n));if("the"===r){var i=t.elements;return function(t,n,e){return new Ir(Oi(t),n,e)}(Ai("the",o=t.location),this.parseElements(i[1]),this.parseElements(i[2]))}if("Nat"===r)return function(t){return new Cr(Oi(t))}(Ai("Nat",t.location));if("zero"===r)return function(t){return new Rr(Oi(t))}(Ai("zero",t.location));if("add1"===r)return function(t,n){return new Mr(Oi(t),n)}(Ai("add1",t.location),this.parseElements(t.elements[1]));if("->"===r||"→"===r){i=t.elements;return function(t,n){return new Dr(Oi(t),n[0],n[1],n[2])}(Ai("->",o=t.location),[this.parseElements(i[1]),this.parseElements(i[2]),i.slice(3).map((function(t){return e.parseElements(t)}))])}if("lambda"===r||"λ"===r){i=t.elements;var o=t.location,a=i[1],u=i[2];return function(t,n,e){return new Fr(Oi(t),n,e)}(Ai("λ",o),a.elements.map((function(n){return Si(xi(n,t.location))})),this.parseElements(u))}if("Pi"===r||"Π"===r){a=(i=t.elements)[1],u=i[2];var s=(h=a.elements[0]).elements[0],c=h.elements[1],p=a.elements.slice(1).map((function(t){var n=t.elements[0],r=t.elements[1];return new Rt(Si(xi(n,t.location)),e.parseElements(r))}));return function(t,n,e){return new Qr(Oi(t),n,e)}(Ai("Π",t.location),Ci(new Rt(Si(xi(s,h.location)),this.parseElements(c)),p),this.parseElements(u))}if("Sigma"===r||"Σ"===r){var h;a=(i=t.elements)[1],u=i[2],s=(h=a.elements[0]).elements[0],c=h.elements[1],p=a.elements.slice(1).map((function(t){var n=t.elements[0],r=t.elements[1];return new Rt(Si(xi(n,t.location)),e.parseElements(r))}));return function(t,n,e){return new Vr(Oi(t),n,e)}(Ai("Π",t.location),Ci(new Rt(Si(xi(s,h.location)),this.parseElements(c)),p),this.parseElements(u))}if("Pair"===r){i=t.elements;return function(t,n,e){return new Kr(Oi(t),n,e)}(Ai("Pair",t.location),this.parseElements(i[1]),this.parseElements(i[2]))}if("cons"===r){i=t.elements;return function(t,n,e){return new Yr(Oi(t),n,e)}(Ai("Cons",t.location),this.parseElements(i[1]),this.parseElements(i[2]))}if("car"===r)return function(t,n){return new Zr(Oi(t),n)}(Ai("car",t.location),this.parseElements(t.elements[1]));if("cdr"===r)return function(t,n){return new Wr(Oi(t),n)}(Ai("cdr",t.location),this.parseElements(t.elements[1]));if("which-Nat"===r){i=t.elements;return function(t,n,e,r){return new qr(Oi(t),n,e,r)}(Ai("which-Nat",t.location),this.parseElements(i[1]),this.parseElements(i[2]),this.parseElements(i[3]))}if("iter-Nat"===r){i=t.elements;return function(t,n,e,r){return new Ur(Oi(t),n,e,r)}(Ai("iter-Nat",t.location),this.parseElements(i[1]),this.parseElements(i[2]),this.parseElements(i[3]))}if("rec-Nat"===r){i=t.elements;return function(t,n,e,r){return new Hr(Oi(t),n,e,r)}(Ai("rec-Nat",t.location),this.parseElements(i[1]),this.parseElements(i[2]),this.parseElements(i[3]))}if("ind-Nat"===r){i=t.elements;return function(t,n,e,r,i){return new zr(Oi(t),n,e,r,i)}(Ai("ind-Nat",t.location),this.parseElements(i[1]),this.parseElements(i[2]),this.parseElements(i[3]),this.parseElements(i[4]))}if("Atom"===r)return function(t){return new Xr(Oi(t))}(Ai("Atom",t.location));if("quote"===r)return function(t,n){return new jr(Oi(t),n)}(Ai("Quote",t.location),Li(t.elements[1]));if("Trivial"===r)return function(t){return new $r(Oi(t))}(Ai("Trivial",t.location));if("sole"===r)return function(t){return new Jr(Oi(t))}(Ai("sole",t.location));if("List"===r)return function(t,n){return new ei(Oi(t),n)}(Ai("List",t.location),this.parseElements(t.elements[1]));if("nil"===r)return function(t){return new ti(Oi(t))}(Ai("nil",t.location));if("::"===r){i=t.elements;return function(t,n,e){return new ri(Oi(t),n,e)}(Ai("::",t.location),this.parseElements(i[1]),this.parseElements(i[2]))}if("rec-List"===r){i=t.elements;return function(t,n,e,r){return new ii(Oi(t),n,e,r)}(Ai("rec-List",t.location),this.parseElements(i[1]),this.parseElements(i[2]),this.parseElements(i[3]))}if("ind-List"===r){i=t.elements;return function(t,n,e,r,i){return new oi(Oi(t),n,e,r,i)}(Ai("ind-List",t.location),this.parseElements(i[1]),this.parseElements(i[2]),this.parseElements(i[3]),this.parseElements(i[4]))}if("="===r){i=t.elements;return function(t,n,e,r){return new si(Oi(t),n,e,r)}(Ai("=",t.location),this.parseElements(i[1]),this.parseElements(i[2]),this.parseElements(i[3]))}if("same"===r)return function(t,n){return new ci(Oi(t),n)}(Ai("same",t.location),this.parseElements(t.elements[1]));if("replace"===r){i=t.elements;return function(t,n,e,r){return new pi(Oi(t),n,e,r)}(Ai("replace",t.location),this.parseElements(i[1]),this.parseElements(i[2]),this.parseElements(i[3]))}if("trans"===r){i=t.elements;return function(t,n,e){return new hi(Oi(t),n,e)}(Ai("trans",t.location),this.parseElements(i[1]),this.parseElements(i[2]))}if("cong"===r){i=t.elements;return function(t,n,e){return new fi(Oi(t),n,e)}(Ai("cong",t.location),this.parseElements(i[1]),this.parseElements(i[2]))}if("ind-="===r){i=t.elements;return function(t,n,e,r){return new yi(Oi(t),n,e,r)}(Ai("ind-=",t.location),this.parseElements(i[1]),this.parseElements(i[2]),this.parseElements(i[3]))}if("symm"===r)return function(t,n){return new li(Oi(t),n)}(Ai("symm",t.location),this.parseElements(t.elements[1]));if("Vec"===r){i=t.elements;return function(t,n,e){return new wi(Oi(t),n,e)}(Ai("Vec",t.location),this.parseElements(i[1]),this.parseElements(i[2]))}if("vecnil"===r)return function(t){return new vi(Oi(t))}(Ai("vecnil",t.location));if("vec::"===r){i=t.elements;return function(t,n,e){return new di(Oi(t),n,e)}(Ai("vec::",t.location),this.parseElements(i[1]),this.parseElements(i[2]))}if("head"===r)return function(t,n){return new mi(Oi(t),n)}(Ai("head",t.location),this.parseElements(t.elements[1]));if("tail"===r)return function(t,n){return new gi(Oi(t),n)}(Ai("tail",t.location),this.parseElements(t.elements[1]));if("ind-Vec"===r){i=t.elements;return function(t,n,e,r,i,o){return new Ei(Oi(t),n,e,r,i,o)}(Ai("ind-Vec",t.location),this.parseElements(i[1]),this.parseElements(i[2]),this.parseElements(i[3]),this.parseElements(i[4]),this.parseElements(i[5]))}if("Either"===r){i=t.elements;return function(t,n,e){return new Ti(Oi(t),n,e)}(Ai("Either",t.location),this.parseElements(i[1]),this.parseElements(i[2]))}if("left"===r)return function(t,n){return new Pi(Oi(t),n)}(Ai("left",t.location),this.parseElements(t.elements[1]));if("right"===r)return function(t,n){return new bi(Oi(t),n)}(Ai("right",t.location),this.parseElements(t.elements[1]));if("ind-Either"===r){i=t.elements;return function(t,n,e,r,i){return new Ni(Oi(t),n,e,r,i)}(Ai("ind-Either",t.location),this.parseElements(i[1]),this.parseElements(i[2]),this.parseElements(i[3]),this.parseElements(i[4]))}if("Absurd"===r)return function(t){return new ai(Oi(t))}(Ai("Absurd",t.location));if("ind-Absurd"===r){i=t.elements;return function(t,n,e){return new ui(Oi(t),n,e)}(Ai("ind-Absurd",t.location),this.parseElements(i[1]),this.parseElements(i[2]))}if("TODO"===r)return function(t){return new _i(Oi(t))}(Ai("TODO",t.location));if(t instanceof wt.List&&t.elements.length>1){i=t.elements;return function(t,n,e,r){return new ki(Oi(t),n,e,r)}(Ai("App",t.location),this.parseElements(i[0]),this.parseElements(i[1]),i.slice(2).map((function(t){return e.parseElements(t)})))}if(Gt(r))return function(t,n){return new Gr(Oi(t),n)}(Ai(r,t.location),r);if(!isNaN(Number(r)))return function(t,n){return new ni(Oi(t),Number(n))}(Ai(r,t.location),r);throw new Error("Unexpected element: "+t)},t}();function Ci(t,n){return u([t],n,!0)}var Ri=function(t,n,e){this.location=t,this.name=n,this.type=e},Mi=function(t,n,e){this.location=t,this.name=n,this.expr=e},qi=function(t,n,e,r){this.location=t,this.type=n,this.left=e,this.right=r},Ui=function(){function t(){}return t.parseDeclaration=function(t){var n=Li(t);if("claim"===n){var e=t.elements;return new Ri(Oi(xi(e[0],t.location)),Li(e[1]),Bi.parseElements(e[2]))}if("define"===n){e=t.elements;return new Mi(Oi(xi(e[0],t.location)),Li(e[1]),Bi.parseElements(e[2]))}if("check-same"===n){e=t.elements;return new qi(Oi(xi(e[0],t.location)),Bi.parseElements(e[1]),Bi.parseElements(e[2]),Bi.parseElements(e[3]))}return Bi.parseElements(t)},t}();function Hi(t,n){var e=new zt("eout");return Dt([[e,function(){return n.isType(t,new Map)}]],(function(){return new Ut(qn(t,e.value).readBackType(t))}))}function zi(t,n,e,r,i){var o=new zt("tOut"),a=new zt("tv"),u=new zt("aOut"),s=new zt("bOut"),c=new zt("av"),p=new zt("bv");return Dt([[o,function(){return e.isType(t,new Map)}],[a,function(){return qn(t,o.value).readBackType(t)}],[u,function(){return r.check(t,new Map,a.value)}],[s,function(){return i.check(t,new Map,a.value)}],[c,function(){return qn(t,u.value)}],[p,function(){return qn(t,s.value)}]],(function(){return kr(t,n,a.value,c.value,p.value)}))}!function(t,n){void 0===n&&(n=self);var e=new m(n,!1);e.registerPlugin(R,t)}(function(t){function n(n){var e=t.call(this,n)||this;return e.executionCount=0,e}return i(n,t),n.prototype.evaluateChunk=function(t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(e){this.executionCount++;try{n=function(t){for(var n=Ii(t),e=Qn,r="",i=0,o=n;i<o.length;i++){var a=o[i],u=Ui.parseDeclaration(a),s=void 0;if(u instanceof Ri){if(!((s=Hn(e,u.name,u.location,u.type))instanceof Ut))throw new Error(""+s.where+s.message);e=s.result}else if(u instanceof Mi){if(!((s=zn(e,u.name,u.location,u.expr))instanceof Ut))throw new Error(""+s.where+s.message);e=s.result}else if(u instanceof qi){if(!((s=zi(e,u.location,u.type,u.left,u.right))instanceof Ut))throw new Error(""+s.where+s.message);e=s.result}else{if(!((s=Hi(e,u))instanceof Ut))throw new Error(""+s.where+s.message);r+=s.result.prettyPrint()}return r}}(t),this.conductor.sendOutput("Result of expression: ".concat(n))}catch(t){t instanceof Error?this.conductor.sendOutput("Error: ".concat(t.message)):this.conductor.sendOutput("Error: ".concat(String(t)))}return[2]}))}))},n}(p))}(util);
//# sourceMappingURL=index.js.map
