!function(t){"use strict";function e(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var n,r=e(t);class s extends Error{name="ConductorError";errorType="__unknown";constructor(t){super(t)}}class i extends s{name="ConductorInternalError";errorType="__internal";constructor(t){super(t)}}class a{conductor;async startEvaluator(t){const e=await this.conductor.requestFile(t);if(!e)throw new i("Cannot load entrypoint file");for(await this.evaluateFile(t,e);;){const t=await this.conductor.requestChunk();await this.evaluateChunk(t)}}async evaluateFile(t,e){return this.evaluateChunk(e)}constructor(t){this.conductor=t}}async function o(t){return(await import(t)).plugin}"function"==typeof SuppressedError&&SuppressedError;class c{name;__port;__subscribers=new Set;__isAlive=!0;__waitingMessages=[];send(t,e){this.__verifyAlive(),this.__port.postMessage(t,e??[])}subscribe(t){if(this.__verifyAlive(),this.__subscribers.add(t),this.__waitingMessages){for(const e of this.__waitingMessages)t(e);delete this.__waitingMessages}}unsubscribe(t){this.__verifyAlive(),this.__subscribers.delete(t)}close(){this.__verifyAlive(),this.__isAlive=!1,this.__port?.close()}__verifyAlive(){if(!this.__isAlive)throw new i(`Channel ${this.name} has been closed`)}__dispatch(t){if(this.__verifyAlive(),this.__waitingMessages)this.__waitingMessages.push(t);else for(const e of this.__subscribers)e(t)}listenToPort(t){t.addEventListener("message",(t=>this.__dispatch(t.data))),t.start()}replacePort(t){this.__verifyAlive(),this.__port?.close(),this.__port=t,this.listenToPort(t)}constructor(t,e){this.name=t,this.replacePort(e)}}class u{__s1=[];__s2=[];push(t){this.__s2.push(t)}pop(){if(0===this.__s1.length){if(0===this.__s2.length)throw new Error("queue is empty");let t=this.__s1;this.__s1=this.__s2.reverse(),this.__s2=t}return this.__s1.pop()}get length(){return this.__s1.length+this.__s2.length}clone(){const t=new u;return t.__s1=[...this.__s1],t.__s2=[...this.__s2],t}}class h{__inputQueue=new u;__promiseQueue=new u;push(t){0!==this.__promiseQueue.length?this.__promiseQueue.pop()(t):this.__inputQueue.push(t)}async pop(){return 0!==this.__inputQueue.length?this.__inputQueue.pop():new Promise(((t,e)=>{this.__promiseQueue.push(t)}))}tryPop(){if(0!==this.__inputQueue.length)return this.__inputQueue.pop()}constructor(){this.push=this.push.bind(this)}}class l{name;__channel;__messageQueue=new h;async receive(){return this.__messageQueue.pop()}tryReceive(){return this.__messageQueue.tryPop()}send(t,e){this.__channel.send(t,e)}close(){this.__channel.unsubscribe(this.__messageQueue.push)}constructor(t){this.name=t.name,this.__channel=t,this.__channel.subscribe(this.__messageQueue.push)}}class p{__alive=!0;__link;__parent;__channels=new Map;__pluginMap=new Map;__plugins=[];__negotiateChannel(t){const{port1:e,port2:n}=new MessageChannel,r=new c(t,e);this.__link.postMessage([t,n],[n]),this.__channels.set(t,r)}__verifyAlive(){if(!this.__alive)throw new i("Conduit already terminated")}registerPlugin(t,...e){this.__verifyAlive();const n=[];for(const e of t.channelAttach)this.__channels.has(e)||this.__negotiateChannel(e),n.push(this.__channels.get(e));const r=new t(this,n,...e);if(void 0!==r.name){if(this.__pluginMap.has(r.name))throw new i(`Plugin ${r.name} already registered`);this.__pluginMap.set(r.name,r)}return this.__plugins.push(r),r}unregisterPlugin(t){this.__verifyAlive();let e=0;for(let n=0;n<this.__plugins.length;++n)this.__plugins[e]===t&&++e,this.__plugins[n]=this.__plugins[n+e];for(let t=this.__plugins.length-1,n=this.__plugins.length-e;t>=n;--t)delete this.__plugins[t];t.name&&this.__pluginMap.delete(t.name),t.destroy?.()}lookupPlugin(t){if(this.__verifyAlive(),!this.__pluginMap.has(t))throw new i(`Plugin ${t} not registered`);return this.__pluginMap.get(t)}terminate(){this.__verifyAlive();for(const t of this.__plugins)t.destroy?.();this.__link.terminate?.(),this.__alive=!1}__handlePort(t){const[e,n]=t;if(this.__channels.has(e)){const t=this.__channels.get(e);this.__parent?t.listenToPort(n):t.replacePort(n)}else{const t=new c(e,n);this.__channels.set(e,t)}}constructor(t,e=!1){this.__link=t,t.addEventListener("message",(t=>this.__handlePort(t.data))),this.__parent=e}}class f{type=0;data;constructor(t,e,n){this.data={fn:t,args:e,invokeId:n}}}class w{type=2;data;constructor(t,e){this.data={invokeId:t,err:e}}}class y{type=1;data;constructor(t,e){this.data={invokeId:t,res:e}}}function d(t){}!function(t){t[t.VOID=0]="VOID",t[t.BOOLEAN=1]="BOOLEAN",t[t.NUMBER=2]="NUMBER",t[t.CONST_STRING=3]="CONST_STRING",t[t.EMPTY_LIST=4]="EMPTY_LIST",t[t.PAIR=5]="PAIR",t[t.ARRAY=6]="ARRAY",t[t.CLOSURE=7]="CLOSURE",t[t.OPAQUE=8]="OPAQUE",t[t.LIST=9]="LIST"}(n||(n={}));class m{type=1;data;constructor(t){this.data={minVersion:t}}}class g{type=0;data={version:0}}class v{type=3;data;constructor(t){this.data=t}}let E=(()=>{let t,e,n=[d],r=[];return class{static{e=this}static{const s="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;!function(t,e,n,r,s,i){function a(t){if(void 0!==t&&"function"!=typeof t)throw new TypeError("Function expected");return t}for(var o,c=r.kind,u="getter"===c?"get":"setter"===c?"set":"value",h=!e&&t?r.static?t:t.prototype:null,l=e||(h?Object.getOwnPropertyDescriptor(h,r.name):{}),p=!1,f=n.length-1;f>=0;f--){var w={};for(var y in r)w[y]="access"===y?{}:r[y];for(var y in r.access)w.access[y]=r.access[y];w.addInitializer=function(t){if(p)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(t||null))};var d=(0,n[f])("accessor"===c?{get:l.get,set:l.set}:l[u],w);if("accessor"===c){if(void 0===d)continue;if(null===d||"object"!=typeof d)throw new TypeError("Object expected");(o=a(d.get))&&(l.get=o),(o=a(d.set))&&(l.set=o),(o=a(d.init))&&s.unshift(o)}else(o=a(d))&&("field"===c?s.unshift(o):l[u]=o)}h&&Object.defineProperty(h,r.name,l),p=!0}(null,t={value:e},n,{kind:"class",name:e.name,metadata:s},null,r),e=t.value,s&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s})}name="__runner_main";__evaluator;__isCompatibleWithModules;__conduit;__fileRpc;__chunkQueue;__serviceChannel;__ioQueue;__errorChannel;__statusChannel;__serviceHandlers=new Map([[0,function(t){t.data.version<0?(this.__serviceChannel.send(new m(0)),console.error(`Host's protocol version (${t.data.version}) must be at least 0`)):console.log(`Host is using protocol version ${t.data.version}`)}],[1,function(t){console.error(`Host expects at least protocol version ${t.data.minVersion}, but we are on version 0`),this.__conduit.terminate()}],[2,function(t){this.__evaluator.startEvaluator(t.data)}]]);requestFile(t){return this.__fileRpc.requestFile(t)}async requestChunk(){return(await this.__chunkQueue.receive()).chunk}async requestInput(){const{message:t}=await this.__ioQueue.receive();return t}tryRequestInput(){const t=this.__ioQueue.tryReceive();return t?.message}sendOutput(t){this.__ioQueue.send({message:t})}sendError(t){this.__errorChannel.send({error:t})}updateStatus(t,e){this.__statusChannel.send({status:t,isActive:e})}hostLoadPlugin(t){this.__serviceChannel.send(new v(t))}registerPlugin(t,...e){return this.__conduit.registerPlugin(t,...e)}unregisterPlugin(t){this.__conduit.unregisterPlugin(t)}registerModule(t){if(!this.__isCompatibleWithModules)throw new i("Evaluator has no data interface");return this.registerPlugin(t,this.__evaluator)}unregisterModule(t){this.unregisterPlugin(t)}async importAndRegisterExternalPlugin(t){const e=await o(t);return this.registerPlugin(e)}async importAndRegisterExternalModule(t){const e=await async function(t){return await o(t)}(t);return this.registerModule(e)}static channelAttach=["__file_rpc","__chunk","__service","__stdio","__error","__status"];constructor(t,[e,n,r,s,i,a],o){this.__conduit=t,this.__fileRpc=function(t,e){const n=[];let r=0;return t.subscribe((async r=>{switch(r.type){case 0:{const{fn:n,args:s,invokeId:i}=r.data;try{const r=await e[n](...s);i>0&&t.send(new y(i,r))}catch(e){i>0&&t.send(new w(i,e))}break}case 1:{const{invokeId:t,res:e}=r.data;n[t]?.[0]?.(e),delete n[t];break}case 2:{const{invokeId:t,err:e}=r.data;n[t]?.[1]?.(e),delete n[t];break}}})),new Proxy({},{get(e,s,i){const a=Reflect.get(e,s,i);if(a)return a;const o="string"==typeof s&&"$"===s.charAt(0)?(...e)=>{t.send(new f(s,e,0))}:(...e)=>{const i=++r;return t.send(new f(s,e,i)),new Promise(((t,e)=>{n[i]=[t,e]}))};return Reflect.set(e,s,o,i),o}})}(e,{}),this.__chunkQueue=new l(n),this.__serviceChannel=r,this.__ioQueue=new l(s),this.__errorChannel=i,this.__statusChannel=a,this.__serviceChannel.send(new g),this.__serviceChannel.subscribe((t=>{this.__serviceHandlers.get(t.type)?.call(this,t)})),this.__evaluator=new o(this),this.__isCompatibleWithModules=this.__evaluator.hasDataInterface??!1}static{!function(t,e,n){for(var r=arguments.length>2,s=0;s<e.length;s++)n=r?e[s].call(t,n):e[s].call(t)}(e,r)}},e})();const T={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉"},b={"₀":"0","₁":"1","₂":"2","₃":"3","₄":"4","₅":"5","₆":"6","₇":"7","₈":"8","₉":"9"};function P(t,e){if(t.some((t=>t===e))){return N(t,function(t){const[e,n]=_(t,t.length-1);return[e,n]}(e))}return e}function N(t,e){const n=function([t,e]){const n=function(t){const e=t.toString().split("").map((t=>T[t]||t)).join("");return e}(e);return t+n}(e);return t.map((t=>t.toString())).includes(n.toString())?N(t,function(t){return[t[0],t[1]+1]}(e)):n}function x(t){const e=t.split("").map((t=>b[t]||t)).join("");return parseInt(e,10)||1}function _(t,e){return e<0?[t,0]:(n=t[e],Object.keys(b).includes(n)?_(t,e-1):[t.substring(0,e+1),x(t.substring(e+1))]);var n}class k{location;varName;constructor(t,e){this.location=t,this.varName=e}}class S{binder;type;constructor(t,e){this.binder=t,this.type=e}}class O{message;constructor(t){this.message=t}}class ${}class L extends ${result;constructor(t){super(),this.result=t}}class A extends ${where;message;constructor(t,e){super(),this.where=t,this.message=e}}class I{name;value;constructor(t,e=null){this.name=t,this.value=e}}function B(t,e){for(const[e,n]of t){const r=n();if(!(r instanceof L))throw new Error(`Encountered stop when evaluating the sequence ${t}. Error message: ${r.message.message} at ${r.where}`);e.value=r.result}return e()}class C{constructor(){}}class R extends C{env;varName;expr;constructor(t,e,n){super(),this.env=t,this.varName=e,this.expr=n}valOfClosure(t){return this.expr.valOf((e=this.env,n=this.varName,r=t,new Map([...e,[n,r]])));var e,n,r}prettyPrint(){return`(CLOS ${this.varName} ${this.expr.prettyPrint()})`}toString(){return this.prettyPrint()}}class M extends C{proc;constructor(t){super(),this.proc=t}valOfClosure(t){return this.proc(t)}prettyPrint(){return"(HOCLOS)"}toString(){return this.prettyPrint()}}function q(t){return!("U"===(e=t)||"Nat"===e||"zero"===e||"add1"===e||"which-Nat"===e||"iter-Nat"===e||"rec-Nat"===e||"ind-Nat"===e||"->"===e||"→"===e||"Π"===e||"λ"===e||"Pi"===e||"∏"===e||"lambda"===e||"quote"===e||"Atom"===e||"car"===e||"cdr"===e||"cons"===e||"Σ"===e||"Sigma"===e||"Pair"===e||"Trivial"===e||"sole"===e||"List"===e||"::"===e||"nil"===e||"rec-List"===e||"ind-List"===e||"Absurd"===e||"ind-Absurd"===e||"="===e||"same"===e||"replace"===e||"trans"===e||"cong"===e||"symm"===e||"ind-="===e||"Vec"===e||"vecnil"===e||"vec::"===e||"head"===e||"tail"===e||"ind-Vec"===e||"Either"===e||"left"===e||"right"===e||"ind-Either"===e||"TODO"===e||"the"===e)&&isNaN(Number(t));var e}function U(t){return Array.from(t.keys())}function H(t,e){return P(U(t),e)}function z(t,e,n){return P(U(t).concat(e.findNames()),n)}function D(t){return[t.binder.varName].concat(t.type.findNames())}function Q(t,e,n){return new Map([...t,[e,n]])}function F(t,e){return e.valOf(K(t))}function V(t){const e=new Map;for(const[n,r]of t)r instanceof J?e.set(n,["free",r.type.readBackType(t)]):r instanceof W?e.set(n,["def",r.type.readBackType(t),wt(t,r.type,r.value)]):r instanceof Z&&e.set(n,["claim",r.type.readBackType(t)]);return e}function G(t,e,n,r){const s=new I("typeOut");return B([[new I("_"),()=>function(t,e,n){return t.has(n)?new A(e,new O([`The name "${n}" is already in use in the context.`])):new L(!0)}(t,n,e)],[s,()=>r.isType(t,new Map)]],(()=>new L(Q(t,e,new Z(F(t,s.value))))))}function X(t,e,n,r){const s=new I("typeOut"),i=new I("exprOut");return B([[s,()=>function(t,e,n){for(const[r,s]of t)if(r===n){if(s instanceof W)return new A(e,new O([`The name "${n}" is already defined.`]));if(s instanceof Z)return new L(s.type)}return new A(e,new O([`No claim: ${n}`]))}(t,n,e)],[i,()=>r.check(t,new Map,s.value)]],(()=>new L(function(t,e,n,r){return Q(t,e,new W(n,r))}(function(t,e){return t.delete(e),t}(t,e),e,s.value,F(t,i.value)))))}function K(t){if(0===t.size)return new Map;const e=t.entries(),n=new Map;for(const[t,r]of e)r instanceof W?n.set(t,r.value):r instanceof J&&n.set(t,new he(r.type,new mt(t)));return n}const Y=new Map;class j{}let Z=class extends j{type;constructor(t){super(),this.type=t}};class W extends j{type;value;constructor(t,e){super(),this.type=t,this.value=e}}class J extends j{type;constructor(t){super(),this.type=t}}function tt(t,e,n){if(0===t.size)throw new Error(`Unknown variable ${n}`);for(const[e,r]of t.entries())if(!(r instanceof Z)&&n===e)return new L(r.type);throw new Error(`Unknown variable ${n}`)}function et(t,e,n){if(t.has(e)){for(const[r,s]of t)if(r===e)return Q(t,e,new J(n));throw new Error(`\n      ${e} is already bound in ${JSON.stringify(t)}\n    `)}return Q(t,e,new J(n))}function nt(t,e){const n=t.now();if(n instanceof jt)return n.body.valOfClosure(e);if(n instanceof he){const t=n.type.now();if(t instanceof Yt)return new he(t.resultType.valOfClosure(e),new Ht(n.neutral,new yt(t.argType,e)))}throw new Error(`doApp: invalid input ${r.inspect([n,e])}`)}function rt(t,e,n,s){const i=t.now();if(i instanceof Xt)return n;if(i instanceof Kt)return nt(s,rt(i.smaller,e,n,s));if(i instanceof he){if(i.type.now()instanceof Gt)return new he(e,new Et(i.neutral,new yt(e,n),new yt(new Yt("n",new Gt,new M((t=>e))),s)))}throw new Error(`invalid input for iterNat ${r.inspect([t,e,n,s])}`)}function st(t,e,n,s){const i=t.now();if(i instanceof Xt)return n;if(i instanceof Kt)return nt(s,st(i.smaller,e,n,s));if(i instanceof he){if(i.type.now()instanceof Gt)return new he(e,new Tt(i.neutral,new yt(e,n),new yt(new Yt("n-1",new Gt,new M((t=>new Yt("ih",e,new M((t=>e)))))),s)))}throw new Error(`invalid input for recNat ${r.inspect([t,e,n,s])}`)}function it(t,e,n,s){const i=t.now();if(i instanceof Xt)return n;if(i instanceof Kt)return nt(nt(s,i.smaller),it(i.smaller,e,n,s));if(i instanceof he){if(i.type.now()instanceof Gt)return new he(nt(e,t),new bt(i.neutral,new yt(new Yt("x",new Gt,new M((t=>new le))),e),new yt(nt(e,new Xt),n),new yt(new Yt("n-1",new Gt,new M((t=>new Yt("ih",nt(e,t),new M((n=>nt(e,new Kt(t)))))))),s)))}throw new Error(`invalid input for indNat ${r.inspect([t,e,n,s])}`)}function at(t){const e=t.now();if(e instanceof Wt)return e.car;if(e instanceof he){const t=e.type.now();if(t instanceof Zt){const n=t,r=e.neutral;return new he(n.carType,new Pt(r))}}throw new Error(`invalid input for car ${r.inspect(t)}`)}function ot(t){const e=t.now();if(e instanceof Wt)return e.cdr;if(e instanceof he){const n=e.type.now();if(n instanceof Zt){const r=n,s=e.neutral;return new he(r.cdrType.valOfClosure(at(t)),new Nt(s))}}throw new Error(`invalid input for cdr ${r.inspect(t)}`)}function ct(t,e,n,s){const i=t.now();if(i instanceof te)return n;if(i instanceof ee)return nt(nt(nt(s,i.head),i.tail),ct(i.tail,e,n,s));if(i instanceof he){const r=i.type.now();if(r instanceof Jt){const a=r.entryType,o=i.neutral,c=new Yt("xs",new Jt(a),new M((t=>new le)));return new he(nt(e,t),new _t(o,new yt(c,e),new yt(nt(e,new te),n),new yt(new Yt("h",a,new M((t=>new Yt("t",new Jt(a),new M((n=>new Yt("ih",nt(e,n),new M((r=>nt(e,new ee(t,n))))))))))),s)))}}throw new Error(`invalid input for indList ${r.inspect([i,e,n,s])}`)}function ut(t,e,n,s){const i=t.now();if(i instanceof te)return n;if(i instanceof ee){const t=i.head,r=i.tail;return nt(nt(nt(s,t),r),ut(r,e,n,s))}if(i instanceof he){const t=i.type.now();if(t instanceof Jt){const r=t.entryType,a=i.neutral;return new he(e,new xt(a,new yt(e,n),new yt(new Yt("h",r,new M((t=>new Yt("t",new Jt(r),new M((t=>new Yt("ih",e,new M((t=>e))))))))),s)))}}throw new Error(`invalid input for recList ${r.inspect([i,e,n,s])}`)}function ht(t){const e=t.now();if(e instanceof ae)return e.tail;if(e instanceof he&&e.type instanceof se&&e.type.length instanceof Kt){const t=e.type.now();if(t instanceof se){if(t.length.now()instanceof Kt)return new he(new se(e.type.entryType,e.type.length.smaller),new Rt(e.neutral))}}throw new Error(`invalid input for tail ${r.inspect(t)}`)}function lt(t,e){return new Yt("k",new Gt,new M((n=>new Yt("e",new se(t,n),new M((r=>new Yt("es",new se(t,n),new M((t=>new Yt("ih",nt(nt(e,n),t),new M((s=>nt(nt(e,new Kt(n)),new ae(r,t))))))))))))))}function pt(t,e,n,s,i){const a=t.now(),o=e.now();if(a instanceof Xt&&o instanceof ie)return s;if(a instanceof Kt&&o instanceof ae)return nt(nt(nt(nt(i,a.smaller),o.head),ht(e)),pt(a.smaller,o.tail,n,s,i));if(a instanceof he&&o instanceof he&&a.type instanceof Gt&&o.type instanceof se){const r=o.type.entryType;return new he(nt(nt(n,t),e),new qt(a.neutral,o.neutral,new yt(new Yt("k",new Gt,new M((t=>new Yt("es",new se(r,t),new M((t=>new le)))))),n),new yt(nt(nt(n,new Xt),new ie),s),new yt(lt(o.type.entryType,n),i)))}if(ft(a,t)&&o instanceof he&&o.type instanceof se){const r=o.type.entryType;return new he(nt(nt(n,t),e),new Mt(new yt(new Gt,t),o.neutral,new yt(new Yt("k",new Gt,new M((t=>new Yt("es",new se(r,t),new M((t=>new le)))))),n),new yt(nt(nt(n,new Gt),new ie),s),new yt(lt(r,n),i)))}throw new Error(`invalid input for indVec ${r.inspect([t,e,n,s,i])}`)}function ft(t,e){const n=t.now(),r=e.now();return n instanceof Xt&&r instanceof Xt||n instanceof Kt&&r instanceof Kt&&ft(n.smaller,r.smaller)}function wt(t,e,n){const r=e.now(),s=n.now();if(r instanceof le)return n.readBackType(t);if(r instanceof Gt&&s instanceof Xt)return new Ee;if(r instanceof Gt&&s instanceof Kt)return new be(wt(t,new Gt,s.smaller));if(r instanceof Yt){const e=H(t,s instanceof jt?s.argName:r.argName);return new Se(e,wt(et(t,e,r.argType),r.resultType.valOfClosure(new he(r.argType,new mt(e))),nt(s,new he(r.argType,new mt(e)))))}if(r instanceof Zt){const e=at(n),s=ot(n);return new Ae(wt(t,r.carType,e),wt(t,r.cdrType.valOfClosure(e),s))}if(r instanceof pe&&s instanceof Vt)return new $e(s.name);if(r instanceof fe)return new ze;if(r instanceof Jt&&s instanceof te)return new Re;if(r instanceof Jt&&s instanceof ee)return new Ae(wt(t,r.entryType,s.head),wt(t,new Jt(r.entryType),s.tail));if(r instanceof ye&&s instanceof he)return new me(new De,s.neutral.readBackNeutral(t));if(r instanceof ne&&s instanceof re)return new Ve(wt(t,r.type,s.value));if(r instanceof se&&r.length instanceof Xt&&s instanceof ie)return new Je;if(r instanceof se&&r.length instanceof Kt&&s instanceof ae)return new We(wt(t,r.entryType,s.head),wt(t,new se(r.entryType,r.length.smaller),s.tail));if(r instanceof oe&&s instanceof ce)return new sn(wt(t,r.leftType,s.value));if(r instanceof oe&&s instanceof ue)return new an(wt(t,r.rightType,s.value));if(s instanceof he)return s.neutral.readBackNeutral(t);throw new Error(`Cannot read back ${s} : ${r}`)}class yt{type;value;constructor(t,e){this.type=t,this.value=e}}let dt=class{constructor(){}toString(){return"Neutral"}prettyPrint(){return"Neutral"}};class mt extends dt{name;constructor(t){super(),this.name=t}readBackNeutral(t){return new Te(this.name)}}let gt=class extends dt{where;type;constructor(t,e){super(),this.where=t,this.type=e}readBackNeutral(t){return new cn(this.where,this.type.readBackType(t))}},vt=class extends dt{target;base;step;constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}readBackNeutral(t){return new Pe(this.target.readBackNeutral(t),new me(this.base.type.readBackType(t),wt(t,this.base.type,this.base.value)),wt(t,this.step.type,this.step.value))}},Et=class extends dt{target;base;step;constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}readBackNeutral(t){return new Ne(this.target.readBackNeutral(t),new me(this.base.type.readBackType(t),wt(t,this.base.type,this.base.value)),wt(t,this.step.type,this.step.value))}},Tt=class extends dt{target;base;step;constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}readBackNeutral(t){return new xe(this.target.readBackNeutral(t),new me(this.base.type.readBackType(t),wt(t,this.base.type,this.base.value)),wt(t,this.step.type,this.step.value))}},bt=class extends dt{target;motive;base;step;constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.base=n,this.step=r}readBackNeutral(t){return new _e(this.target.readBackNeutral(t),wt(t,this.motive.type,this.motive.value),wt(t,this.base.type,this.base.value),wt(t,this.step.type,this.step.value))}},Pt=class extends dt{target;constructor(t){super(),this.target=t}readBackNeutral(t){return new Ie(this.target.readBackNeutral(t))}},Nt=class extends dt{target;constructor(t){super(),this.target=t}readBackNeutral(t){return new Be(this.target.readBackNeutral(t))}},xt=class extends dt{target;base;step;constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}readBackNeutral(t){return new qe(this.target.readBackNeutral(t),new me(this.base.type.readBackType(t),wt(t,this.base.type,this.base.value)),wt(t,this.step.type,this.step.value))}},_t=class extends dt{target;motive;base;step;constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.base=n,this.step=r}readBackNeutral(t){return new Ue(this.target.readBackNeutral(t),wt(t,this.motive.type,this.motive.value),wt(t,this.base.type,this.base.value),wt(t,this.step.type,this.step.value))}},kt=class extends dt{target;motive;constructor(t,e){super(),this.target=t,this.motive=e}readBackNeutral(t){return new Qe(new me(new De,this.target.readBackNeutral(t)),wt(t,this.motive.type,this.motive.value))}},St=class extends dt{target;motive;base;constructor(t,e,n){super(),this.target=t,this.motive=e,this.base=n}readBackNeutral(t){return new Ge(this.target.readBackNeutral(t),wt(t,this.motive.type,this.motive.value),wt(t,this.base.type,this.base.value))}};class Ot extends dt{target1;target2;constructor(t,e){super(),this.target1=t,this.target2=e}readBackNeutral(t){return new Xe(this.target1.readBackNeutral(t),wt(t,this.target2.type,this.target2.value))}}class $t extends dt{target1;target2;constructor(t,e){super(),this.target1=t,this.target2=e}readBackNeutral(t){return new Xe(wt(t,this.target1.type,this.target1.value),this.target2.readBackNeutral(t))}}class Lt extends dt{target1;target2;constructor(t,e){super(),this.target1=t,this.target2=e}readBackNeutral(t){return new Xe(this.target1.readBackNeutral(t),this.target2.readBackNeutral(t))}}let At=class extends dt{target;func;constructor(t,e){super(),this.target=t,this.func=e}readBackNeutral(t){const e=this.func.type;if(e instanceof Yt){const n=e.resultType;return new Ke(this.target.readBackNeutral(t),n.valOfClosure(new ye).readBackType(t),wt(t,this.func.type,this.func.value))}throw new Error("Cong applied to non-Pi type.")}},It=class extends dt{target;constructor(t){super(),this.target=t}readBackNeutral(t){return new Ye(this.target.readBackNeutral(t))}},Bt=class extends dt{target;motive;base;constructor(t,e,n){super(),this.target=t,this.motive=e,this.base=n}readBackNeutral(t){return new je(this.target.readBackNeutral(t),wt(t,this.motive.type,this.motive.value),wt(t,this.base.type,this.base.value))}},Ct=class extends dt{target;constructor(t){super(),this.target=t}readBackNeutral(t){return new tn(this.target.readBackNeutral(t))}},Rt=class extends dt{target;constructor(t){super(),this.target=t}readBackNeutral(t){return new en(this.target.readBackNeutral(t))}};class Mt extends dt{length;target;motive;base;step;constructor(t,e,n,r,s){super(),this.length=t,this.target=e,this.motive=n,this.base=r,this.step=s}readBackNeutral(t){return new nn(wt(t,this.length.type,this.length.value),this.target.readBackNeutral(t),wt(t,this.motive.type,this.motive.value),wt(t,this.base.type,this.base.value),wt(t,this.step.type,this.step.value))}}class qt extends dt{length;target;motive;base;step;constructor(t,e,n,r,s){super(),this.length=t,this.target=e,this.motive=n,this.base=r,this.step=s}readBackNeutral(t){return new nn(this.length.readBackNeutral(t),this.target.readBackNeutral(t),wt(t,this.motive.type,this.motive.value),wt(t,this.base.type,this.base.value),wt(t,this.step.type,this.step.value))}}let Ut=class extends dt{target;motive;baseLeft;baseRight;constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.baseLeft=n,this.baseRight=r}readBackNeutral(t){return new on(this.target.readBackNeutral(t),wt(t,this.motive.type,this.motive.value),wt(t,this.baseLeft.type,this.baseLeft.value),wt(t,this.baseRight.type,this.baseRight.value))}},Ht=class extends dt{operator;operand;constructor(t,e){super(),this.operator=t,this.operand=e}readBackNeutral(t){return new un(this.operator.readBackNeutral(t),wt(t,this.operand.type,this.operand.value))}};class zt{now(){return this}}class Dt{env;expr;constructor(t,e){this.env=t,this.expr=e}undelay(){return this.expr.valOf(this.env).now()}toString(){return`DelayClosure(${this.env}, ${this.expr})`}}class Qt{content;constructor(t){this.content=t}get(){return this.content}set(t){this.content=t}}class Ft extends zt{val;constructor(t){super(),this.val=t}now(){const t=this.val.get();if(t instanceof Dt){let e=t.undelay();return this.val.set(e),e}return t}readBackType(t){return this.now().readBackType(t)}prettyPrint(){return this.now().prettyPrint()}toString(){return`Delay(${this.val})`}}let Vt=class extends zt{name;constructor(t){super(),this.name=t}readBackType(t){throw new Error("No readBackType for Quote.")}prettyPrint(){return`'${this.name}`}toString(){return this.prettyPrint()}},Gt=class extends zt{constructor(){super()}readBackType(t){return new ve}prettyPrint(){return"Nat"}toString(){return this.prettyPrint()}},Xt=class extends zt{constructor(){super()}readBackType(t){throw new Error("No readBackType for Zero.")}prettyPrint(){return"zero"}toString(){return this.prettyPrint()}},Kt=class extends zt{smaller;constructor(t){super(),this.smaller=t}readBackType(t){throw new Error("No readBackType for Add1.")}prettyPrint(){return`(add1 ${this.smaller.prettyPrint()})`}toString(){return this.prettyPrint()}},Yt=class extends zt{argName;argType;resultType;constructor(t,e,n){super(),this.argName=t,this.argType=e,this.resultType=n}readBackType(t){const e=this.argType.readBackType(t),n=H(t,this.argName),r=et(t,n,this.argType);return new ke(n,e,this.resultType.valOfClosure(new he(this.argType,new mt(n))).readBackType(r))}prettyPrint(){return`(Π ${this.argName} ${this.argType.prettyPrint()} ${this.resultType.prettyPrint()})`}toString(){return this.prettyPrint()}},jt=class extends zt{argName;body;constructor(t,e){super(),this.argName=t,this.body=e}readBackType(t){throw new Error("No readBackType for Lambda.")}prettyPrint(){return`(lambda ${this.argName} ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}},Zt=class extends zt{carName;carType;cdrType;constructor(t,e,n){super(),this.carName=t,this.carType=e,this.cdrType=n}readBackType(t){const e=this.carType.readBackType(t),n=H(t,this.carName),r=et(t,n,this.carType);return new Le(n,e,this.cdrType.valOfClosure(new he(this.carType,new mt(n))).readBackType(r))}prettyPrint(){return`(Σ ${this.carName} ${this.carType.prettyPrint()} ${this.cdrType.prettyPrint()})`}toString(){return this.prettyPrint()}},Wt=class extends zt{car;cdr;constructor(t,e){super(),this.car=t,this.cdr=e}readBackType(t){throw new Error("No readBackType for Cons.")}prettyPrint(){return`(cons ${this.car.prettyPrint()} ${this.cdr.prettyPrint()})`}toString(){return this.prettyPrint()}},Jt=class extends zt{entryType;constructor(t){super(),this.entryType=t}readBackType(t){return new Me(this.entryType.readBackType(t))}prettyPrint(){return`(List ${this.entryType.prettyPrint()})`}toString(){return this.prettyPrint()}},te=class extends zt{constructor(){super()}readBackType(t){throw new Error("No readBackType for Nil.")}prettyPrint(){return"nil"}toString(){return this.prettyPrint()}},ee=class extends zt{head;tail;constructor(t,e){super(),this.head=t,this.tail=e}readBackType(t){throw new Error("No readBackType for ListCons.")}prettyPrint(){return`(:: ${this.head.prettyPrint()} ${this.tail.prettyPrint()})`}toString(){return this.prettyPrint()}},ne=class extends zt{type;from;to;constructor(t,e,n){super(),this.type=t,this.from=e,this.to=n}readBackType(t){return new Fe(this.type.readBackType(t),wt(t,this.type,this.from),wt(t,this.type,this.to))}prettyPrint(){return`(= ${this.type.prettyPrint()} ${this.from.prettyPrint()} ${this.to.prettyPrint()})`}toString(){return this.prettyPrint()}},re=class extends zt{value;constructor(t){super(),this.value=t}readBackType(t){throw new Error("No readBackType for Same.")}prettyPrint(){return`(same ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}},se=class extends zt{entryType;length;constructor(t,e){super(),this.entryType=t,this.length=e}readBackType(t){return new Ze(this.entryType.readBackType(t),wt(t,new Gt,this.length))}prettyPrint(){return`(Vec ${this.entryType.prettyPrint()} ${this.length.prettyPrint()})`}},ie=class extends zt{constructor(){super()}readBackType(t){throw new Error("No readBackType for VecNil.")}prettyPrint(){return"vecnil"}toString(){return this.prettyPrint()}},ae=class extends zt{head;tail;constructor(t,e){super(),this.head=t,this.tail=e}readBackType(t){throw new Error("No readBackType for VecCons.")}prettyPrint(){return`(vec:: ${this.head.prettyPrint()} ${this.tail.prettyPrint()})`}toString(){return this.prettyPrint()}},oe=class extends zt{leftType;rightType;constructor(t,e){super(),this.leftType=t,this.rightType=e}readBackType(t){return new rn(this.leftType.readBackType(t),this.rightType.readBackType(t))}prettyPrint(){return`(Either ${this.leftType.prettyPrint()} ${this.rightType.prettyPrint()})`}toString(){return this.prettyPrint()}},ce=class extends zt{value;constructor(t){super(),this.value=t}readBackType(t){throw new Error("No readBackType for Left.")}prettyPrint(){return`(left ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}},ue=class extends zt{value;constructor(t){super(),this.value=t}readBackType(t){throw new Error("No readBackType for Right.")}prettyPrint(){return`(right ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}};class he extends zt{type;neutral;constructor(t,e){super(),this.type=t,this.neutral=e}readBackType(t){return this.neutral.readBackNeutral(t)}prettyPrint(){return`(neutral ${this.type.prettyPrint()} ${this.neutral.prettyPrint()})`}toString(){return this.prettyPrint()}}let le=class extends zt{constructor(){super()}readBackType(t){return new ge}prettyPrint(){return"U"}toString(){return this.prettyPrint()}},pe=class extends zt{constructor(){super()}readBackType(t){return new Oe}prettyPrint(){return"Atom"}toString(){return this.prettyPrint()}},fe=class extends zt{constructor(){super()}readBackType(t){return new He}prettyPrint(){return"Trivial"}toString(){return this.prettyPrint()}},we=class extends zt{constructor(){super()}readBackType(t){throw new Error("No readBackType for Sole.")}prettyPrint(){return"sole"}toString(){return this.prettyPrint()}},ye=class extends zt{constructor(){super()}readBackType(t){return new De}prettyPrint(){return"Absurd"}toString(){return this.prettyPrint()}};class de{toLazy(t){return new Ft(new Qt(new Dt(t,this)))}}let me=class extends de{type;expr;constructor(t,e){super(),this.type=t,this.expr=e}valOf(t){return this.expr.valOf(t)}prettyPrint(){return`(the ${this.type.prettyPrint()} ${this.expr.prettyPrint()})`}toString(){return this.prettyPrint()}},ge=class extends de{valOf(t){return new le}prettyPrint(){return"U"}toString(){return this.prettyPrint()}},ve=class extends de{valOf(t){return new Gt}prettyPrint(){return"Nat"}toString(){return this.prettyPrint()}},Ee=class extends de{valOf(t){return new Xt}prettyPrint(){return"zero"}toString(){return this.prettyPrint()}};class Te extends de{name;constructor(t){super(),this.name=t}valOf(t){if(q(this.name))return function(t,e){if(t.has(e))return t.get(e);throw new Error(`Variable ${e} not found in environment`)}(t,this.name);throw new Error("{this.name} is not a valid variable name")}prettyPrint(){return this.name}toString(){return this.prettyPrint()}}let be=class extends de{n;constructor(t){super(),this.n=t}valOf(t){return new Kt(this.n.toLazy(t))}prettyPrint(){return`(add1 ${this.n.prettyPrint()})`}toString(){return this.prettyPrint()}},Pe=class extends de{target;base;step;constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}valOf(t){return function(t,e,n,s){const i=t.now();if(i instanceof Xt)return n;if(i instanceof Kt)return nt(s,i.smaller);if(i instanceof he&&i.type.now()instanceof Gt)return new he(e,new vt(i.neutral,new yt(e,n),new yt(new Yt("n",new Gt,new M((t=>e))),s)));throw new Error(`invalid input for whichNat ${r.inspect([t,e,n,s])}`)}(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(which-Nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},Ne=class extends de{target;base;step;constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}valOf(t){return rt(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(iter-Nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},xe=class extends de{target;base;step;constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}valOf(t){return st(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(rec-Nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},_e=class extends de{target;motive;base;step;constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.base=n,this.step=r}valOf(t){return it(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(ind-Nat ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},ke=class extends de{name;type;body;constructor(t,e,n){super(),this.name=t,this.type=e,this.body=n}valOf(t){const e=this.type.toLazy(t);return new Yt(this.name,e,new R(t,this.name,this.body))}prettyPrint(){return`(Π (${this.name} ${this.type.prettyPrint()}) \n          ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}},Se=class extends de{param;body;constructor(t,e){super(),this.param=t,this.body=e}valOf(t){return new jt(this.param,new R(t,this.param,this.body))}prettyPrint(){return`(λ (${this.param}) ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}},Oe=class extends de{valOf(t){return new pe}prettyPrint(){return"Atom"}toString(){return this.prettyPrint()}},$e=class extends de{sym;constructor(t){super(),this.sym=t}valOf(t){return new Vt(this.sym)}prettyPrint(){return`'${this.sym}`}toString(){return this.prettyPrint()}},Le=class extends de{name;type;body;constructor(t,e,n){super(),this.name=t,this.type=e,this.body=n}valOf(t){const e=this.type.toLazy(t);return new Zt(this.name,e,new R(t,this.name,this.body))}prettyPrint(){return`(Σ (${this.name} ${this.type.prettyPrint()}) \n              ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}},Ae=class extends de{first;second;constructor(t,e){super(),this.first=t,this.second=e}valOf(t){const e=this.first.toLazy(t),n=this.second.toLazy(t);return new Wt(e,n)}prettyPrint(){return`(cons ${this.first.prettyPrint()} ${this.second.prettyPrint()})`}toString(){return this.prettyPrint()}},Ie=class extends de{pair;constructor(t){super(),this.pair=t}valOf(t){return at(this.pair.toLazy(t))}prettyPrint(){return`(car ${this.pair.prettyPrint()})`}toString(){return this.prettyPrint()}},Be=class extends de{pair;constructor(t){super(),this.pair=t}valOf(t){return ot(this.pair.toLazy(t))}prettyPrint(){return`(cdr ${this.pair.prettyPrint()})`}toString(){return this.prettyPrint()}},Ce=class extends de{head;tail;constructor(t,e){super(),this.head=t,this.tail=e}valOf(t){const e=this.head.toLazy(t),n=this.tail.toLazy(t);return new ee(e,n)}prettyPrint(){return`(:: ${this.head.prettyPrint()} ${this.tail.prettyPrint()})`}toString(){return this.prettyPrint()}},Re=class extends de{valOf(t){return new te}prettyPrint(){return"nil"}toString(){return this.prettyPrint()}},Me=class extends de{elemType;constructor(t){super(),this.elemType=t}valOf(t){return new Jt(this.elemType.toLazy(t))}prettyPrint(){return`(List ${this.elemType.prettyPrint()})`}toString(){return this.prettyPrint()}},qe=class extends de{target;base;step;constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}valOf(t){return ut(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(rec-List ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},Ue=class extends de{target;motive;base;step;constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.base=n,this.step=r}valOf(t){return ct(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(ind-List ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},He=class extends de{valOf(t){return new fe}prettyPrint(){return"Trivial"}toString(){return this.prettyPrint()}},ze=class extends de{valOf(t){return new we}prettyPrint(){return"sole"}toString(){return this.prettyPrint()}},De=class extends de{valOf(t){return new ye}prettyPrint(){return"Absurd"}toString(){return this.prettyPrint()}},Qe=class extends de{target;motive;constructor(t,e){super(),this.target=t,this.motive=e}valOf(t){return function(t,e){const n=t.now();if(n instanceof he&&n.type.now()instanceof ye)return new he(e,new kt(n.neutral,new yt(new le,e)));throw new Error(`invalid input for indAbsurd ${r.inspect([t,e])}`)}(this.target.toLazy(t),this.motive.toLazy(t))}prettyPrint(){return`(ind-Absurd \n              ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()})`}toString(){return this.prettyPrint()}},Fe=class extends de{type;left;right;constructor(t,e,n){super(),this.type=t,this.left=e,this.right=n}valOf(t){return new ne(this.type.toLazy(t),this.left.toLazy(t),this.right.toLazy(t))}prettyPrint(){return`(= ${this.type.prettyPrint()} \n              ${this.left.prettyPrint()} \n              ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}},Ve=class extends de{type;constructor(t){super(),this.type=t}valOf(t){return new re(this.type.toLazy(t))}prettyPrint(){return`(same ${this.type.prettyPrint()})`}toString(){return this.prettyPrint()}},Ge=class extends de{target;motive;base;constructor(t,e,n){super(),this.target=t,this.motive=e,this.base=n}valOf(t){return function(t,e,n){const s=t.now();if(s instanceof re)return n;if(s instanceof he){const t=s.type.now();if(t instanceof ne){const r=s.neutral,i=t.type,a=t.from,o=t.to;return new he(nt(e,o),new St(r,new yt(new Yt("x",i,new M((t=>new le))),e),new yt(nt(e,a),n)))}}throw new Error(`invalid input for replace ${r.inspect([t,e,n])}`)}(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t))}prettyPrint(){return`(replace ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()})`}toString(){return this.prettyPrint()}},Xe=class extends de{left;right;constructor(t,e){super(),this.left=t,this.right=e}valOf(t){return function(t,e){const n=t.now(),s=e.now();if(n instanceof re&&s instanceof re)return new re(n.value);if(n instanceof re&&s instanceof he){const t=s.type.now();if(t instanceof ne){const e=n.value,r=t.to,i=t.type,a=s.neutral;return new he(new ne(i,e,r),new $t(new yt(new ne(i,e,e),new re(e)),a))}}else if(n instanceof he&&s instanceof re){const t=n.type.now();if(t instanceof ne){const e=t.from,r=s.value,i=t.type,a=n.neutral;return new he(new ne(i,e,r),new Ot(a,new yt(new ne(i,r,r),new re(r))))}}else if(n instanceof he&&s instanceof he){const t=n.type.now(),e=s.type.now();if(t instanceof ne&&e instanceof ne){const r=t.from,i=e.to,a=t.type,o=n.neutral,c=s.neutral;return new he(new ne(a,r,i),new Lt(o,c))}}throw new Error(`invalid input for do-trans: ${r.inspect([t,e])}`)}(this.left.toLazy(t),this.right.toLazy(t))}prettyPrint(){return`(trans ${this.left.prettyPrint()} ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}},Ke=class extends de{target;base;fun;constructor(t,e,n){super(),this.target=t,this.base=e,this.fun=n}valOf(t){return function(t,e,n){const s=t.now();if(s instanceof re)return new re(nt(n,s.value));if(s instanceof he){const t=s.type.now();if(t instanceof ne){const r=t.type,i=t.from,a=t.to,o=s.neutral;return new he(new ne(e,nt(n,i),nt(n,a)),new At(o,new yt(new Yt("x",r,new M((t=>e))),n)))}}throw new Error(`invalid input for cong ${r.inspect([t,e,n])}`)}(this.target.toLazy(t),this.base.toLazy(t),this.fun.toLazy(t))}prettyPrint(){return`(cong ${this.target.prettyPrint()} ${this.fun.prettyPrint()})`}toString(){return this.prettyPrint()}},Ye=class extends de{equality;constructor(t){super(),this.equality=t}valOf(t){return function(t){const e=t.now();if(e instanceof re)return new re(e.value);if(e instanceof he){const t=e.type.now();if(t instanceof ne)return new he(new ne(t.type,t.to,t.from),new It(e.neutral))}throw new Error(`invalid input for symm ${r.inspect(t)}`)}(this.equality.toLazy(t))}prettyPrint(){return`(symm ${this.equality.prettyPrint()})`}toString(){return this.prettyPrint()}},je=class extends de{target;motive;base;constructor(t,e,n){super(),this.target=t,this.motive=e,this.base=n}valOf(t){return function(t,e,n){const s=t.now();if(s instanceof re)return n;if(s instanceof he){const r=s.type.now();if(r instanceof ne){const i=r.type,a=r.from,o=r.to,c=s.neutral;return new he(nt(nt(e,o),t),new Bt(c,new yt(new Yt("to",i,new M((t=>new Yt("p",new ne(i,a,t),new M((t=>new le)))))),e),new yt(nt(nt(e,a),new re(a)),n)))}}throw new Error(`invalid input for indEqual ${r.inspect([t,e,n])}`)}(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t))}prettyPrint(){return`(ind-= ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()})`}toString(){return this.prettyPrint()}},Ze=class extends de{type;length;constructor(t,e){super(),this.type=t,this.length=e}valOf(t){return new se(this.type.toLazy(t),this.length.toLazy(t))}prettyPrint(){return`(Vec ${this.type.prettyPrint()} ${this.length.prettyPrint()})`}toString(){return this.prettyPrint()}},We=class extends de{head;tail;constructor(t,e){super(),this.head=t,this.tail=e}valOf(t){return new ae(this.head.toLazy(t),this.tail.toLazy(t))}prettyPrint(){return`(vec:: ${this.head.prettyPrint()} ${this.tail.prettyPrint()})`}toString(){return this.prettyPrint()}},Je=class extends de{valOf(t){return new ie}prettyPrint(){return"vecnil"}toString(){return this.prettyPrint()}},tn=class extends de{vec;constructor(t){super(),this.vec=t}valOf(t){return function(t){const e=t.now();if(e instanceof ae)return e.head;if(e instanceof he){const t=e.type.now();if(t instanceof se&&t.length.now()instanceof Kt)return new he(t.entryType,new Ct(e.neutral))}throw new Error(`invalid input for head ${r.inspect(t)}`)}(this.vec.toLazy(t))}prettyPrint(){return`(head ${this.vec.prettyPrint()})`}toString(){return this.prettyPrint()}},en=class extends de{vec;constructor(t){super(),this.vec=t}valOf(t){return ht(this.vec.toLazy(t))}prettyPrint(){return`(tail ${this.vec.prettyPrint()})`}toString(){return this.prettyPrint()}},nn=class extends de{length;target;motive;base;step;constructor(t,e,n,r,s){super(),this.length=t,this.target=e,this.motive=n,this.base=r,this.step=s}valOf(t){return pt(this.length.toLazy(t),this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`ind-Vec ${this.length.prettyPrint()}\n              ${this.target.prettyPrint()}\n              ${this.motive.prettyPrint()}\n              ${this.base.prettyPrint()}\n              ${this.step.prettyPrint()}`}toString(){return this.prettyPrint()}},rn=class extends de{left;right;constructor(t,e){super(),this.left=t,this.right=e}valOf(t){return new oe(this.left.toLazy(t),this.right.toLazy(t))}prettyPrint(){return`(Either ${this.left.prettyPrint()} ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}},sn=class extends de{value;constructor(t){super(),this.value=t}valOf(t){return new ce(this.value.toLazy(t))}prettyPrint(){return`(left ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}},an=class extends de{value;constructor(t){super(),this.value=t}valOf(t){return new ue(this.value.toLazy(t))}prettyPrint(){return`(right ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}},on=class extends de{target;motive;baseLeft;baseRight;constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.baseLeft=n,this.baseRight=r}valOf(t){return function(t,e,n,s){const i=t.now();if(i instanceof ce)return nt(n,i.value);if(i instanceof ue)return nt(s,i.value);if(i instanceof he){const r=i.type.now();if(r instanceof oe){const a=r.leftType,o=r.rightType,c=new Yt("x",new oe(a,o),new M((t=>new le)));return new he(nt(e,t),new Ut(i.neutral,new yt(c,e),new yt(new Yt("x",a,new M((t=>nt(e,new ce(t))))),n),new yt(new Yt("x",o,new M((t=>nt(e,new ue(t))))),s)))}}throw new Error(`invalid input for indEither: ${r.inspect([t,e,n,s])}`)}(this.target.toLazy(t),this.motive.toLazy(t),this.baseLeft.toLazy(t),this.baseRight.toLazy(t))}prettyPrint(){return`(ind-Either ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.baseLeft.prettyPrint()} \n              ${this.baseRight.prettyPrint()})`}toString(){return this.prettyPrint()}},cn=class extends de{loc;type;constructor(t,e){super(),this.loc=t,this.type=e}valOf(t){return new he(this.type.toLazy(t),new gt(this.loc,this.type.toLazy(t)))}prettyPrint(){return`TODO ${this.type.prettyPrint()}`}toString(){return this.prettyPrint()}},un=class extends de{fun;arg;constructor(t,e){super(),this.fun=t,this.arg=e}valOf(t){return nt(this.fun.toLazy(t),this.arg.toLazy(t))}prettyPrint(){return`(${this.fun.prettyPrint()} ${this.arg.prettyPrint()})`}toString(){return this.prettyPrint()}};function hn(t,e){return wn(0,new Map,new Map,t,e)}const ln=-1;function pn(t,e,n){return new Map([[e,n],...t])}function fn(t,e){return e.has(t)&&e.get(t),ln}function wn(t,e,n,r,s){if(r instanceof Te&&s instanceof Te){const t=r.name,i=s.name;return!(!q(t)||!q(i))&&(fn(t,e),fn(i,n),t===i)}return r instanceof $e&&s instanceof $e?r.sym===s.sym:r instanceof ke&&s instanceof ke||r instanceof Le&&s instanceof Le?wn(t,e,n,r.type,s.type)&&wn(t+1,pn(e,r.name,t),pn(n,s.name,t),r.body,s.body):r instanceof Se&&s instanceof Se?wn(t+1,pn(e,r.param,t),pn(n,s.param,t),r.body,s.body):r instanceof me&&s instanceof me&&r.type instanceof De&&s.type instanceof De||(r instanceof un&&s instanceof un?wn(t,e,n,r.fun,s.fun)&&wn(t,e,n,r.arg,s.arg):r instanceof ge&&s instanceof ge||r instanceof ve&&s instanceof ve||r instanceof Ee&&s instanceof Ee||r instanceof Oe&&s instanceof Oe||r instanceof De&&s instanceof De||r instanceof ze&&s instanceof ze||r instanceof Re&&s instanceof Re||r instanceof Je&&s instanceof Je||r instanceof He&&s instanceof He||(r instanceof me&&s instanceof me?wn(t,e,n,r.type,s.type)&&wn(t,e,n,r.expr,s.expr):r instanceof Me&&s instanceof Me?wn(t,e,n,r.elemType,s.elemType):r instanceof be&&s instanceof be?wn(t,e,n,r.n,s.n):r instanceof Pe&&s instanceof Pe||r instanceof Ne&&s instanceof Ne||r instanceof xe&&s instanceof xe?wn(t,e,n,r.target,s.target)&&wn(t,e,n,r.base,s.base)&&wn(t,e,n,r.step,s.step):r instanceof _e&&s instanceof _e?wn(t,e,n,r.target,s.target)&&wn(t,e,n,r.motive,s.motive)&&wn(t,e,n,r.base,s.base)&&wn(t,e,n,r.step,s.step):r instanceof Ae&&s instanceof Ae?wn(t,e,n,r.first,s.first)&&wn(t,e,n,r.second,s.second):r instanceof Ie&&s instanceof Ie||r instanceof Be&&s instanceof Be?wn(t,e,n,r.pair,s.pair):r instanceof Ce&&s instanceof Ce?wn(t,e,n,r.head,s.head)&&wn(t,e,n,r.tail,s.tail):r instanceof qe&&s instanceof qe?wn(t,e,n,r.target,s.target)&&wn(t,e,n,r.base,s.base)&&wn(t,e,n,r.step,s.step):r instanceof Ue&&s instanceof Ue?wn(t,e,n,r.target,s.target)&&wn(t,e,n,r.motive,s.motive)&&wn(t,e,n,r.base,s.base)&&wn(t,e,n,r.step,s.step):r instanceof Qe&&s instanceof Qe?wn(t,e,n,r.target,s.target)&&wn(t,e,n,r.motive,s.motive):r instanceof Fe&&s instanceof Fe?wn(t,e,n,r.type,s.type)&&wn(t,e,n,r.left,s.left)&&wn(t,e,n,r.right,s.right):r instanceof Ve&&s instanceof Ve?wn(t,e,n,r.type,s.type):r instanceof Ge&&s instanceof Ge?wn(t,e,n,r.target,s.target)&&wn(t,e,n,r.motive,s.motive)&&wn(t,e,n,r.base,s.base):r instanceof Xe&&s instanceof Xe?wn(t,e,n,r.left,s.left)&&wn(t,e,n,r.right,s.right):r instanceof Ke&&s instanceof Ke?wn(t,e,n,r.target,s.target)&&wn(t,e,n,r.base,s.base)&&wn(t,e,n,r.fun,s.fun):r instanceof Ye&&s instanceof Ye?wn(t,e,n,r.equality,s.equality):r instanceof je&&s instanceof je?wn(t,e,n,r.target,s.target)&&wn(t,e,n,r.motive,s.motive)&&wn(t,e,n,r.base,s.base):r instanceof Ze&&s instanceof Ze?wn(t,e,n,r.type,s.type)&&wn(t,e,n,r.length,s.length):r instanceof We&&s instanceof We?wn(t,e,n,r.head,s.head)&&wn(t,e,n,r.tail,s.tail):r instanceof tn&&s instanceof tn||r instanceof en&&s instanceof en?wn(t,e,n,r.vec,s.vec):r instanceof nn&&s instanceof nn?wn(t,e,n,r.length,s.length)&&wn(t,e,n,r.target,s.target)&&wn(t,e,n,r.motive,s.motive)&&wn(t,e,n,r.base,s.base)&&wn(t,e,n,r.step,s.step):r instanceof rn&&s instanceof rn?wn(t,e,n,r.left,s.left)&&wn(t,e,n,r.right,s.right):r instanceof sn&&s instanceof sn||r instanceof an&&s instanceof an?wn(t,e,n,r.value,s.value):r instanceof on&&s instanceof on?wn(t,e,n,r.target,s.target)&&wn(t,e,n,r.motive,s.motive)&&wn(t,e,n,r.baseLeft,s.baseLeft)&&wn(t,e,n,r.baseRight,s.baseRight):r instanceof cn&&s instanceof cn&&(function(t,e){return t.startLine===e.startLine&&t.startColumn===e.startColumn&&t.endLine===e.endLine&&t.endColumn===e.endColumn}(r.loc,s.loc)&&wn(t,e,n,r.type,s.type))))}function yn(t,e){t.forInfo}function dn(t,e){const n=t.get(e);return n||e}function mn(t,e,n){return new Map([[e,n],...t])}function gn(t,e,n,r){const s=n.readBackType(t),i=r.readBackType(t);return hn(s,i)?new L(void 0):new A(e,new O([`Expected ${i} but got ${s}`]))}function vn(t,e,n,r,s){return hn(wt(t,n,r),wt(t,n,s))?new L(void 0):new A(e,new O([`The terms ${r} and ${s} are not the same ${n}.`]))}function En(t){return Tn(t.split(""))}function Tn(t){return 0===t.length||(e=t[0],!(!/^[a-zA-Z]$/.test(e)&&"-"!==t[0])&&Tn(t.slice(1)));var e}function bn(t,e,n){return new Pr(t.location,t,e,n)}class Pn{source;startLine;startColumn;endLine;endColumn;constructor(t,e,n,r,s){this.source=t,this.startLine=e,this.startColumn=n,this.endLine=r,this.endColumn=s}}class Nn{start;end;source;constructor(t,e,n){this.start=t,this.end=e,this.source=n}}let xn=class{syntax;forInfo;constructor(t,e){this.syntax=t,this.forInfo=e}locationToSrcLoc(){return new Pn(this.syntax.source,this.syntax.start.line,this.syntax.start.column,this.syntax.end.line,this.syntax.end.column)}toString(){return`${this.syntax.source}:${this.syntax.start.line}:${this.syntax.start.column}`}};function _n(t){return new xn(t.syntax,!1)}class kn{static synthNat(t,e){return new L(new me(new ge,new ve))}static synthUniverse(t,e,n){return new A(n,new O(["U is a type, but it does not have a type."]))}static synthArrow(t,e,n,r,s,i){if(0===i.length){const n=z(t,s,"x"),i=new I("Aout"),a=new I("Bout");return B([[i,()=>r.check(t,e,new le)],[a,()=>s.check(et(t,n,F(t,i.value)),e,new le)]],(()=>new L(new me(new ge,new ke(n,i.value,a.value)))))}{const[a,...o]=i,c=z(t,bn(s,a,o),"x"),u=new I("Aout"),h=new I("tout");return B([[u,()=>r.check(t,e,new le)],[h,()=>new qn(_n(n),s,a,o).check(et(t,c,F(t,u.value)),e,new le)]],(()=>new L(new me(new ge,new ke(c,u.value,h.value)))))}}static synthPi(t,e,n,r,s){if(1===r.length){const[n,i]=[r[0].binder,r[0].type],a=H(t,n.varName),o=(n.location,new I("Aout")),c=new I("Bout");return B([[o,()=>i.check(t,e,new le)],[c,()=>s.check(et(t,a,F(t,o.value)),mn(e,n.varName,a),new le)]],(()=>(o.value,new L(new me(new ge,new ke(a,o.value,c.value))))))}if(r.length>1){const[i,...a]=r,[o,c]=[i.binder,i.type],u=(o.location,o.varName),h=H(t,u),l=new I("Aout"),p=new I("Bout");return B([[l,()=>c.check(t,e,new le)],[p,()=>new Un(_n(n),a,s).check(et(t,h,F(t,l.value)),mn(e,u,h),new le)]],(()=>(l.value,new L(new me(new ge,new ke(h,l.value,p.value))))))}throw new Error("Invalid number of binders in Pi type")}static synthZero(t,e){return new L(new me(new ve,new Ee))}static synthAdd1(t,e,n){const r=new I("nout");return B([[r,()=>n.check(t,e,new Gt)]],(()=>new L(new me(new ve,new be(r.value)))))}static synthWhichNat(t,e,n,r,s){const i=new I("tgtout"),a=new I("bout"),o=new I("sout");let c=H(t,"n_minus_1");return B([[i,()=>n.check(t,e,new Gt)],[a,()=>r.synth(t,e)],[o,()=>s.check(t,e,new Yt(c,new Gt,new R(K(t),c,a.value.type)))]],(()=>new L(new me(a.value.type,new Pe(i.value,new me(a.value.type,a.value.expr),o.value)))))}static synthIterNat(t,e,n,r,s){const i=new I("tgtout"),a=new I("bout"),o=new I("sout");return B([[i,()=>n.check(t,e,new Gt)],[a,()=>r.synth(t,e)],[o,()=>s.check(t,e,(()=>{const e=H(t,"old");return F(t,new ke(e,a.value.type,a.value.type))})())]],(()=>new L(new me(a.value.type,new Ne(i.value,new me(a.value.type,a.value.expr),o.value)))))}static synthRecNat(t,e,n,r,s){const i=new I("tgtout"),a=new I("bout"),o=new I("sout");return B([[i,()=>n.check(t,e,new Gt)],[a,()=>r.synth(t,e)],[o,()=>s.check(t,e,(()=>{const e=H(t,"n_minus_1"),n=H(t,"old");return F(t,new ke(e,new ve,new ke(n,a.value.type,a.value.type)))})())]],(()=>new L(new me(a.value.type,new xe(i.value,new me(a.value.type,a.value.expr),o.value)))))}static synthIndNat(t,e,n,r,s,i){const a=new I("tgtout"),o=new I("motout"),c=new I("motval"),u=new I("bout"),h=new I("sout");return B([[a,()=>n.check(t,e,new Gt)],[o,()=>r.check(t,e,new Yt("n",new Gt,new M((t=>new le))))],[c,()=>new L(F(t,o.value))],[u,()=>s.check(t,e,nt(c.value,new Xt))],[h,()=>i.check(t,e,new Yt("n_minus_1",new Gt,new M((t=>new Yt("ih",nt(c.value,t),new M((e=>nt(c.value,new Kt(t)))))))))]],(()=>new L(new me(new un(o.value,a.value),new _e(a.value,o.value,u.value,h.value)))))}static synthAtom(t,e){return new L(new me(new ge,new Oe))}static synthPair(t,e,n,r){const s=H(t,"a"),i=new I("Aout"),a=new I("Dout");return B([[i,()=>n.check(t,e,new le)],[a,()=>r.check(et(t,s,F(t,i.value)),e,new le)]],(()=>new L(new me(new ge,new Le(s,i.value,a.value)))))}static synthSigma(t,e,n,r,s){if(1===r.length){const[n,i]=[r[0].binder,r[0].type],a=H(t,n.varName),o=(n.location,new I("Aout")),c=new I("Dout");return B([[o,()=>i.check(t,e,new le)],[c,()=>s.check(et(t,a,F(t,o.value)),mn(e,n.varName,a),new le)]],(()=>(o.value,new L(new me(new ge,new Le(a,o.value,c.value))))))}if(r.length>1){const[i,...a]=r,[o,c]=[i.binder,i.type],u=(o.location,o.varName),h=H(t,u),l=new I("Aout"),p=new I("Dout");return B([[l,()=>c.check(t,e,new le)],[p,()=>new zn(_n(n),a,s).check(et(t,h,F(t,l.value)),mn(e,u,h),new le)]],(()=>(l.value,new L(new me(new ge,new Le(h,l.value,p.value))))))}throw new Error("Invalid number of binders in Sigma type")}static synthCar(t,e,n,r){const s=new I("p_rst");return B([[s,()=>r.synth(t,e)]],(()=>{const e=F(t,s.value.type);return e instanceof Zt?new L(new me(e.carType.readBackType(t),new Ie(s.value.expr))):new A(n,new O([`car requires a Pair type, but was used as a: ${e}.`]))}))}static synthCdr(t,e,n,r){const s=new I("pout");return B([[s,()=>r.synth(t,e)]],(()=>{const e=F(t,s.value.type);if(e instanceof Zt){const[n,r,i]=[e.carName,e.carType,e.cdrType];return new L(new me(i.valOfClosure(at(F(t,s.value.expr))).readBackType(t),new Be(s.value.expr)))}return new A(n,new O([`cdr requires a Pair type, but was used as a: ${e}.`]))}))}static synthQuote(t,e,n,r){return En(r)?new L(new me(new Oe,new $e(r))):new A(n,new O([`Invalid atom: ${r}. Atoms consist of letters and hyphens.`]))}static synthTrivial(t,e){return new L(new me(new ge,new He))}static synthSole(t,e){return new L(new me(new He,new ze))}static synthIndList(t,e,n,r,s,i,a){const o=new I("tgtout"),c=new I("motout"),u=new I("motval"),h=new I("bout"),l=new I("sout");return B([[o,()=>r.synth(t,e)]],(()=>{const[r,p]=[o.value.type,o.value.expr],f=F(t,r);if(f instanceof Jt){const n=f.entryType;return B([[c,()=>s.check(t,e,new Yt("xs",new Jt(n),new R(K(t),"xs",new ge)))],[u,()=>new L(F(t,c.value))],[h,()=>i.check(t,e,nt(u.value,new te))],[l,()=>a.check(t,e,new Yt("e",n,new M((t=>new Yt("es",new Jt(n),new M((e=>new Yt("ih",nt(u.value,e),new M((n=>nt(u.value,new ee(t,e))))))))))))]],(()=>new L(new me(new un(c.value,p),new Ue(p,c.value,h.value,l.value)))))}return new A(n,new O([`Not a List: ${f.readBackType(t)}.`]))}))}static synthRecList(t,e,n,r,s,i){const a=new I("tgtout");return B([[a,()=>r.synth(t,e)]],(()=>{const[r,o]=[a.value.type,a.value.expr],c=F(t,r);if(c instanceof Jt){const n=c.entryType,r=new I("bout"),a=new I("btval"),u=new I("sout");return B([[r,()=>s.synth(t,e)],[a,()=>new L(F(t,r.value.type))],[u,()=>i.check(t,e,new Yt("e",n,new M((t=>new Yt("es",new Jt(n),new M((t=>new Yt("ih",a.value,new M((t=>a.value))))))))))]],(()=>new L(new me(r.value.type,new qe(o,new me(r.value.type,r.value.expr),u.value)))))}return new A(n,new O([`Not a List: ${c.readBackType(t)}.`]))}))}static synthList(t,e,n){const r=new I("Eout");return B([[r,()=>n.entryType.check(t,e,new le)]],(()=>new L(new me(new ge,new Me(r.value)))))}static synthListCons(t,e,n,r){const s=new I("eout"),i=new I("esout");return B([[s,()=>n.synth(t,e)],[i,()=>r.check(t,e,F(t,new Me(s.value.type)))]],(()=>new L(new me(new Me(s.value.type),new Ce(s.value.expr,i.value)))))}static synthAbsurd(t,e,n){return new L(new me(new ge,new De))}static synthIndAbsurd(t,e,n){const r=new I("tgtout"),s=new I("motout");return B([[r,()=>n.target.check(t,e,new ye)],[s,()=>n.motive.check(t,e,new le)]],(()=>new L(new me(s.value,new Qe(r.value,s.value)))))}static synthEqual(t,e,n,r,s){const i=new I("Aout"),a=new I("Av"),o=new I("from_out"),c=new I("to_out");return B([[i,()=>n.check(t,e,new le)],[a,()=>new L(F(t,i.value))],[o,()=>r.check(t,e,a.value)],[c,()=>s.check(t,e,a.value)]],(()=>new L(new me(new ge,new Fe(i.value,o.value,c.value)))))}static synthReplace(t,e,n,r,s,i){const a=new I("tgt_rst"),o=new I("motout"),c=new I("bout");return B([[a,()=>r.synth(t,e)]],(()=>{const r=F(t,a.value.type);if(r instanceof ne){const[n,u,h]=[r.type,r.from,r.to];return B([[o,()=>s.check(t,e,new Yt("x",n,new M((t=>new le))))],[c,()=>i.check(t,e,nt(F(t,o.value),u))]],(()=>new L(new me(nt(F(t,o.value),h).readBackType(t),new Ge(a.value.expr,o.value,c.value)))))}return new A(n,new O([`Expected an expression with = type, but the type was: ${a.value.type}.`]))}))}static synthTrans(t,e,n,r,s){const i=new I("p1_rst"),a=new I("p2_rst");return B([[i,()=>r.synth(t,e)],[a,()=>s.synth(t,e)]],(()=>{const e=F(t,i.value.type),r=F(t,a.value.type);if(e instanceof ne&&r instanceof ne){const[s,o,c]=[e.type,e.from,e.to],[u,h,l]=[r.type,r.from,r.to];return B([[new I("_"),()=>gn(t,n,s,u)],[new I("_"),()=>vn(t,n,s,c,h)]],(()=>new L(new me(new ne(s,o,l).readBackType(t),new Xe(i.value.expr,a.value.expr)))))}return new A(n,new O([`Expected =, got ${e} and ${r}.`]))}))}static synthCong(t,e,n,r,s){const i=new I("bout"),a=new I("f_rst");return B([[i,()=>r.synth(t,e)],[a,()=>s.synth(t,e)]],(()=>{const e=F(t,i.value.type),r=F(t,a.value.type);if(e instanceof ne){const[s,o,c]=[e.type,e.from,e.to];if(r instanceof Yt){const[e,u,h]=[r.argName,r.argType,r.resultType],l=new I("ph"),p=new I("Cv"),f=new I("fv");return B([[l,()=>gn(t,n,s,u)],[p,()=>new L(h.valOfClosure(o))],[f,()=>new L(F(t,a.value.expr))]],(()=>new L(new me(new Fe(p.value.readBackType(t),wt(t,p.value,nt(f.value,o)),wt(t,p.value,nt(f.value,c))),new Ke(i.value.expr,p.value.readBackType(t),a.value.expr)))))}return new A(n,new O([`Expected a function type, got ${r.readBackType(t)}.`]))}return new A(n,new O([`Expected an = type, got ${e.readBackType(t)}.`]))}))}static synthSymm(t,e,n,r){const s=new I("eout");return B([[s,()=>r.synth(t,e)]],(()=>{const e=F(t,s.value.type);if(e instanceof ne){const[n,r,i]=[e.type,e.from,e.to];return new L(new me(new ne(n,i,r).readBackType(t),new Ye(s.value.expr)))}return new A(n,new O([`Expected an = type, got ${e.readBackType(t)}.`]))}))}static synthIndEqual(t,e,n,r,s,i){const a=new I("tgtout"),o=new I("motout"),c=new I("motv"),u=new I("baseout");return B([[a,()=>r.synth(t,e)]],(()=>{const r=F(t,a.value.type);if(r instanceof ne){const[n,h,l]=[r.type,r.from,r.to];return B([[o,()=>s.check(t,e,new Yt("to",n,new M((t=>new Yt("p",new ne(n,h,t),new M((t=>new le)))))))],[c,()=>new L(F(t,o.value))],[u,()=>i.check(t,e,nt(nt(c.value,h),new re(h)))]],(()=>new L(new me(nt(nt(c.value,l),F(t,a.value.expr)).readBackType(t),new je(a.value.expr,o.value,u.value)))))}return new A(n,new O([`Expected evidence of equality, got ${r.readBackType(t)}.`]))}))}static synthVec(t,e,n,r){const s=new I("tout"),i=new I("lenout");return B([[s,()=>n.check(t,e,new le)],[i,()=>r.check(t,e,new Gt)]],(()=>new L(new me(new ge,new Ze(s.value,i.value)))))}static synthHead(t,e,n,r){const s=new I("vout");return B([[s,()=>r.synth(t,e)]],(()=>{const e=F(t,s.value.type).now();if(e instanceof se){const[r,i]=[e.entryType,e.length];return i.now()instanceof Kt?new L(new me(r.readBackType(t),new tn(s.value.expr))):new A(n,new O([`Expected a Vec with add1 at the top of the length, got ${wt(t,new Gt,i)}.`]))}return new A(n,new O([`Expected a Vec, got ${e.readBackType(t)}.`]))}))}static synthTail(t,e,n,r){const s=new I("vout");return B([[s,()=>r.synth(t,e)]],(()=>{const e=F(t,s.value.type).now();if(e instanceof se){const[r,i]=[e.entryType,e.length],a=i.now();if(a instanceof Kt){const e=a.smaller;return new L(new me(new Ze(r.readBackType(t),wt(t,new Gt,e)),new en(s.value.expr)))}return new A(n,new O([`Expected a Vec with add1 at the top of the length, got ${wt(t,new Gt,i)}.`]))}return new A(n,new O([`Expected a Vec, got ${e.readBackType(t)}.`]))}))}static synthIndVec(t,e,n,r,s,i,a,o){const c=new I("lenout"),u=new I("lenv"),h=new I("vecout"),l=new I("motout"),p=new I("motval"),f=new I("bout"),w=new I("sout");return B([[c,()=>r.check(t,e,new Gt)],[u,()=>new L(F(t,c.value))],[h,()=>s.synth(t,e)]],(()=>{const r=F(t,h.value.type);if(r instanceof se){const[s,y]=[r.entryType,r.length];return B([[new I("_"),()=>vn(t,n,new Gt,u.value,y)],[l,()=>i.check(t,e,new Yt("k",new Gt,new M((t=>new Yt("es",new se(s,t),new M((t=>new le)))))))],[p,()=>new L(F(t,l.value))],[f,()=>a.check(t,e,nt(nt(p.value,new Xt),new ie))],[w,()=>o.check(t,e,lt(s,p.value))]],(()=>new L(new me(new un(new un(l.value,c.value),h.value.expr),new nn(c.value,h.value.expr,l.value,f.value,w.value)))))}return new A(n,new O([`Expected a Vec, got ${r.readBackType(t)}.`]))}))}static synthEither(t,e,n,r){const s=new I("Lout"),i=new I("Rout");return B([[s,()=>n.check(t,e,new le)],[i,()=>r.check(t,e,new le)]],(()=>new L(new me(new ge,new rn(s.value,i.value)))))}static synthIndEither(t,e,n,r,s,i,a){const o=new I("tgtout"),c=new I("motout"),u=new I("motval"),h=new I("lout"),l=new I("rout");return B([[o,()=>r.synth(t,e)]],(()=>{const r=F(t,o.value.type);if(r instanceof oe){const[n,p]=[r.leftType,r.rightType];return B([[c,()=>s.check(t,e,new Yt("x",new oe(n,p),new M((t=>new le))))],[u,()=>new L(F(t,c.value))],[h,()=>i.check(t,e,new Yt("x",n,new M((t=>nt(u.value,new ce(t))))))],[l,()=>a.check(t,e,new Yt("x",p,new M((t=>nt(u.value,new ue(t))))))]],(()=>new L(new me(new un(c.value,o.value.expr),new on(o.value.expr,c.value,h.value,l.value)))))}return new A(n,new O([`Expected an Either, but got a ${r.readBackType(t)}.`]))}))}static synthThe(t,e,n,r){const s=new I("t_out"),i=new I("e_out");return B([[s,()=>n.isType(t,e)],[i,()=>r.check(t,e,F(t,s.value))]],(()=>new L(new me(s.value,i.value))))}static synthApplication(t,e,n,r,s,i){if(0===i.length){const i=new I("fout");return B([[i,()=>r.synth(t,e)]],(()=>{const r=F(t,i.value.type);if(r instanceof Yt){const[n,a,o]=[r.argName,r.argType,r.resultType],c=new I("argout");return B([[c,()=>s.check(t,e,a)]],(()=>new L(new me(o.valOfClosure(F(t,c.value)).readBackType(t),new un(i.value.expr,c.value)))))}return new A(n,new O([`Not a function type: ${r.readBackType(t)}.`]))}))}{const a=new I("appout");return B([[a,()=>new Pr(_n(n),r,s,i.slice(0,i.length-1)).synth(t,e)]],(()=>{const r=F(t,a.value.type);if(r instanceof Yt){const[n,s,o]=[r.argName,r.argType,r.resultType],c=new I("fout");return B([[c,()=>i[i.length-1].check(t,e,s)]],(()=>new L(new me(o.valOfClosure(F(t,c.value)).readBackType(t),new un(a.value.expr,c.value)))))}return new A(n,new O([`Not a function type: ${r.readBackType(t)}.`]))}))}}static synthName(t,e,n,r){const s=dn(e,r),i=new I("x_tv");return B([[i,()=>tt(t,0,s)]],(()=>(t.get(s),new L(new me(i.value.readBackType(t),new Te(s))))))}static synthNumber(t,e,n,r){if(0===r)return new L(new me(new ve,new Ee));if(r>0){const s=new I("n_1_out");return B([[s,()=>new Wn(n,r-1).check(t,e,new Gt)]],(()=>new L(new me(new ve,new be(s.value)))))}return new A(n,new O([`Expected a positive number, got ${r}.`]))}}class Sn{location;constructor(t){this.location=t}isType(t,e){const n=new I("ok"),r=this.getType(t,e);return B([[n,()=>r]],(()=>(yn(this.location,n.value),new L(n.value))))}getType(t,e){const n=this.check(t,e,new le);if(n instanceof L)return n;if(n instanceof A){if(this instanceof Dn&&q(this.name)){const e=new I("other-tv");return new B([[e,()=>tt(t,this.location,this.name)]],(()=>{new A(this.location,new O([`Expected , but given ${e.value.readBackType(t)}`]))}))}return new A(this.location,new O(["not a type"]))}throw new Error("Invalid checkType")}check(t,e,n){const r=new I("ok"),s=this.checkOut(t,e,n);return B([[r,()=>s]],(()=>new L(r.value)))}synth(t,e){const n=new I("ok");return B([[n,()=>this.synthHelper(t,e)]],(()=>(yn(this.location,n.value.type),new L(n.value))))}checkOut(t,e,n){const r=new I("theT");return B([[r,()=>this.synth(t,e)],[new I("_"),()=>gn(t,this.location,F(t,r.value.type),n)]],(()=>new L(r.value.expr)))}}class On extends Sn{location;type;value;constructor(t,e,n){super(t),this.location=t,this.type=e,this.value=n}synthHelper(t,e){return kn.synthThe(t,e,this.type,this.value)}findNames(){return this.type.findNames().concat(this.value.findNames())}prettyPrint(){return`(the ${this.type.prettyPrint()} ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}}class $n extends Sn{location;constructor(t){super(t),this.location=t}synthHelper(t,e){return kn.synthUniverse(t,e,this.location)}findNames(){return[]}getType(t,e){return new L(new ge)}prettyPrint(){return"U"}toString(){return this.prettyPrint()}}class Ln extends Sn{location;constructor(t){super(t),this.location=t}synthHelper(t,e){return kn.synthNat(t,e)}findNames(){return[]}getType(t,e){return new L(new ve)}prettyPrint(){return"Nat"}toString(){return this.prettyPrint()}}class An extends Sn{location;constructor(t){super(t),this.location=t}synthHelper(t,e){return kn.synthZero(t,e)}findNames(){return[]}prettyPrint(){return"zero"}toString(){return this.prettyPrint()}}class In extends Sn{location;base;constructor(t,e){super(t),this.location=t,this.base=e}synthHelper(t,e){return kn.synthAdd1(t,e,this.base)}findNames(){return this.base.findNames()}prettyPrint(){return`(add1 ${this.base.prettyPrint()})`}toString(){return this.prettyPrint()}}class Bn extends Sn{location;target;base;step;constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.base=n,this.step=r}synthHelper(t,e){return kn.synthWhichNat(t,e,this.target,this.base,this.step)}findNames(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(which-nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class Cn extends Sn{location;target;base;step;constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.base=n,this.step=r}synthHelper(t,e){return kn.synthIterNat(t,e,this.target,this.base,this.step)}findNames(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(iter-nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class Rn extends Sn{location;target;base;step;constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.base=n,this.step=r}synthHelper(t,e){return kn.synthRecNat(t,e,this.target,this.base,this.step)}findNames(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(rec-nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class Mn extends Sn{location;target;motive;base;step;constructor(t,e,n,r,s){super(t),this.location=t,this.target=e,this.motive=n,this.base=r,this.step=s}synthHelper(t,e){return kn.synthIndNat(t,e,this.target,this.motive,this.base,this.step)}findNames(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(ind-nat ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class qn extends Sn{location;arg1;arg2;args;constructor(t,e,n,r){super(t),this.location=t,this.arg1=e,this.arg2=n,this.args=r}synthHelper(t,e){return kn.synthArrow(t,e,this.location,this.arg1,this.arg2,this.args)}findNames(){return this.arg1.findNames().concat(this.arg2.findNames()).concat(this.args.flatMap((t=>t.findNames())))}getType(t,e){const[n,r,s]=[this.arg1,this.arg2,this.args];if(0===s.length){const s=z(t,r,"x"),i=new I("Aout"),a=new I("Bout");return B([[i,()=>n.isType(t,e)],[a,()=>r.isType(et(t,s,F(t,i.value)),e)]],(()=>new L(new ke(s,i.value,a.value))))}{const[i,...a]=s,o=z(t,bn(r,i,a),"x"),c=new I("Aout"),u=new I("tout");return B([[c,()=>n.isType(t,e)],[u,()=>new qn(_n(this.location),r,i,a).isType(et(t,o,F(t,c.value)),e)]],(()=>new L(new ke(o,c.value,u.value))))}}prettyPrint(){return`(-> ${this.arg1.prettyPrint()} ${this.arg2.prettyPrint()} ${this.args.map((t=>t.prettyPrint())).join(" ")})`}toString(){return this.prettyPrint()}}class Un extends Sn{location;binders;body;constructor(t,e,n){super(t),this.location=t,this.binders=e,this.body=n}synthHelper(t,e){return kn.synthPi(t,e,this.location,this.binders,this.body)}findNames(){return this.binders.flatMap((t=>D(t))).concat(this.body.findNames())}getType(t,e){const[n,r]=[this.binders,this.body];if(1===n.length){const[s,i]=[n[0].binder,n[0].type],a=H(t,s.varName),o=(s.location,new I("Aout")),c=new I("Aoutv"),u=new I("Bout");return B([[o,()=>i.isType(t,e)],[c,()=>new L(F(t,o.value))],[u,()=>r.isType(et(t,a,c.value),mn(e,s.varName,a))]],(()=>(o.value,new L(new ke(a,o.value,u.value)))))}if(n.length>1){const[s,...i]=n,[a,o]=[s.binder.varName,s.type],c=H(t,a),u=(s.binder.location,new I("Aout")),h=new I("Aoutv"),l=new I("Bout");return B([[u,()=>o.isType(t,e)],[h,()=>new L(F(t,u.value))],[l,()=>new Un(_n(this.location),i,r).isType(et(t,c,h.value),mn(e,s.binder.varName,c))]],(()=>(u.value,new L(new ke(c,u.value,l.value)))))}throw new Error("Invalid number of binders in Pi type")}prettyPrint(){return`(Π ${this.binders.map((t=>`(${t.binder.varName} ${t.type.prettyPrint()})`)).join(" ")} \n            ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}}class Hn extends Sn{location;binders;body;constructor(t,e,n){super(t),this.location=t,this.binders=e,this.body=n}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return this.binders.map((t=>t.varName)).concat(this.body.findNames())}checkOut(t,e,n){if(1===this.binders.length){const r=this.body,s=this.binders[0],i=s.varName,a=s.location,o=n.now();if(o instanceof Yt){const n=o.argType,s=o.resultType,a=dn(e,i),c=new I("bout");return B([[c,()=>r.check(et(t,a,n),mn(e,i,a),s.valOfClosure(new he(n,new mt(a))))]],(()=>(n.readBackType(t),new L(new Se(a,c.value)))))}return new A(a,new O([`Not a function type: ${o.readBackType(t)}.`]))}return new Hn(this.location,[this.binders[0]],new Hn(_n(this.location),this.binders.slice(1),this.body)).check(t,e,n)}prettyPrint(){return`(lambda ${this.binders.map((t=>t.varName)).join(" ")} ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}}class zn extends Sn{location;binders;body;constructor(t,e,n){super(t),this.location=t,this.binders=e,this.body=n}synthHelper(t,e){return kn.synthSigma(t,e,this.location,this.binders,this.body)}findNames(){return this.binders.flatMap((t=>D(t))).concat(this.body.findNames())}getType(t,e){const[n,r]=[this.binders,this.body];if(1===n.length){const[s,i]=[n[0].binder,n[0].type],a=s.varName,o=H(t,a),c=(s.location,new I("Aout")),u=new I("Aoutv"),h=new I("Dout");return B([[c,()=>i.isType(t,e)],[u,()=>new L(F(t,c.value))],[h,()=>r.isType(et(t,o,u.value),mn(e,a,o))]],(()=>(c.value,new L(new Le(o,c.value,h.value)))))}if(n.length>1){const[[s,i],...a]=[[n[0].binder,n[0].type],n[1],...n.slice(2)],o=s.varName,c=H(t,o),u=(s.location,new I("Aout")),h=new I("Aoutv"),l=new I("Dout");return B([[u,()=>i.isType(t,e)],[h,()=>new L(F(t,u.value))],[l,()=>new zn(this.location,a,r).isType(et(t,o,h.value),mn(e,o,c))]],(()=>(u.value,new L(new Le(c,u.value,l.value)))))}throw new Error("Invalid number of binders in Sigma type")}prettyPrint(){return`(Σ ${this.binders.map((t=>`(${t.binder.varName} ${t.type.prettyPrint()})`)).join(" ")} \n            ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}}class Dn extends Sn{location;name;constructor(t,e){super(t),this.location=t,this.name=e}synthHelper(t,e){return kn.synthName(t,e,this.location,this.name)}findNames(){return[this.name]}prettyPrint(){return this.name}toString(){return this.prettyPrint()}}class Qn extends Sn{location;constructor(t){super(t),this.location=t}synthHelper(t,e){return kn.synthAtom(t,e)}findNames(){return[]}getType(t,e){return new L(new Oe)}prettyPrint(){return"Atom"}toString(){return this.prettyPrint()}}class Fn extends Sn{location;name;constructor(t,e){super(t),this.location=t,this.name=e}synthHelper(t,e){return kn.synthQuote(t,e,this.location,this.name)}findNames(){return[]}prettyPrint(){return`'${this.name}`}toString(){return this.prettyPrint()}}class Vn extends Sn{location;first;second;constructor(t,e,n){super(t),this.location=t,this.first=e,this.second=n}synthHelper(t,e){return kn.synthPair(t,e,this.first,this.second)}findNames(){return this.first.findNames().concat(this.second.findNames())}getType(t,e){const n=new I("Aout"),r=new I("Dout"),s=z(t,this.second,"x");return B([[n,()=>this.first.isType(t,e)],[r,()=>this.second.isType(et(t,s,F(t,n.value)),e)]],(()=>new L(new Le(s,n.value,r.value))))}prettyPrint(){return`(Pair ${this.first.prettyPrint()} ${this.second.prettyPrint()})`}toString(){return this.prettyPrint()}}class Gn extends Sn{location;first;second;constructor(t,e,n){super(t),this.location=t,this.first=e,this.second=n}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return this.first.findNames().concat(this.second.findNames())}checkOut(t,e,n){const r=n.now();if(r instanceof Zt){const n=r.carType,s=r.cdrType,i=new I("aout"),a=new I("dout");return B([[i,()=>this.first.check(t,e,n)],[a,()=>this.second.check(t,e,s.valOfClosure(F(t,i.value)))]],(()=>new L(new Ae(i.value,a.value))))}return new A(this.location,new O([`cons requires a Pair or Σ type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return`(cons ${this.first.prettyPrint()} ${this.second.prettyPrint()})`}toString(){return this.prettyPrint()}}class Xn extends Sn{location;pair;constructor(t,e){super(t),this.location=t,this.pair=e}synthHelper(t,e){return kn.synthCar(t,e,this.location,this.pair)}findNames(){return this.pair.findNames()}prettyPrint(){return`(car ${this.pair.prettyPrint()})`}toString(){return this.prettyPrint()}}class Kn extends Sn{location;pair;constructor(t,e){super(t),this.location=t,this.pair=e}synthHelper(t,e){return kn.synthCdr(t,e,this.location,this.pair)}findNames(){return this.pair.findNames()}prettyPrint(){return`(cdr ${this.pair.prettyPrint()})`}toString(){return this.prettyPrint()}}class Yn extends Sn{location;constructor(t){super(t),this.location=t}synthHelper(t,e){return kn.synthTrivial(t,e)}findNames(){return[]}getType(t,e){return new L(new He)}prettyPrint(){return"Trivial"}toString(){return this.prettyPrint()}}class jn extends Sn{location;constructor(t){super(t),this.location=t}synthHelper(t,e){return kn.synthSole(t,e)}findNames(){return[]}prettyPrint(){return"Sole"}}class Zn extends Sn{location;constructor(t){super(t),this.location=t}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return[]}checkOut(t,e,n){const r=n.now();return r instanceof Jt?new L(new Re):new A(this.location,new O([`nil requires a List type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return"nil"}toString(){return this.prettyPrint()}}let Wn=class extends Sn{location;value;constructor(t,e){super(t),this.location=t,this.value=e}synthHelper(t,e){return kn.synthNumber(t,e,this.location,this.value)}findNames(){return[]}prettyPrint(){return`${this.value}`}toString(){return this.prettyPrint()}};class Jn extends Sn{location;entryType;constructor(t,e){super(t),this.location=t,this.entryType=e}synthHelper(t,e){return kn.synthList(t,e,this)}findNames(){return this.entryType.findNames()}getType(t,e){const n=new I("Eout");return B([[n,()=>this.entryType.isType(t,e)]],(()=>new L(new Me(n.value))))}prettyPrint(){return`(List ${this.entryType.prettyPrint()})`}toString(){return this.prettyPrint()}}class tr extends Sn{location;x;xs;constructor(t,e,n){super(t),this.location=t,this.x=e,this.xs=n}synthHelper(t,e){return kn.synthListCons(t,e,this.x,this.xs)}findNames(){return this.x.findNames().concat(this.xs.findNames())}prettyPrint(){return`(:: ${this.x.prettyPrint()} ${this.xs.prettyPrint()})`}toString(){return this.prettyPrint()}}class er extends Sn{location;target;base;step;constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.base=n,this.step=r}synthHelper(t,e){return kn.synthRecList(t,e,this.location,this.target,this.base,this.step)}findNames(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(rec-list ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class nr extends Sn{location;target;motive;base;step;constructor(t,e,n,r,s){super(t),this.location=t,this.target=e,this.motive=n,this.base=r,this.step=s}synthHelper(t,e){return kn.synthIndList(t,e,this.location,this.target,this.motive,this.base,this.step)}findNames(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(ind-list ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class rr extends Sn{location;constructor(t){super(t),this.location=t}synthHelper(t,e){return kn.synthAbsurd(t,e,this)}findNames(){return[]}getType(t,e){return new L(new De)}prettyPrint(){return"Absurd"}toString(){return this.prettyPrint()}}class sr extends Sn{location;target;motive;constructor(t,e,n){super(t),this.location=t,this.target=e,this.motive=n}synthHelper(t,e){return kn.synthIndAbsurd(t,e,this)}findNames(){return this.target.findNames().concat(this.motive.findNames())}prettyPrint(){return`(ind-Absurd \n              ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()})`}toString(){return this.prettyPrint()}}class ir extends Sn{location;type;left;right;constructor(t,e,n,r){super(t),this.location=t,this.type=e,this.left=n,this.right=r}synthHelper(t,e){return kn.synthEqual(t,e,this.type,this.left,this.right)}findNames(){return this.type.findNames().concat(this.left.findNames()).concat(this.right.findNames())}getType(t,e){const[n,r,s]=[this.type,this.left,this.right],i=new I("Aout"),a=new I("Av"),o=new I("from_out"),c=new I("to_out");return B([[i,()=>n.isType(t,e)],[a,()=>new L(F(t,i.value))],[o,()=>r.check(t,e,a.value)],[c,()=>s.check(t,e,a.value)]],(()=>new L(new Fe(i.value,o.value,c.value))))}prettyPrint(){return`(= ${this.type.prettyPrint()} \n              ${this.left.prettyPrint()} \n              ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}}class ar extends Sn{location;type;constructor(t,e){super(t),this.location=t,this.type=e}findNames(){return this.type.findNames()}synthHelper(t,e){throw new Error("Method not implemented.")}checkOut(t,e,n){const r=n.now();if(r instanceof ne){const n=r.type,s=r.from,i=r.to,a=new I("cout"),o=new I("val");return B([[a,()=>this.type.check(t,e,n)],[o,()=>new L(F(t,a.value))],[new I("_"),()=>vn(t,this.type.location,n,s,o.value)],[new I("_"),()=>vn(t,this.type.location,n,i,o.value)]],(()=>new L(new Ve(a.value))))}return new A(this.location,new O([`same requires an Equal type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return`(same ${this.type.prettyPrint()})`}toString(){return this.prettyPrint()}}class or extends Sn{location;target;motive;base;constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.motive=n,this.base=r}synthHelper(t,e){return kn.synthReplace(t,e,this.location,this.target,this.motive,this.base)}findNames(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames())}prettyPrint(){return`(replace ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()})`}toString(){return this.prettyPrint()}}class cr extends Sn{location;left;right;synthHelper(t,e){return kn.synthTrans(t,e,this.location,this.left,this.right)}constructor(t,e,n){super(t),this.location=t,this.left=e,this.right=n}findNames(){return this.left.findNames().concat(this.right.findNames())}prettyPrint(){return`(trans ${this.left.prettyPrint()} ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}}class ur extends Sn{location;target;fun;constructor(t,e,n){super(t),this.location=t,this.target=e,this.fun=n}synthHelper(t,e){return kn.synthCong(t,e,this.location,this.target,this.fun)}findNames(){return this.target.findNames().concat(this.fun.findNames())}prettyPrint(){return`(cong ${this.target.prettyPrint()} ${this.fun.prettyPrint()})`}toString(){return this.prettyPrint()}}class hr extends Sn{location;equality;constructor(t,e){super(t),this.location=t,this.equality=e}synthHelper(t,e){return kn.synthSymm(t,e,this.location,this.equality)}findNames(){return this.equality.findNames()}prettyPrint(){return`(symm ${this.equality.prettyPrint()})`}toString(){return this.prettyPrint()}}class lr extends Sn{location;target;motive;base;constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.motive=n,this.base=r}synthHelper(t,e){return kn.synthIndEqual(t,e,this.location,this.target,this.motive,this.base)}findNames(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames())}prettyPrint(){return`(ind-= ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()})`}toString(){return this.prettyPrint()}}class pr extends Sn{location;type;length;constructor(t,e,n){super(t),this.location=t,this.type=e,this.length=n}synthHelper(t,e){return kn.synthVec(t,e,this.type,this.length)}findNames(){return this.type.findNames().concat(this.length.findNames())}getType(t,e){const n=new I("Eout"),r=new I("lenout");return B([[n,()=>this.isType(t,e)],[r,()=>this.length.check(t,e,new Gt)]],(()=>new L(new Ze(n.value,r.value))))}prettyPrint(){return`(Vec ${this.type.prettyPrint()} ${this.length.prettyPrint()})`}toString(){return this.prettyPrint()}}class fr extends Sn{location;constructor(t){super(t),this.location=t}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return[]}checkOut(t,e,n){const r=n.now();if(r instanceof se){return r.length.now()instanceof Xt?new L("vecnil"):new A(this.location,new O([`vecnil requires a Vec type with length ZERO, but was used as a: \n          ${wt(t,new Gt,r.length)}.`]))}return new A(this.location,new O([`vecnil requires a Vec type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return"vecnil"}toString(){return this.prettyPrint()}}class wr extends Sn{location;x;xs;constructor(t,e,n){super(t),this.location=t,this.x=e,this.xs=n}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return this.x.findNames().concat(this.xs.findNames())}checkOut(t,e,n){const r=n.now();if(r instanceof se){const n=r.length.now();if(n instanceof Kt){const s=new I("hout"),i=new I("tout"),a=n.smaller;return B([[s,()=>this.x.check(t,e,r.entryType)],[i,()=>this.xs.check(t,e,new se(r.entryType,a))]],(()=>new L(new We(s.value,i.value))))}return new A(this.location,new O([`vec:: requires a Vec type with length Add1, but was used with a: \n          ${wt(t,new Gt,r.length)}.`]))}return new A(this.location,new O([`vec:: requires a Vec type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return`(vec:: ${this.x.prettyPrint()} ${this.xs.prettyPrint()})`}toString(){return this.prettyPrint()}}class yr extends Sn{location;vec;constructor(t,e){super(t),this.location=t,this.vec=e}synthHelper(t,e){return kn.synthHead(t,e,this.location,this.vec)}findNames(){return this.vec.findNames()}prettyPrint(){return`(head ${this.vec.prettyPrint()})`}toString(){return this.prettyPrint()}}class dr extends Sn{location;vec;constructor(t,e){super(t),this.location=t,this.vec=e}synthHelper(t,e){return kn.synthTail(t,e,this.location,this.vec)}findNames(){return this.vec.findNames()}prettyPrint(){return`(tail ${this.vec.prettyPrint()})`}toString(){return this.prettyPrint()}}class mr extends Sn{location;length;target;motive;base;step;constructor(t,e,n,r,s,i){super(t),this.location=t,this.length=e,this.target=n,this.motive=r,this.base=s,this.step=i}synthHelper(t,e){return kn.synthIndVec(t,e,this.location,this.length,this.target,this.motive,this.base,this.step)}findNames(){return this.length.findNames().concat(this.target.findNames()).concat(this.motive.findNames()).concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`ind-Vec ${this.length.prettyPrint()}\n              ${this.target.prettyPrint()}\n              ${this.motive.prettyPrint()}\n              ${this.base.prettyPrint()}\n              ${this.step.prettyPrint()}`}toString(){return this.prettyPrint()}}class gr extends Sn{location;left;right;constructor(t,e,n){super(t),this.location=t,this.left=e,this.right=n}synthHelper(t,e){return kn.synthEither(t,e,this.left,this.right)}findNames(){return this.left.findNames().concat(this.right.findNames())}getType(t,e){const n=new I("Lout"),r=new I("Rout");return B([[n,()=>this.left.isType(t,e)],[r,()=>this.right.isType(t,e)]],(()=>new L(new rn(n.value,r.value))))}prettyPrint(){return`(Either ${this.left.prettyPrint()} ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}}class vr extends Sn{location;value;constructor(t,e){super(t),this.location=t,this.value=e}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return this.value.findNames()}checkOut(t,e,n){const r=n.now();if(r instanceof oe){const n=new I("lout");return B([[n,()=>this.value.check(t,e,r.leftType)]],(()=>new L(new sn(n.value))))}return new A(this.location,new O([`left requires an Either type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return`(left ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}}class Er extends Sn{location;value;constructor(t,e){super(t),this.location=t,this.value=e}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return this.value.findNames()}checkOut(t,e,n){const r=n.now();if(r instanceof oe){const n=new I("rout");return B([[n,()=>this.value.check(t,e,r.rightType)]],(()=>new L(new an(n.value))))}return new A(this.location,new O([`right requires an Either type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return`(right ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}}class Tr extends Sn{location;target;motive;baseLeft;baseRight;constructor(t,e,n,r,s){super(t),this.location=t,this.target=e,this.motive=n,this.baseLeft=r,this.baseRight=s}synthHelper(t,e){return kn.synthIndEither(t,e,this.location,this.target,this.motive,this.baseLeft,this.baseRight)}findNames(){return this.target.findNames().concat(this.motive.findNames()).concat(this.baseLeft.findNames()).concat(this.baseRight.findNames())}prettyPrint(){return`(ind-Either ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.baseLeft.prettyPrint()} \n              ${this.baseRight.prettyPrint()})`}toString(){return this.prettyPrint()}}class br extends Sn{location;constructor(t){super(t),this.location=t}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return[]}checkOut(t,e,n){const r=n.readBackType(t);return yn(this.location,V(t)),new L(new cn(this.location.locationToSrcLoc(),r))}prettyPrint(){return"TODO"}toString(){return this.prettyPrint()}}class Pr extends Sn{location;func;arg;args;constructor(t,e,n,r){super(t),this.location=t,this.func=e,this.arg=n,this.args=r}synthHelper(t,e){return kn.synthApplication(t,e,this.location,this.func,this.arg,this.args)}findNames(){return this.func.findNames().concat(this.arg.findNames()).concat(this.args.flatMap((t=>t.findNames())))}prettyPrint(){return`(${this.func.prettyPrint()} ${this.arg.prettyPrint()} ${this.args.map((t=>t.prettyPrint())).join(" ")})`}toString(){return this.prettyPrint()}}var Nr,xr;!function(t){t[t.INTEGER=1]="INTEGER",t[t.RATIONAL=2]="RATIONAL",t[t.REAL=3]="REAL",t[t.COMPLEX=4]="COMPLEX"}(Nr||(Nr={}));class _r{result;constructor(t){this.result=t}}class kr extends _r{result;value;constructor(t,e){super(t),this.result=t,this.value=e}isSigned(){return!!this.result&&("+"===this.value[0]||"-"===this.value[0])}build(){return Ir.build(this.value)}}class Sr extends _r{result;numerator;denominator;constructor(t,e,n){super(t),this.result=t,this.numerator=e,this.denominator=n}build(){return Br.build(this.numerator,this.denominator)}}class Or extends _r{result;integer;decimal;exponent;constructor(t,e,n,r){super(t),this.result=t,this.integer=e,this.decimal=n,this.exponent=r}build(){if(this.integer?.includes("inf"))return this.integer.includes("-")?Cr.NEG_INFINITY:Cr.INFINITY;if(this.integer?.includes("nan"))return Cr.NAN;let t=(this.exponent?this.exponent.build():Cr.INEXACT_ZERO).coerce(),e=Number((this.integer?this.integer:"0")+"."+(this.decimal?this.decimal:"0"));return e*=Math.pow(10,t),Cr.build(e)}}class $r extends _r{result;real;sign;imaginary;constructor(t,e,n,r){super(t),this.result=t,this.real=e,this.sign=n,this.imaginary=r}build(){const t=this.real?this.real.build():Ir.EXACT_ZERO,e=this.imaginary.build();return this.sign&&"-"===this.sign?Rr.build(t,e.negate()):Rr.build(t,e)}}function Lr(t){const e=new RegExp("^([+-]?)(\\d+)$").exec(t);return e?new kr(!0,e[0]):new kr(!1)}function Ar(t,e){const n=Lr(t);if(n.result&&e>=Nr.INTEGER)return n;const r=function(t){if(1!==(t.match(/\//g)||[]).length)return new Sr(!1);const e=t.split("/");if(2!==e.length)return new Sr(!1);const[n,r]=e,s=Lr(n),i=Lr(r);return s.result&&i.result?new Sr(!0,n,r):new Sr(!1)}(t);if(r.result&&e>=Nr.RATIONAL)return r;const s=function(t){function e(t){if(function(t){return"+inf.0"===t||"-inf.0"===t||"+nan.0"===t||"-nan.0"===t}(t))return new Or(!0,t);const e=(t.match(/\./g)||[]).length;if(e>1)return new Or(!1);if(0===e){const e=Lr(t);return new Or(e.result,e.value)}const[n,r]=t.split("."),s=Lr(n),i=Lr(r),a=s.result||""===n,o=i.result||""===r;return"+"===n||"-"===n?""===r?new Or(!1):new Or(!0,`${n}0`,t):s.result&&o||a&&i.result?i.result&&i.isSigned()?new Or(!1):new Or(!0,s.value,i.value):new Or(!1)}return 0===(t.match(/[eE]/g)||[]).length?e(t):function(t){const n=t.indexOf("e"),r=t.indexOf("E");if(-1===n&&-1===r)return new Or(!1);const s=-1===n?r:n,i=t.substring(0,s),a=t.substring(s+1);if(""===i||""==a)return new Or(!1);const o=e(i);if(!o.result)return new Or(!1);const c=Ar(a,Nr.REAL);return c.result?new Or(!0,o.integer,o.decimal,c):new Or(!1)}(t)}(t);if(s.result&&e>=Nr.REAL)return s;const i=function(t){if((t.match(/i/g)||[]).length<1)return new $r(!1);if("i"!==t[t.length-1])return new $r(!1);const e=t.search(/(?<!^)[+-]/);if(-1===e){const e=Ar(t.slice(0,-1),Nr.REAL);return e.result?new $r(!0,void 0,void 0,e):new $r(!1)}const n=t.slice(0,e);let r=t.slice(e+1,-1);"+"!==r[0]&&"-"!==r[0]&&(r="+"+r);const s=Ar(n,Nr.REAL),i=Ar(r,Nr.REAL);return s.result&&i.result?new $r(!0,s,t[e],i):new $r(!1)}(t);return i.result&&e>=Nr.COMPLEX?i:new kr(!1)}class Ir{numberType=Nr.INTEGER;value;static EXACT_ZERO=new Ir(0n);constructor(t){this.value=t}static build(t,e=!1){const n=BigInt(t);return 0n===n?Ir.EXACT_ZERO:new Ir(n)}promote(t){switch(t){case Nr.INTEGER:return this;case Nr.RATIONAL:return Br.build(this.value,1n,!0);case Nr.REAL:return Cr.build(this.coerce(),!0);case Nr.COMPLEX:return Rr.build(this,Ir.EXACT_ZERO,!0)}}equals(t){return t instanceof Ir&&this.value===t.value}greaterThan(t){return this.value>t.value}negate(){return this===Ir.EXACT_ZERO?this:Ir.build(-this.value)}multiplicativeInverse(){if(this===Ir.EXACT_ZERO)throw new Error("Division by zero");return Br.build(1n,this.value,!1)}add(t){return Ir.build(this.value+t.value)}multiply(t){return Ir.build(this.value*t.value)}getBigInt(){return this.value}coerce(){return this.value>Number.MAX_SAFE_INTEGER?1/0:this.value<Number.MIN_SAFE_INTEGER?-1/0:Number(this.value)}toString(){return this.value.toString()}}class Br{numberType=Nr.RATIONAL;numerator;denominator;constructor(t,e){this.numerator=t,this.denominator=e}static build(t,e,n=!1){return Br.simplify(BigInt(t),BigInt(e),n)}static simplify(t,e,n=!1){const r=(t,e)=>0n===e?t:r(e,t.valueOf()%e.valueOf()),s=r(t,e),i=t<0n?-1n:1n,a=e<0n?-1n:1n,o=i*a;return t*=i,1n!==(e*=a)||n?new Br(o*t/s,e/s):Ir.build(o*t)}getNumerator(){return this.numerator}getDenominator(){return this.denominator}promote(t){switch(t){case Nr.RATIONAL:return this;case Nr.REAL:return Cr.build(this.coerce(),!0);case Nr.COMPLEX:return Rr.build(this,Ir.EXACT_ZERO,!0);default:throw new Error("Unable to demote rational")}}equals(t){return t instanceof Br&&this.numerator===t.numerator&&this.denominator===t.denominator}greaterThan(t){return this.numerator*t.denominator>t.numerator*this.denominator}negate(){return Br.build(-this.numerator,this.denominator)}multiplicativeInverse(){if(0n===this.numerator)throw new Error("Division by zero");return Br.build(this.denominator,this.numerator)}add(t){const e=this.numerator*t.denominator+t.numerator*this.denominator,n=this.denominator*t.denominator;return Br.build(e,n)}multiply(t){const e=this.numerator*t.numerator,n=this.denominator*t.denominator;return Br.build(e,n)}coerce(){const t=this.numerator<0n?-this.numerator:this.numerator;let e=this.denominator;const n=Number(t/e);if(n>Number.MAX_VALUE)return this.numerator<0n?-1/0:1/0;let r=t%e;for(;r>Number.MAX_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER;)r/=2n,e/=2n;const s=Number(r)/Number(e);return this.numerator<0n?-(n+s):n+s}toString(){return`${this.numerator}/${this.denominator}`}}class Cr{numberType=Nr.REAL;value;static INEXACT_ZERO=new Cr(0);static INEXACT_NEG_ZERO=new Cr(-0);static INFINITY=new Cr(1/0);static NEG_INFINITY=new Cr(-1/0);static NAN=new Cr(NaN);static build(t,e=!1){return t===1/0?Cr.INFINITY:t===-1/0?Cr.NEG_INFINITY:isNaN(t)?Cr.NAN:0===t?Cr.INEXACT_ZERO:-0===t?Cr.INEXACT_NEG_ZERO:new Cr(t)}constructor(t){this.value=t}promote(t){switch(t){case Nr.REAL:return this;case Nr.COMPLEX:return Rr.build(this,Ir.EXACT_ZERO,!0);default:throw new Error("Unable to demote real")}}equals(t){return t instanceof Cr&&this.value===t.value}greaterThan(t){return this.value>t.value}negate(){return Cr.build(-this.value)}multiplicativeInverse(){if(this===Cr.INEXACT_ZERO||this===Cr.INEXACT_NEG_ZERO)throw new Error("Division by zero");return Cr.build(1/this.value)}add(t){return Cr.build(this.value+t.value)}multiply(t){return Cr.build(this.value*t.value)}coerce(){return this.value}toString(){return this===Cr.INFINITY?"+inf.0":this===Cr.NEG_INFINITY?"-inf.0":this===Cr.NAN?"+nan.0":this.value.toString()}}class Rr{numberType=Nr.COMPLEX;real;imaginary;static build(t,e,n=!1){return Rr.simplify(new Rr(t,e),n)}constructor(t,e){this.real=t,this.imaginary=e}static simplify(t,e){return!e&&Hr(t.imaginary,Ir.EXACT_ZERO)?t.real:t}promote(t){if(t===Nr.COMPLEX)return this;throw new Error("Unable to demote complex")}negate(){return Rr.build(this.real.negate(),this.imaginary.negate())}equals(t){return Hr(this.real,t.real)&&Hr(this.imaginary,t.imaginary)}greaterThan(t){return zr(this.real,t.real)&&zr(this.imaginary,t.imaginary)}multiplicativeInverse(){const t=Dr(Qr(this.real,this.real),Qr(this.imaginary,this.imaginary));return Rr.build(Qr(t.multiplicativeInverse(),this.real),Qr(t.multiplicativeInverse(),this.imaginary.negate()))}add(t){return Rr.build(Dr(this.real,t.real),Dr(this.imaginary,t.imaginary))}multiply(t){const e=(n=Qr(this.real,t.real),r=Qr(this.imaginary,t.imaginary),Dr(n,function(t){return t.negate()}(r)));var n,r;const s=Dr(Qr(this.real,t.imaginary),Qr(this.imaginary,t.real));return Rr.build(e,s)}getReal(){return this.real}getImaginary(){return this.imaginary}coerce(){throw new Error("Cannot coerce a complex number to a javascript number")}toPolar(){const t=this.real.promote(Nr.REAL),e=this.imaginary.promote(Nr.REAL),n=Cr.build(Math.sqrt(t.coerce()*t.coerce()+e.coerce()*e.coerce())),r=Cr.build(Math.atan2(e.coerce(),t.coerce()));return Mr.build(n,r)}toString(){return`${this.real}+${this.imaginary}i`}}class Mr{magnitude;angle;constructor(t,e){this.magnitude=t,this.angle=e}static build(t,e){return new Mr(t,e)}toCartesian(){const t=Cr.build(this.magnitude.coerce()*Math.cos(this.angle.coerce())),e=Cr.build(this.magnitude.coerce()*Math.sin(this.angle.coerce()));return Rr.build(t,e)}}function qr(t){switch(t.numberType){case Nr.INTEGER:return t;case Nr.RATIONAL:return 1n===t.getDenominator()?Ir.build(t.getNumerator()):t;case Nr.REAL:return t;case Nr.COMPLEX:return Rr.build(qr(t.getReal()),qr(t.getImaginary()))}}function Ur(t,e){return t.numberType>e.numberType?[t,e.promote(t.numberType)]:t.numberType<e.numberType?[t.promote(e.numberType),e]:[t,e]}function Hr(t,e){const[n,r]=Ur(t,e);return n.equals(r)}function zr(t,e){const[n,r]=Ur(t,e);return n.greaterThan(r)}function Dr(t,e){const[n,r]=Ur(t,e);return qr(n.add(r))}function Qr(t,e){const[n,r]=Ur(t,e);return qr(n.multiply(r))}class Fr{start;end;constructor(t,e){this.start=t,this.end=e}merge(t){return new Fr(this.start,t.end)}}class Vr{line;column;constructor(t,e){this.line=t,this.column=e}}function Gr(t,e){return t.split("\n")[e.line-1]}function Xr(t){return"^".padStart(t.column," ")}!function(t){t[t.LEFT_PAREN=0]="LEFT_PAREN",t[t.RIGHT_PAREN=1]="RIGHT_PAREN",t[t.LEFT_BRACKET=2]="LEFT_BRACKET",t[t.RIGHT_BRACKET=3]="RIGHT_BRACKET",t[t.DOT=4]="DOT",t[t.HASH_SEMICOLON=5]="HASH_SEMICOLON",t[t.IDENTIFIER=6]="IDENTIFIER",t[t.NUMBER=7]="NUMBER",t[t.BOOLEAN=8]="BOOLEAN",t[t.STRING=9]="STRING",t[t.IF=10]="IF",t[t.LET=11]="LET",t[t.COND=12]="COND",t[t.ELSE=13]="ELSE",t[t.DEFINE=14]="DEFINE",t[t.LAMBDA=15]="LAMBDA",t[t.APOSTROPHE=16]="APOSTROPHE",t[t.BACKTICK=17]="BACKTICK",t[t.COMMA=18]="COMMA",t[t.COMMA_AT=19]="COMMA_AT",t[t.QUOTE=20]="QUOTE",t[t.QUASIQUOTE=21]="QUASIQUOTE",t[t.UNQUOTE=22]="UNQUOTE",t[t.UNQUOTE_SPLICING=23]="UNQUOTE_SPLICING",t[t.SET=24]="SET",t[t.BEGIN=25]="BEGIN",t[t.DELAY=26]="DELAY",t[t.IMPORT=27]="IMPORT",t[t.EXPORT=28]="EXPORT",t[t.DEFINE_SYNTAX=29]="DEFINE_SYNTAX",t[t.SYNTAX_RULES=30]="SYNTAX_RULES",t[t.HASH_VECTOR=31]="HASH_VECTOR",t[t.VECTOR=32]="VECTOR",t[t.EOF=33]="EOF"}(xr||(xr={}));class Kr extends SyntaxError{loc;constructor(t,e){super(`Syntax error at (${e.line}:${e.column})\n${t}`),this.loc=e}toString(){return this.message}}let Yr=class extends Kr{constructor(t,e){super(Gr(t,e)+"\nUnexpected EOF",e),this.name="UnexpectedEOFError"}};class jr extends Kr{form;constructor(t,e,n){super(Gr(t,e)+"\n"+Xr(e)+"\n"+`Unexpected '${n}'`,e),this.form=n,this.name="UnexpectedTokenError"}}class Zr extends Kr{form;expected;constructor(t,e,n,r){super(Gr(t,e)+"\n"+Xr(e)+"\n"+`Expected '${r}' but got '${n}'`,e),this.form=n,this.expected=r,this.name="ExpectedTokenError"}}class Wr extends Kr{token;constructor(t,e,n,r){super(Gr(t,e)+"\n"+Xr(e)+"\n"+`Syntax '${n}' not allowed at Scheme §${r}`,e),this.token=n,this.name="DisallowedTokenError"}}class Jr extends Kr{token;constructor(t,e,n){super(Gr(t,e)+"\n"+Xr(e)+"\n"+`Syntax '${n}' not supported yet`,e),this.token=n,this.name="UnsupportedTokenError"}}class ts{elements;location;constructor(t){this.elements=t,this.location=new Fr(this.firstPos(),this.lastPos())}static build(t){if(0===t.length)throw new Error("Illegal empty group. This should never happen.");if(1===t.length){const n=t[0];if(ns(n))return n;if((e=n).type!==xr.IDENTIFIER&&e.type!==xr.NUMBER&&e.type!==xr.STRING&&e.type!==xr.BOOLEAN)throw new Zr("",n.pos,n,"<data>");return new ts(t)}var e;if(2===t.length){const e=t[0];if(es(e)&&function(t){return t.type===xr.APOSTROPHE||t.type===xr.BACKTICK||t.type===xr.HASH_VECTOR||t.type===xr.COMMA||t.type===xr.COMMA_AT}(e))return new ts(t)}const n=t[0],r=t[t.length-1];if(es(n)&&es(r)&&(i=r,(s=n).type===xr.LEFT_PAREN&&i.type===xr.RIGHT_PAREN||s.type===xr.LEFT_BRACKET&&i.type===xr.RIGHT_BRACKET))return new ts(t);var s,i;const a=new ts(t);throw new Zr("",a.location.start,a,"matching parentheses")}first(){return this.elements[0]}firstToken(){const t=this.first();return es(t)?t:t.firstToken()}firstPos(){return this.firstToken().pos}last(){return this.elements[this.elements.length-1]}lastToken(){const t=this.last();return es(t)?t:t.lastToken()}lastPos(){return this.lastToken().pos}isParenthesized(){const t=this.first();return es(t)&&(t.type===xr.LEFT_PAREN||t.type===xr.LEFT_BRACKET)}isSingleIdentifier(){return!this.isParenthesized()&&1===this.length()}unwrap(){return this.isParenthesized()?this.elements.slice(1,this.elements.length-1):this.elements}length(){return this.unwrap().length}toString(){return this.elements.map((t=>t.toString())).join(" ")}}function es(t){return t instanceof rs}function ns(t){return t instanceof ts}class rs{type;lexeme;literal;start;end;pos;endPos;constructor(t,e,n,r,s,i,a){this.type=t,this.lexeme=e,this.literal=n,this.start=r,this.end=s,this.pos=new Vr(i,a),this.endPos=new Vr(i,a+e.length-1)}convertToken(){switch(this.type){case xr.APOSTROPHE:return new rs(xr.QUOTE,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case xr.BACKTICK:return new rs(xr.QUASIQUOTE,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case xr.HASH_VECTOR:return new rs(xr.VECTOR,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case xr.COMMA:return new rs(xr.UNQUOTE,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case xr.COMMA_AT:return new rs(xr.UNQUOTE_SPLICING,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);default:return this}}toString(){return`${this.lexeme}`}}class ss extends SyntaxError{loc;constructor(t,e,n){super(t),this.loc={line:e,column:n}}toString(){return this.message}}class is extends ss{char;constructor(t,e,n){super(`Unexpected character '${n}' (${t}:${e})`,t,e),this.char=n,this.name="UnexpectedCharacterError"}}class as extends ss{constructor(t,e){super(`Unexpected EOF (${t}:${e})`,t,e),this.name="UnexpectedEOFError"}}let os=new Map([[".",xr.DOT],["if",xr.IF],["let",xr.LET],["cond",xr.COND],["else",xr.ELSE],["set!",xr.SET],["begin",xr.BEGIN],["delay",xr.DELAY],["quote",xr.QUOTE],["export",xr.EXPORT],["import",xr.IMPORT],["define",xr.DEFINE],["lambda",xr.LAMBDA],["define-syntax",xr.DEFINE_SYNTAX],["syntax-rules",xr.SYNTAX_RULES]]);class cs{source;tokens;start=0;current=0;line=1;col=0;constructor(t){this.source=t,this.tokens=[]}isAtEnd(){return this.current>=this.source.length}advance(){return this.col++,this.source.charAt(this.current++)}jump(){this.start=this.current,this.col++,this.current++}addToken(t,e=null){const n=this.source.substring(this.start,this.current);this.tokens.push(new rs(t,n,e,this.start,this.current,this.line,this.col))}scanTokens(){for(;!this.isAtEnd();)this.start=this.current,this.scanToken();return this.tokens.push(new rs(xr.EOF,"",null,this.start,this.current,this.line,this.col)),this.tokens}scanToken(){const t=this.advance();switch(t){case"(":this.addToken(xr.LEFT_PAREN);break;case")":this.addToken(xr.RIGHT_PAREN);break;case"[":this.addToken(xr.LEFT_BRACKET);break;case"]":this.addToken(xr.RIGHT_BRACKET);break;case"'":this.addToken(xr.APOSTROPHE);break;case"`":this.addToken(xr.BACKTICK);break;case",":if(this.match("@")){this.addToken(xr.COMMA_AT);break}this.addToken(xr.COMMA);break;case"#":if(this.match("t")||this.match("f"))this.booleanToken();else if(this.match("|"))this.comment();else if(this.match(";"))this.addToken(xr.HASH_SEMICOLON);else{if("("!==this.peek()&&"["!==this.peek())throw new is(this.line,this.col,t);this.addToken(xr.HASH_VECTOR)}break;case";":for(;"\n"!=this.peek()&&!this.isAtEnd();)this.advance();break;case" ":case"\r":case"\t":break;case"\n":this.line++,this.col=0;break;case'"':this.stringToken();break;case"|":this.identifierTokenLoose();break;default:if(this.isDigit(t)||"-"===t||"+"===t||"."===t||"i"===t||"n"===t)this.identifierNumberToken();else{if(!this.isValidIdentifier(t))throw new is(this.line,this.col,t);this.identifierToken()}}}comment(){for(;("|"!=this.peek()||"#"!=this.peekNext())&&!this.isAtEnd();)"\n"===this.peek()&&(this.line++,this.col=0),this.advance();if(this.isAtEnd())throw new as(this.line,this.col);this.jump(),this.jump()}identifierToken(){for(;this.isValidIdentifier(this.peek());)this.advance();this.addToken(this.checkKeyword())}identifierTokenLoose(){for(this.advance();"|"!=this.peek()&&!this.isAtEnd();)"\n"===this.peek()&&(this.line++,this.col=0),this.advance();if(this.isAtEnd())throw new as(this.line,this.col);this.advance(),this.addToken(this.checkKeyword())}identifierNumberToken(){for(;this.isValidIdentifier(this.peek());)this.advance();const t=this.source.substring(this.start,this.current);Ar(t,Nr.COMPLEX).result?this.addToken(xr.NUMBER,t):this.addToken(this.checkKeyword())}checkKeyword(){var t=this.source.substring(this.start,this.current);return os.has(t)?os.get(t):xr.IDENTIFIER}stringToken(){for(;'"'!=this.peek()&&!this.isAtEnd();)"\n"===this.peek()&&(this.line++,this.col=0),this.advance();if(this.isAtEnd())throw new as(this.line,this.col);this.advance();const t=this.source.substring(this.start+1,this.current-1);this.addToken(xr.STRING,t)}booleanToken(){this.addToken(xr.BOOLEAN,"t"===this.peekPrev())}match(t){return!this.isAtEnd()&&(this.source.charAt(this.current)==t&&(this.current++,!0))}peek(){return this.isAtEnd()?"\0":this.source.charAt(this.current)}peekNext(){return this.current+1>=this.source.length?"\0":this.source.charAt(this.current+1)}peekPrev(){return this.current-1<0?"\0":this.source.charAt(this.current-1)}isDigit(t){return t>="0"&&t<="9"}isSpecialSyntax(t){return"("===t||")"===t||"["===t||"]"===t||";"===t||"|"===t}isValidIdentifier(t){return!this.isWhitespace(t)&&!this.isSpecialSyntax(t)}isWhitespace(t){return" "===t||"\0"===t||"\n"===t||"\r"===t||"\t"===t}}var us,hs;!function(t){class e{location;expressions;constructor(t,e){this.location=t,this.expressions=e}accept(t){return t.visitSequence(this)}equals(t){if(t instanceof e){if(this.expressions.length!==t.expressions.length)return!1;for(let e=0;e<this.expressions.length;e++)if(!this.expressions[e].equals(t.expressions[e]))return!1;return!0}return!1}}t.Sequence=e;class n{location;value;constructor(t,e){this.location=t,this.value=e}accept(t){return t.visitNumericLiteral(this)}equals(t){return t instanceof n&&this.value===t.value}}t.NumericLiteral=n;class r{location;value;constructor(t,e){this.location=t,this.value=e}accept(t){return t.visitBooleanLiteral(this)}equals(t){return t instanceof r&&this.value===t.value}}t.BooleanLiteral=r;class s{location;value;constructor(t,e){this.location=t,this.value=e}accept(t){return t.visitStringLiteral(this)}equals(t){return t instanceof s&&this.value===t.value}}t.StringLiteral=s;class i{location;params;rest;body;constructor(t,e,n,r=void 0){this.location=t,this.params=n,this.rest=r,this.body=e}accept(t){return t.visitLambda(this)}equals(t){if(t instanceof i){if(this.params.length!==t.params.length)return!1;for(let e=0;e<this.params.length;e++)if(!this.params[e].equals(t.params[e]))return!1;if(this.rest&&t.rest){if(!this.rest.equals(t.rest))return!1}else if(this.rest||t.rest)return!1;return this.body.equals(t.body)}return!1}}t.Lambda=i;class a{location;name;constructor(t,e){this.location=t,this.name=e}accept(t){return t.visitIdentifier(this)}equals(t){return t instanceof a&&this.name===t.name}}t.Identifier=a;class o{location;name;value;constructor(t,e,n){this.location=t,this.name=e,this.value=n}accept(t){return t.visitDefinition(this)}equals(t){return t instanceof o&&(this.name.equals(t.name)&&this.value.equals(t.value))}}t.Definition=o;class c{location;operator;operands;constructor(t,e,n){this.location=t,this.operator=e,this.operands=n}accept(t){return t.visitApplication(this)}equals(t){if(t instanceof c){if(!this.operator.equals(t.operator))return!1;if(this.operands.length!==t.operands.length)return!1;for(let e=0;e<this.operands.length;e++)if(!this.operands[e].equals(t.operands[e]))return!1;return!0}return!1}}t.Application=c;class u{location;test;consequent;alternate;constructor(t,e,n,r){this.location=t,this.test=e,this.consequent=n,this.alternate=r}accept(t){return t.visitConditional(this)}equals(t){return t instanceof u&&(this.test.equals(t.test)&&this.consequent.equals(t.consequent)&&this.alternate.equals(t.alternate))}}t.Conditional=u;class h{location;car;cdr;constructor(t,e,n){this.location=t,this.car=e,this.cdr=n}accept(t){return t.visitPair(this)}equals(t){return t instanceof h&&(this.car.equals(t.car)&&this.cdr.equals(t.cdr))}}t.Pair=h;class l{location;constructor(t){this.location=t}accept(t){return t.visitNil(this)}equals(t){return t instanceof l}}t.Nil=l;class p{location;value;constructor(t,e){this.location=t,this.value=e}accept(t){return t.visitSymbol(this)}equals(t){return t instanceof p&&this.value===t.value}}t.Symbol=p;class f{location;value;constructor(t,e){this.location=t,this.value=e}accept(t){return t.visitSpliceMarker(this)}equals(t){return t instanceof f&&this.value.equals(t.value)}}t.SpliceMarker=f;class w{location;name;value;constructor(t,e,n){this.location=t,this.name=e,this.value=n}accept(t){return t.visitReassignment(this)}equals(t){return t instanceof w&&(this.name.equals(t.name)&&this.value.equals(t.value))}}t.Reassignment=w;class y{location;source;identifiers;constructor(t,e,n){this.location=t,this.source=e,this.identifiers=n}accept(t){return t.visitImport(this)}equals(t){if(t instanceof y){if(!this.source.equals(t.source))return!1;if(this.identifiers.length!==t.identifiers.length)return!1;for(let e=0;e<this.identifiers.length;e++)if(!this.identifiers[e].equals(t.identifiers[e]))return!1;return!0}return!1}}t.Import=y;class d{location;definition;constructor(t,e){this.location=t,this.definition=e}accept(t){return t.visitExport(this)}equals(t){return t instanceof d&&this.definition.equals(t.definition)}}t.Export=d;class m{location;elements;constructor(t,e){this.location=t,this.elements=e}accept(t){return t.visitVector(this)}equals(t){if(t instanceof m){if(this.elements.length!==t.elements.length)return!1;for(let e=0;e<this.elements.length;e++)if(!this.elements[e].equals(t.elements[e]))return!1;return!0}return!1}}t.Vector=m;class g{location;name;transformer;constructor(t,e,n){this.location=t,this.name=e,this.transformer=n}accept(t){return t.visitDefineSyntax(this)}equals(t){return t instanceof g&&(this.name.equals(t.name)&&this.transformer.equals(t.transformer))}}t.DefineSyntax=g;class v{location;literals;rules;constructor(t,e,n){this.location=t,this.literals=e,this.rules=n}accept(t){return t.visitSyntaxRules(this)}equals(t){if(t instanceof v){if(this.literals.length!==t.literals.length)return!1;for(let e=0;e<this.literals.length;e++)if(!this.literals[e].equals(t.literals[e]))return!1;if(this.rules.length!==t.rules.length)return!1;for(let e=0;e<this.rules.length;e++)if(!this.rules[e][0].equals(t.rules[e][0])||!this.rules[e][1].equals(t.rules[e][1]))return!1;return!0}return!1}}t.SyntaxRules=v}(us||(us={})),function(t){class e{location;name;params;rest;body;constructor(t,e,n,r,s=void 0){this.location=t,this.name=e,this.body=n,this.params=r,this.rest=s}accept(t){return t.visitFunctionDefinition(this)}equals(t){if(t instanceof e){if(this.params.length!==t.params.length)return!1;for(let e=0;e<this.params.length;e++)if(!this.params[e].equals(t.params[e]))return!1;if(this.rest&&t.rest){if(!this.rest.equals(t.rest))return!1}else if(this.rest||t.rest)return!1;return this.body.equals(t.body)}return!1}}t.FunctionDefinition=e;class n{location;identifiers;values;body;constructor(t,e,n,r){this.location=t,this.identifiers=e,this.values=n,this.body=r}accept(t){return t.visitLet(this)}equals(t){if(t instanceof n){if(this.identifiers.length!==t.identifiers.length)return!1;for(let e=0;e<this.identifiers.length;e++)if(!this.identifiers[e].equals(t.identifiers[e]))return!1;if(this.values.length!==t.values.length)return!1;for(let e=0;e<this.values.length;e++)if(!this.values[e].equals(t.values[e]))return!1;return this.body.equals(t.body)}return!1}}t.Let=n;class r{location;predicates;consequents;catchall;constructor(t,e,n,r){this.location=t,this.predicates=e,this.consequents=n,this.catchall=r}accept(t){return t.visitCond(this)}equals(t){if(t instanceof r){if(this.predicates.length!==t.predicates.length)return!1;for(let e=0;e<this.predicates.length;e++)if(!this.predicates[e].equals(t.predicates[e]))return!1;if(this.consequents.length!==t.consequents.length)return!1;for(let e=0;e<this.consequents.length;e++)if(!this.consequents[e].equals(t.consequents[e]))return!1;return this.catchall&&t.catchall?this.catchall.equals(t.catchall):!this.catchall&&!t.catchall}return!1}}t.Cond=r;class s{location;elements;terminator;constructor(t,e,n=void 0){this.location=t,this.elements=e,this.terminator=n}accept(t){return t.visitList(this)}equals(t){if(t instanceof s){if(this.elements.length!==t.elements.length)return!1;for(let e=0;e<this.elements.length;e++)if(!this.elements[e].equals(t.elements[e]))return!1;return this.terminator&&t.terminator?this.terminator.equals(t.terminator):!this.terminator&&!t.terminator}return!1}}t.List=s;class i{location;expressions;constructor(t,e){this.location=t,this.expressions=e}accept(t){return t.visitBegin(this)}equals(t){if(t instanceof i){if(this.expressions.length!==t.expressions.length)return!1;for(let e=0;e<this.expressions.length;e++)if(!this.expressions[e].equals(t.expressions[e]))return!1;return!0}return!1}}t.Begin=i;class a{location;expression;constructor(t,e){this.location=t,this.expression=e}accept(t){return t.visitDelay(this)}equals(t){return t instanceof a&&this.expression.equals(t.expression)}}t.Delay=a}(hs||(hs={}));var ls;!function(t){t[t.NONE=0]="NONE",t[t.QUOTE=1]="QUOTE",t[t.QUASIQUOTE=2]="QUASIQUOTE"}(ls||(ls={}));class ps{source;tokens;chapter;current=0;quoteMode=ls.NONE;constructor(t,e,n=1/0){this.source=t,this.tokens=e,this.chapter=n}advance(){return this.isAtEnd()||this.current++,this.previous()}isAtEnd(){return this.current>=this.tokens.length}previous(){return this.tokens[this.current-1]}peek(){return this.tokens[this.current]}validateChapter(t,e){if(this.chapter<e)throw new Wr(this.source,t.pos,t,this.chapter)}toLocation(t){return new Fr(t.pos,t.endPos)}destructureList(t,e=t=>{}){if(0===t.length)return[[],void 0];if(1===t.length)return e(t[0]),[[this.parseExpression(t[0])],void 0];const n=t.at(-2);if(es(n)&&n.type===xr.DOT){const n=t.at(-1),r=t.slice(0,-2);return e(n),r.forEach(e),[r.map(this.parseExpression.bind(this)),this.parseExpression(n)]}const r=t;return r.forEach(e),[r.map(this.parseExpression.bind(this)),void 0]}grouping(t){const e=[];let n=!1;t&&(n=!0,e.push(t));do{let t=this.advance();switch(t.type){case xr.LEFT_PAREN:case xr.LEFT_BRACKET:const r=this.grouping(t);e.push(r);break;case xr.RIGHT_PAREN:case xr.RIGHT_BRACKET:if(!n)throw new jr(this.source,t.pos,t);e.push(t),n=!1;break;case xr.APOSTROPHE:case xr.BACKTICK:case xr.COMMA:case xr.COMMA_AT:case xr.HASH_VECTOR:let s;do{s=this.grouping()}while(!s);e.push(this.affect(t,s));break;case xr.QUOTE:case xr.QUASIQUOTE:case xr.UNQUOTE:case xr.UNQUOTE_SPLICING:case xr.IDENTIFIER:case xr.NUMBER:case xr.BOOLEAN:case xr.STRING:case xr.DOT:case xr.DEFINE:case xr.IF:case xr.ELSE:case xr.COND:case xr.LAMBDA:case xr.LET:case xr.SET:case xr.BEGIN:case xr.DELAY:case xr.IMPORT:case xr.EXPORT:case xr.DEFINE_SYNTAX:case xr.SYNTAX_RULES:e.push(t);break;case xr.HASH_SEMICOLON:for(;!this.grouping(););break;case xr.EOF:throw new Yr(this.source,t.pos);default:throw new jr(this.source,t.pos,t)}}while(n);if(0!==e.length)try{return ts.build(e)}catch(t){if(t instanceof Zr)throw new Zr(this.source,t.loc,t.form,t.expected);throw t}}affect(t,e){return ts.build([t,e])}parseExpression(t){return es(t)?this.parseToken(t):t.isSingleIdentifier()?this.parseToken(t.unwrap()[0]):this.parseGroup(t)}parseToken(t){switch(t.type){case xr.IDENTIFIER:return this.quoteMode===ls.NONE?new us.Identifier(this.toLocation(t),t.lexeme):new us.Symbol(this.toLocation(t),t.lexeme);case xr.NUMBER:return new us.NumericLiteral(this.toLocation(t),t.literal);case xr.BOOLEAN:return new us.BooleanLiteral(this.toLocation(t),t.literal);case xr.STRING:return new us.StringLiteral(this.toLocation(t),t.literal);default:if(this.quoteMode!==ls.NONE||this.chapter>=5)return new us.Symbol(this.toLocation(t),t.lexeme);throw new jr(this.source,t.pos,t)}}parseGroup(t){if(!t.isParenthesized())return this.parseAffectorGroup(t);switch(this.quoteMode){case ls.NONE:return this.parseNormalGroup(t);case ls.QUOTE:case ls.QUASIQUOTE:return this.parseQuotedGroup(t)}}parseAffectorGroup(t){const[e,n]=t.unwrap();switch(e.type){case xr.APOSTROPHE:case xr.QUOTE:if(this.validateChapter(e,2),this.quoteMode!==ls.NONE){const t=this.parseExpression(n),r=new us.Symbol(this.toLocation(e),"quote"),s=r.location.merge(t.location);return new hs.List(s,[r,t])}this.quoteMode=ls.QUOTE;const r=this.parseExpression(n);return this.quoteMode=ls.NONE,r;case xr.BACKTICK:case xr.QUASIQUOTE:if(this.validateChapter(e,2),this.quoteMode!==ls.NONE){const t=this.parseExpression(n),r=new us.Symbol(this.toLocation(e),"quasiquote"),s=r.location.merge(t.location);return new hs.List(s,[r,t])}this.quoteMode=ls.QUASIQUOTE;const s=this.parseExpression(n);return this.quoteMode=ls.NONE,s;case xr.COMMA:case xr.UNQUOTE:this.validateChapter(e,2);let i=this.quoteMode;if(i===ls.NONE)throw new Jr(this.source,e.pos,e);if(i===ls.QUOTE){const t=this.parseExpression(n),r=new us.Symbol(this.toLocation(e),"unquote"),s=r.location.merge(t.location);return new hs.List(s,[r,t])}this.quoteMode=ls.NONE;const a=this.parseExpression(n);return this.quoteMode=i,a;case xr.COMMA_AT:case xr.UNQUOTE_SPLICING:this.validateChapter(e,2);let o=this.quoteMode;if(o===ls.NONE)throw new jr(this.source,e.pos,e);if(o===ls.QUOTE){const t=this.parseExpression(n),r=new us.Symbol(this.toLocation(e),"unquote-splicing"),s=r.location.merge(t.location);return new hs.List(s,[r,t])}this.quoteMode=ls.NONE;const c=this.parseExpression(n);this.quoteMode=o;const u=this.toLocation(e).merge(c.location);return new us.SpliceMarker(u,c);case xr.HASH_VECTOR:this.validateChapter(e,3);let h=this.quoteMode;this.quoteMode=ls.QUOTE;const l=this.parseVector(t);return this.quoteMode=h,l;default:throw new jr(this.source,e.pos,e)}}parseNormalGroup(t){if(0===t.length()){if(this.chapter>=5)return new us.Nil(t.location);throw new Zr(this.source,t.location.start,t,"non-empty group")}const e=t.unwrap()[0];if(es(e))switch(e.type){case xr.LAMBDA:return this.validateChapter(e,1),this.parseLambda(t);case xr.DEFINE:return this.validateChapter(e,1),this.parseDefinition(t);case xr.IF:return this.validateChapter(e,1),this.parseConditional(t);case xr.LET:return this.validateChapter(e,1),this.parseLet(t);case xr.COND:return this.validateChapter(e,1),this.parseExtendedCond(t);case xr.QUOTE:case xr.APOSTROPHE:case xr.QUASIQUOTE:case xr.BACKTICK:case xr.UNQUOTE:case xr.COMMA:case xr.UNQUOTE_SPLICING:case xr.COMMA_AT:return this.validateChapter(e,2),this.parseAffectorGroup(t);case xr.BEGIN:return this.validateChapter(e,3),this.parseBegin(t);case xr.DELAY:return this.validateChapter(e,3),this.parseDelay(t);case xr.SET:return this.validateChapter(e,3),this.parseSet(t);case xr.DEFINE_SYNTAX:return this.validateChapter(e,5),this.parseDefineSyntax(t);case xr.SYNTAX_RULES:throw new jr(this.source,e.pos,e);case xr.IMPORT:return this.validateChapter(e,1),this.parseImport(t);case xr.EXPORT:return this.validateChapter(e,1),this.parseExport(t);case xr.VECTOR:return this.validateChapter(e,3),this.parseAffectorGroup(t);default:return this.parseApplication(t)}return this.parseApplication(t)}parseQuotedGroup(t){if(0===t.length())return new us.Nil(t.location);if(1===t.length()){const e=[this.parseExpression(t.unwrap()[0])];return new hs.List(t.location,e)}const e=t.unwrap(),[n,r]=this.destructureList(e);return new hs.List(t.location,n,r)}parseLambda(t){if(t.length()<3)throw new Zr(this.source,t.location.start,t,"(lambda (<identifier>* . <rest-identifier>?) <body>+) | (lambda <rest-identifer> <body>+)");const e=t.unwrap(),n=e[1],r=e.slice(2);let s,i=[];if(es(n)){if(n.type!==xr.IDENTIFIER)throw new Zr(this.source,n.pos,n,"<rest-identifier>");s=new us.Identifier(this.toLocation(n),n.lexeme)}else{const t=n.unwrap();[i,s]=this.destructureList(t,(t=>{if(!es(t))throw new Zr(this.source,t.pos,t,"<identifier>");if(t.type!==xr.IDENTIFIER)throw new Zr(this.source,t.pos,t,"<identifier>")}))}const a=r.map(this.parseExpression.bind(this));if(a.length<1)throw new Zr(this.source,t.location.start,t,"(lambda ... <body>+)");if(1===a.length)return new us.Lambda(t.location,a[0],i,s);const o=a.at(0).location.merge(a.at(-1).location),c=new us.Sequence(o,a);return new us.Lambda(t.location,c,i,s)}parseDefinition(t){if(t.length()<3)throw new Zr(this.source,t.location.start,t,"(define <identifier> <expr>) | (define (<identifier> <formals>) <body>+)");const e=t.unwrap(),n=e[1],r=e.slice(2);let s,i,a=[],o=!1;if(ns(n)){o=!0;const t=n.unwrap(),e=t[0],r=t.splice(1);if(!es(e))throw new Zr(this.source,e.location.start,e,"<identifier>");if(e.type!==xr.IDENTIFIER)throw new Zr(this.source,e.pos,e,"<identifier>");s=new us.Identifier(this.toLocation(e),e.lexeme),[a,i]=this.destructureList(r,(t=>{if(!es(t))throw new Zr(this.source,t.pos,t,"<identifier>");if(t.type!==xr.IDENTIFIER)throw new Zr(this.source,t.pos,t,"<identifier>")}))}else{if(n.type!==xr.IDENTIFIER)throw new Zr(this.source,n.pos,n,"<identifier>");s=new us.Identifier(this.toLocation(n),n.lexeme),o=!1}if(r.length<1)throw new Zr(this.source,t.location.start,t,"(define ... <body>+)");if(o){const e=r.map(this.parseExpression.bind(this));if(1===e.length)return new hs.FunctionDefinition(t.location,s,e[0],a,i);const n=e.at(0).location.merge(e.at(-1).location),o=new us.Sequence(n,e);return new hs.FunctionDefinition(t.location,s,o,a,i)}if(r.length>1)throw new Zr(this.source,t.location.start,t,"(define <identifier> <expr>)");const c=this.parseExpression(r[0]);return new us.Definition(t.location,s,c)}parseConditional(t){if(t.length()<3||t.length()>4)throw new Zr(this.source,t.location.start,t,"(if <pred> <cons> <alt>?)");const e=t.unwrap(),n=e[1],r=e[2],s=t.length()>3?e[3]:void 0,i=this.parseExpression(n),a=this.parseExpression(r),o=s?this.parseExpression(s):new us.Identifier(t.location,"undefined");return new us.Conditional(t.location,i,a,o)}parseApplication(t){if(t.length()<1)throw new Zr(this.source,t.location.start,t,"(<func> <args>*)");const e=t.unwrap(),n=e[0],r=e.splice(1),s=this.parseExpression(n),i=[];for(const t of r)i.push(this.parseExpression(t));return new us.Application(t.location,s,i)}parseLet(t){if(this.chapter>=5){return t.unwrap().slice(1).forEach((t=>{this.parseExpression(t)})),new hs.Let(t.location,[],[],new us.Identifier(t.location,"undefined"))}if(t.length()<3)throw new Zr(this.source,t.location.start,t,"(let ((<identifier> <value>)*) <body>+)");const e=t.unwrap(),n=e[1],r=e.slice(2);if(!ns(n))throw new Zr(this.source,n.pos,n,"((<identifier> <value>)*)");const s=[],i=[],a=n.unwrap();for(const t of a){if(!ns(t))throw new Zr(this.source,t.pos,t,"(<identifier> <value>)");if(2!==t.length())throw new Zr(this.source,t.location.start,t,"(<identifier> <value>)");const[e,n]=t.unwrap();if(!es(e))throw new Zr(this.source,e.location.start,e,"<identifier>");if(e.type!==xr.IDENTIFIER)throw new Zr(this.source,e.pos,e,"<identifier>");s.push(new us.Identifier(this.toLocation(e),e.lexeme)),i.push(this.parseExpression(n))}const o=r.map(this.parseExpression.bind(this));if(o.length<1)throw new Zr(this.source,t.location.start,t,"(let ... <body>+)");if(1===o.length)return new hs.Let(t.location,s,i,o[0]);const c=o.at(0).location.merge(o.at(-1).location),u=new us.Sequence(c,o);return new hs.Let(t.location,s,i,u)}parseExtendedCond(t){if(this.chapter>=5){return t.unwrap().slice(1).forEach((t=>{this.parseExpression(t)})),new hs.Cond(t.location,[],[],new us.Identifier(t.location,"undefined"))}if(t.length()<2)throw new Zr(this.source,t.location.start,t,"(cond (<pred> <body>*)* (else <val>)?)");const e=t.unwrap().splice(1),n=e.pop(),r=[],s=[];for(const t of e){if(!ns(t))throw new Zr(this.source,t.pos,t,"(<pred> <body>*)");if(t.length()<1)throw new Zr(this.source,t.firstToken().pos,t.firstToken(),"(<pred> <body>*)");const[e,...n]=t.unwrap();if(es(e)&&e.type===xr.ELSE)throw new Zr(this.source,e.pos,e,"<predicate>");const i=this.parseExpression(e),a=n.map(this.parseExpression.bind(this)),o=n.length<1?i.location:a.at(0).location.merge(a.at(-1).location),c=n.length<1?i:n.length<2?a[0]:new us.Sequence(o,a);r.push(i),s.push(c)}if(!ns(n))throw new Zr(this.source,n.pos,n,"(<pred> <body>+) | (else <val>)");if(n.length()<2)throw new Zr(this.source,n.firstToken().pos,n.firstToken(),"(<pred> <body>+) | (else <val>)");const[i,...a]=n.unwrap();let o=!1;if(es(i)&&i.type===xr.ELSE&&(o=!0,1!==a.length))throw new Zr(this.source,n.location.start,n,"(else <val>)");if(a.length<1)throw new Zr(this.source,n.location.start,n,"(<pred> <body>+)");const c=a.map(this.parseExpression.bind(this)),u=c.at(0).location.merge(c.at(-1).location),h=1===a.length?c[0]:new us.Sequence(u,c);if(o)return new hs.Cond(t.location,r,s,h);const l=this.parseExpression(i);return r.push(l),s.push(h),new hs.Cond(t.location,r,s)}parseSet(t){if(3!==t.length())throw new Zr(this.source,t.location.start,t,"(set! <identifier> <expr>)");const e=t.unwrap(),n=e[1],r=e[2];if(ns(n))throw new Zr(this.source,n.location.start,n,"<identifier>");if(n.type!==xr.IDENTIFIER)throw new Zr(this.source,n.pos,n,"<identifier>");const s=new us.Identifier(this.toLocation(n),n.lexeme),i=this.parseExpression(r);return new us.Reassignment(t.location,s,i)}parseBegin(t){if(t.length()<2)throw new Zr(this.source,t.location.start,t,"(begin <body>+)");const e=t.unwrap().slice(1),n=[];for(const t of e)n.push(this.parseExpression(t));return new hs.Begin(t.location,n)}parseDelay(t){if(this.chapter>=5){return t.unwrap().slice(1).forEach((t=>{this.parseExpression(t)})),new hs.Delay(t.location,new us.Identifier(t.location,"undefined"))}if(2!==t.length())throw new Zr(this.source,t.location.start,t,"(delay <expr>)");const e=t.unwrap()[1],n=this.parseExpression(e);return new hs.Delay(t.location,n)}parseDefineSyntax(t){if(3!==t.length())throw new Zr(this.source,t.location.start,t,"(define-syntax <identifier> <transformer>)");const e=t.unwrap(),n=e[1],r=e[2];this.quoteMode=ls.QUOTE;const s=this.parseExpression(n);if(this.quoteMode=ls.NONE,!(s instanceof us.Symbol))throw new Zr(this.source,s.location.start,n,"<identifier>");if(!ns(r))throw new Zr(this.source,r.pos,r,"<transformer>");if(r.length()<2)throw new Zr(this.source,r.firstToken().pos,r,"(syntax-rules ...)");const i=r.unwrap()[0];if(!es(r.unwrap()[0]))throw new Zr(this.source,r.firstToken().pos,i,"syntax-rules");if(i.type!==xr.SYNTAX_RULES)throw new Zr(this.source,i.pos,i,"syntax-rules");const a=this.parseSyntaxRules(r);return new us.DefineSyntax(t.location,s,a)}isValidPattern(t){if(t instanceof hs.List){if(void 0===t.terminator){if(t.elements.filter((t=>t instanceof us.Symbol&&"..."===t.value)).length>1)return!1;const e=t.elements.findIndex((t=>t instanceof us.Symbol&&"..."===t.value));if(-1!=e&&0===e)return!1;for(const e of t.elements)if(!this.isValidPattern(e))return!1;return!0}{if(t.elements.filter((t=>t instanceof us.Symbol&&"..."===t.value)).length>1)return!1;const e=t.elements.findIndex((t=>t instanceof us.Symbol&&"..."===t.value));if(-1!=e){if(0===e)return!1;if(e===t.elements.length-1)return!1}for(const e of t.elements)if(!this.isValidPattern(e))return!1;return this.isValidPattern(t.terminator)}}return t instanceof us.Symbol||t instanceof us.BooleanLiteral||t instanceof us.NumericLiteral||t instanceof us.StringLiteral||t instanceof us.Nil}isValidTemplate(t){if(t instanceof hs.List){if(void 0===t.terminator){if(0===t.elements.length)return!1;if(2===t.elements.length&&t.elements[0]instanceof us.Symbol&&"..."===t.elements[0].value)return this.isValidTemplate(t.elements[1]);let e=!1;for(let n=0;n<t.elements.length;n++){const r=t.elements[n];if(r instanceof us.Symbol&&"..."===r.value){if(e){e=!1;continue}return!1}if(!this.isValidTemplate(r))return!1;e=!0}return!0}{if(0===t.elements.length)return!1;let e=!1;for(let n=0;n<t.elements.length;n++){const r=t.elements[n];if(r instanceof us.Symbol&&"..."===r.value){if(e){e=!1;continue}return!1}if(!this.isValidTemplate(r))return!1;e=!0}return this.isValidTemplate(t.terminator)}}return t instanceof us.Symbol||t instanceof us.BooleanLiteral||t instanceof us.NumericLiteral||t instanceof us.StringLiteral||t instanceof us.Nil}parseSyntaxRules(t){if(t.length()<3)throw new Zr(this.source,t.location.start,t,"(syntax-rules (<literal>*) <syntax-rule>+)");const e=t.unwrap(),n=e[1],r=e.slice(2),s=[];if(!ns(n))throw new Zr(this.source,n.pos,n,"(<literal>*)");this.quoteMode=ls.QUOTE;for(const t of n.unwrap()){if(!es(t))throw new Zr(this.source,t.location.start,t,"<literal>");const e=this.parseExpression(t);if(!(e instanceof us.Symbol))throw new Zr(this.source,t.pos,t,"<literal>");s.push(e)}const i=[];for(const t of r){if(!ns(t))throw new Zr(this.source,t.pos,t,"(<pattern> <template>)");if(2!==t.length())throw new Zr(this.source,t.location.start,t,"(<pattern> <template>)");const[e,n]=t.unwrap(),r=this.parseExpression(e),s=this.parseExpression(n);if(!this.isValidPattern(r))throw new Zr(this.source,r.location.start,e,"<symbol> | <literal> | (<pattern>+) | (<pattern>+ ... <pattern>*) | (<pattern>+ ... <pattern>+ . <pattern>)");if(!this.isValidTemplate(s))throw new Zr(this.source,s.location.start,n,"<symbol> | <literal> | (<element>+) | (<element>+ . <template>) | (... <template>)");i.push([r,s])}return this.quoteMode=ls.NONE,new us.SyntaxRules(t.location,s,i)}parseImport(t){if(3!==t.length())throw new Zr(this.source,t.firstToken().pos,t.firstToken(),'(import "<source>" (<identifier>*))');const e=t.unwrap(),n=e[1],r=e[2];if(!es(n))throw new Zr(this.source,n.location.start,n,'"<source>"');if(n.type!==xr.STRING)throw new Zr(this.source,n.pos,n,'"<source>"');if(!ns(r))throw new Zr(this.source,r.pos,r,"(<identifier>*)");const s=r.unwrap(),i=[];for(const t of s){if(!es(t))throw new Zr(this.source,t.location.start,t,"<identifier>");if(t.type!==xr.IDENTIFIER)throw new Zr(this.source,t.pos,t,"<identifier>");i.push(new us.Identifier(this.toLocation(t),t.lexeme))}const a=new us.StringLiteral(this.toLocation(n),n.literal);return new us.Import(t.location,a,i)}parseExport(t){if(2!==t.length())throw new Zr(this.source,t.firstToken().pos,t.firstToken(),"(export (<definition>))");const e=t.unwrap()[1];if(!ns(e))throw new Zr(this.source,e.pos,e,"(<definition>)");const n=this.parseExpression(e);if(!(n instanceof us.Definition||n instanceof hs.FunctionDefinition))throw new Zr(this.source,e.location.start,e,"(<definition>)");return new us.Export(t.location,n)}parseVector(t){const e=t.unwrap()[1].unwrap().map(this.parseExpression.bind(this));return new us.Vector(t.location,e)}parse(t=!1){t&&(this.quoteMode=ls.QUOTE,this.current=0);const e=[];for(;!this.isAtEnd()&&this.peek().type!==xr.EOF;){const t=this.grouping();if(!t)continue;const n=this.parseExpression(t);e.push(n)}if(this.chapter>=5&&!t){return[...e.filter((t=>t instanceof us.Import)),...this.parse(!0).filter((t=>!(t instanceof hs.List&&t.elements&&t.elements[0]instanceof us.Symbol&&"import"===t.elements[0].value)))]}return e}}function fs(t){return new xn(t,!0)}function ws(t){return new k(fs(t),t.source)}function ys(t){if(t instanceof us.Symbol)return t.value;if(t instanceof us.NumericLiteral)return t.value;if(t instanceof hs.List)return ys(t.elements[0]);throw new Error("Expected a Element, but got: "+t)}function ds(t,e){return new Nn(e.start,e.end,t)}function ms(t,e){return ds(ys(t),e)}function gs(t){const e=new cs(t);return new ps("",e.scanTokens()).parse()}class vs{static parsePie(t){return vs.parseElements(gs(t)[0])}static parseElements(t){const e=ys(t);if("U"===e)return n=ds("U",t.location),new $n(fs(n));if("the"===e){let e=t.elements;return function(t,e,n){return new On(fs(t),e,n)}(ds("the",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("Nat"===e)return function(t){return new Ln(fs(t))}(ds("Nat",t.location));if("zero"===e)return function(t){return new An(fs(t))}(ds("zero",t.location));if("add1"===e)return function(t,e){return new In(fs(t),e)}(ds("add1",t.location),this.parseElements(t.elements[1]));if("->"===e||"→"===e){let e=t.elements;return function(t,e){return new qn(fs(t),e[0],e[1],e[2])}(ds("->",t.location),[this.parseElements(e[1]),this.parseElements(e[2]),e.slice(3).map((t=>this.parseElements(t)))])}if("lambda"===e||"λ"===e){let e=t.elements,n=t.location,r=e[1],s=e[2];return function(t,e,n){return new Hn(fs(t),e,n)}(ds("λ",n),r.elements.map((e=>ws(ms(e,t.location)))),this.parseElements(s))}if("Pi"===e||"Π"===e){let e=t.elements,n=e[1],r=e[2],s=n.elements[0],i=s.elements[0],a=s.elements[1],o=n.elements.slice(1).map((t=>{let e=t.elements[0],n=t.elements[1];return new S(ws(ms(e,t.location)),this.parseElements(n))}));return function(t,e,n){return new Un(fs(t),e,n)}(ds("Π",t.location),Es(new S(ws(ms(i,s.location)),this.parseElements(a)),o),this.parseElements(r))}if("Sigma"===e||"Σ"===e){let e=t.elements,n=e[1],r=e[2],s=n.elements[0],i=s.elements[0],a=s.elements[1],o=n.elements.slice(1).map((t=>{let e=t.elements[0],n=t.elements[1];return new S(ws(ms(e,t.location)),this.parseElements(n))}));return function(t,e,n){return new zn(fs(t),e,n)}(ds("Π",t.location),Es(new S(ws(ms(i,s.location)),this.parseElements(a)),o),this.parseElements(r))}if("Pair"===e){let e=t.elements;return function(t,e,n){return new Vn(fs(t),e,n)}(ds("Pair",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("cons"===e){let e=t.elements;return function(t,e,n){return new Gn(fs(t),e,n)}(ds("Cons",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("car"===e)return function(t,e){return new Xn(fs(t),e)}(ds("car",t.location),this.parseElements(t.elements[1]));if("cdr"===e)return function(t,e){return new Kn(fs(t),e)}(ds("cdr",t.location),this.parseElements(t.elements[1]));if("which-Nat"===e){let e=t.elements;return function(t,e,n,r){return new Bn(fs(t),e,n,r)}(ds("which-Nat",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("iter-Nat"===e){let e=t.elements;return function(t,e,n,r){return new Cn(fs(t),e,n,r)}(ds("iter-Nat",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("rec-Nat"===e){let e=t.elements;return function(t,e,n,r){return new Rn(fs(t),e,n,r)}(ds("rec-Nat",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("ind-Nat"===e){let e=t.elements;return function(t,e,n,r,s){return new Mn(fs(t),e,n,r,s)}(ds("ind-Nat",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]),this.parseElements(e[4]))}if("Atom"===e)return function(t){return new Qn(fs(t))}(ds("Atom",t.location));if("quote"===e)return function(t,e){return new Fn(fs(t),e)}(ds("Quote",t.location),ys(t.elements[1]));if("Trivial"===e)return function(t){return new Yn(fs(t))}(ds("Trivial",t.location));if("sole"===e)return function(t){return new jn(fs(t))}(ds("sole",t.location));if("List"===e)return function(t,e){return new Jn(fs(t),e)}(ds("List",t.location),this.parseElements(t.elements[1]));if("nil"===e)return function(t){return new Zn(fs(t))}(ds("nil",t.location));if("::"===e){let e=t.elements;return function(t,e,n){return new tr(fs(t),e,n)}(ds("::",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("rec-List"===e){let e=t.elements;return function(t,e,n,r){return new er(fs(t),e,n,r)}(ds("rec-List",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("ind-List"===e){let e=t.elements;return function(t,e,n,r,s){return new nr(fs(t),e,n,r,s)}(ds("ind-List",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]),this.parseElements(e[4]))}if("="===e){let e=t.elements;return function(t,e,n,r){return new ir(fs(t),e,n,r)}(ds("=",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("same"===e)return function(t,e){return new ar(fs(t),e)}(ds("same",t.location),this.parseElements(t.elements[1]));if("replace"===e){let e=t.elements;return function(t,e,n,r){return new or(fs(t),e,n,r)}(ds("replace",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("trans"===e){let e=t.elements;return function(t,e,n){return new cr(fs(t),e,n)}(ds("trans",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("cong"===e){let e=t.elements;return function(t,e,n){return new ur(fs(t),e,n)}(ds("cong",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("ind-="===e){let e=t.elements;return function(t,e,n,r){return new lr(fs(t),e,n,r)}(ds("ind-=",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("symm"===e)return function(t,e){return new hr(fs(t),e)}(ds("symm",t.location),this.parseElements(t.elements[1]));if("Vec"===e){let e=t.elements;return function(t,e,n){return new pr(fs(t),e,n)}(ds("Vec",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("vecnil"===e)return function(t){return new fr(fs(t))}(ds("vecnil",t.location));if("vec::"===e){let e=t.elements;return function(t,e,n){return new wr(fs(t),e,n)}(ds("vec::",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("head"===e)return function(t,e){return new yr(fs(t),e)}(ds("head",t.location),this.parseElements(t.elements[1]));if("tail"===e)return function(t,e){return new dr(fs(t),e)}(ds("tail",t.location),this.parseElements(t.elements[1]));if("ind-Vec"===e){let e=t.elements;return function(t,e,n,r,s,i){return new mr(fs(t),e,n,r,s,i)}(ds("ind-Vec",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]),this.parseElements(e[4]),this.parseElements(e[5]))}if("Either"===e){let e=t.elements;return function(t,e,n){return new gr(fs(t),e,n)}(ds("Either",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("left"===e)return function(t,e){return new vr(fs(t),e)}(ds("left",t.location),this.parseElements(t.elements[1]));if("right"===e)return function(t,e){return new Er(fs(t),e)}(ds("right",t.location),this.parseElements(t.elements[1]));if("ind-Either"===e){let e=t.elements;return function(t,e,n,r,s){return new Tr(fs(t),e,n,r,s)}(ds("ind-Either",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]),this.parseElements(e[4]))}if("Absurd"===e)return function(t){return new rr(fs(t))}(ds("Absurd",t.location));if("ind-Absurd"===e){let e=t.elements;return function(t,e,n){return new sr(fs(t),e,n)}(ds("ind-Absurd",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("TODO"===e)return function(t){return new br(fs(t))}(ds("TODO",t.location));if(t instanceof hs.List&&t.elements.length>1){let e=t.elements;return function(t,e,n,r){return new Pr(fs(t),e,n,r)}(ds("App",t.location),this.parseElements(e[0]),this.parseElements(e[1]),e.slice(2).map((t=>this.parseElements(t))))}if(q(e))return function(t,e){return new Dn(fs(t),e)}(ds(e,t.location),e);if(!isNaN(Number(e)))return function(t,e){return new Wn(fs(t),Number(e))}(ds(e,t.location),e);var n;throw new Error("Unexpected element: "+t)}}function Es(t,e){return[t,...e]}class Ts{location;name;type;constructor(t,e,n){this.location=t,this.name=e,this.type=n}}class bs{location;name;expr;constructor(t,e,n){this.location=t,this.name=e,this.expr=n}}class Ps{location;type;left;right;constructor(t,e,n,r){this.location=t,this.type=e,this.left=n,this.right=r}}class Ns{static parseDeclaration(t){const e=ys(t);if("claim"===e){let e=t.elements;return new Ts(fs(ms(e[0],t.location)),ys(e[1]),vs.parseElements(e[2]))}if("define"===e){let e=t.elements;return new bs(fs(ms(e[0],t.location)),ys(e[1]),vs.parseElements(e[2]))}if("check-same"===e){let e=t.elements;return new Ps(fs(ms(e[0],t.location)),vs.parseElements(e[1]),vs.parseElements(e[2]),vs.parseElements(e[3]))}return vs.parseElements(t)}}function xs(t,e){const n=new I("eout");return B([[n,()=>e.isType(t,new Map)]],(()=>new L(F(t,n.value).readBackType(t))))}function _s(t,e,n,r,s){const i=new I("tOut"),a=new I("tv"),o=new I("aOut"),c=new I("bOut"),u=new I("av"),h=new I("bv");return B([[i,()=>n.isType(t,new Map)],[a,()=>F(t,i.value).readBackType(t)],[o,()=>r.check(t,new Map,a.value)],[c,()=>s.check(t,new Map,a.value)],[u,()=>F(t,o.value)],[h,()=>F(t,c.value)]],(()=>vn(t,e,a.value,u.value,h.value)))}function ks(t){return t.prettyPrint()}!function(t,e=self){const n=new p(e,!1);n.registerPlugin(E,t)}(class extends a{executionCount;constructor(t){super(t),this.executionCount=0}async evaluateChunk(t){this.executionCount++;try{let e=function(t){const e=gs(t);let n=Y;for(const t of e){const e=Ns.parseDeclaration(t);if(e instanceof Ts){const t=G(n,e.name,e.location,e.type);if(t instanceof L)n=t.result;else if(t instanceof A)throw new Error(""+t.where+t.message)}else if(e instanceof bs){const t=X(n,e.name,e.location,e.expr);if(t instanceof L)n=t.result;else if(t instanceof A)throw new Error(""+t.where+t.message)}else if(e instanceof Ps){const t=_s(n,e.location,e.type,e.left,e.right);if(t instanceof L)n=t.result;else if(t instanceof A)throw new Error(""+t.where+t.message)}else{const t=xs(n,e);if(t instanceof L){const e=t.result;console.log(e.prettyPrint())}else if(t instanceof A)throw new Error(""+t.where+t.message)}let r="";for(const[t,e]of n)e instanceof W?(r+=t+" : "+ks(e.type.readBackType(n))+"\n",r+=t+" = "+ks(wt(n,e.type,e.value))+"\n"):r+=t+" : "+ks(e.type.readBackType(n))+"\n";return r}}(t);this.conductor.sendOutput(`Result of expression: execution ${e}`)}catch(t){t instanceof Error?this.conductor.sendOutput(`Error: ${t.message}`):this.conductor.sendOutput(`Error: ${String(t)}`)}}})}(util);
//# sourceMappingURL=index.js.map
